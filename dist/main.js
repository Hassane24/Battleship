(()=>{"use strict";function e(e){const t=document.createElement("div");return t.classList.add("empty"),t.classList.add("cell"),t.setAttribute("id",`${e}`),t}function t(e,t){const a={name:e,length:t,hits:[],sunken:!1},n=()=>{if(a.hits.length==a.length)return a.sunken=!0};return{getLength:()=>a.length,getName:()=>a.name,getHits:()=>a.hits,shipState:()=>a.sunken,hit:()=>{a.hits.push("hit"),n()},isSunk:n}}function a(){const e={board:Array(100).fill({hasShip:!1,isHit:!1}),fleet:[t("carrier",5),t("battleship",4),t("cruiser",3),t("submarine",3),t("destroyer",2)],locations:[]},a=t=>!t.some((t=>!e.board[t]))&&!t.some((t=>e.board[t].hasShip))&&![9,19,29,39,49,59,69,79,89].some((e=>[e,e+1].every((e=>t.includes(e)))));return{getBoard:()=>e.board,getFleet:()=>e.fleet,getShipLocations:()=>e.locations.map((e=>e.location)).flat(),shipPlacement:(t,a,n)=>{const o=n.getName(),r=((e,t,a)=>{const n=[];for(let o=0;o<a.getLength();o++)"horizontal"===e?n.push(t+o):n.push(t+10*o);return n})(t,a,n);for(let t=0;t<r.length;t++)e.board.splice(r[t],1,{hasShip:!0,isHit:!1,ship:n});return e.locations.push({shipName:o,location:r}),r},receiveAttack:t=>{0==e.board[t].hasShip?e.board.splice(t,1,{hasShip:!1,isHit:!0,missedShot:!0}):(e.board[t].isHit=!0,e.board[t].ship.hit())},checkShipState:()=>e.board.filter((e=>e.hasShip)).map((e=>e.ship)).every((e=>e.isSunk())),checkForValidPlacement:a,randomShipPlacement:t=>{let n=[],o=(e=>{for(let o=0;o<100-t.getLength();o++){let r=[];if("horiz"===e)for(let e=0;e<t.getLength();e++)r.push(o+e);else for(let e=0;e<t.getLength();e++)r.push(o+10*e);a(r)&&n.push(r)}return n[Math.floor(Math.random()*n.length)]})(["horiz","vert"][Math.floor(2*Math.random())]);for(let a=0;a<o.length;a++)e.board.splice(o[a],1,{hasShip:!0,isHit:!1,ship:t})}}}(function(){const t=document.querySelector(".player-name"),n=document.querySelector("#name"),o=document.querySelector(".player-board > span"),r=document.querySelector(".player-name > button"),i=(document.querySelector(".board-container"),document.querySelector(".player-board > .board")),l=document.querySelector(".player-board "),s=(document.querySelector(".cpu-board > .board"),document.querySelector(".cpu-board "),document.querySelector(".container"));return function(e){let t=function(e,t){const n={name:e,board:a(),playing:!0};return{getName:()=>n.name,setName:e=>n.name=e,attackEnemy:(e,t)=>{e.receiveAttack(t)},whoIsPlaying:()=>n.playing,switchRoles:()=>n.playing=!n.playing}}(e),n=function(e){const t={name:"computer",board:a(),playing:!1,shotsFired:[]},n=()=>{let e=Math.floor(100*Math.random());return o(e,t.shotsFired)&&t.shotsFired.push(e),o(e,t.shotsFired)?e:n()},o=(e,t)=>{for(let a=0;a<t.length;a++)return e!=t[a]};return{getName:()=>t.name,attackEnemy:e=>{e.receiveAttack(n())},whoIsPlaying:()=>t.playing,switchRoles:()=>t.playing=!t.playing}}(),o=a(),r=a(),i=0;const l=()=>o.getFleet(),s=()=>r.getFleet(),c=()=>t.whoIsPlaying(),h=()=>n.whoIsPlaying(),p=()=>{c(),t.switchRoles(),n.switchRoles()};return{getPlayerFleet:l,getPlayerShipLocations:()=>o.getShipLocations(),getCPUFleet:s,placeCPUShips:()=>{const e=s();for(let t=0;t<e.length;t++)r.randomShipPlacement(e[t])},getShipToPlace:()=>l()[i],placePlayerShips:(e,t)=>{const a=l();return i+=1,o.shipPlacement(t,e,a[i])},checkIfAllShipsArePlaced:()=>l().length===i,playerAttack:e=>{c()&&(t.attackEnemy(r,e),p())},cpuAttack:()=>{h()&&(n.attackEnemy(o),p())},playerWon:()=>r.checkShipState(),cpuWon:()=>o.checkShipState(),playerRole:c,cpuRole:h,switchPlayersRoles:p,isValidPlacement:e=>{o.checkForValidPlacement(e)}}}(n.value).getShipToPlace(),{bindEvents:()=>{r.addEventListener("click",(()=>{if(""==n.value)return;l.classList.remove("hide"),o.textContent=n.value,(()=>{for(let t=0;t<100;t++){const a=e(t);i.appendChild(a)}})(),t.remove();const a=document.createElement("div");a.classList.add("place-ships-text"),a.textContent="Place your ships",s.appendChild(a)}))}}})().bindEvents()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoibUJBQUEsU0FBU0EsRUFBTUMsR0FDYixNQUFNQyxFQUFPQyxTQUFTQyxjQUFjLE9BSXBDLE9BSEFGLEVBQUtHLFVBQVVDLElBQUksU0FDbkJKLEVBQUtHLFVBQVVDLElBQUksUUFDbkJKLEVBQUtLLGFBQWEsS0FBTSxHQUFHTixLQUNwQkMsRUNMVCxTQUFTTSxFQUFNQyxFQUFNQyxHQUNuQixNQUFNQyxFQUFPLENBQ1hGLEtBQUFBLEVBQ0FDLE9BQUFBLEVBQ0FFLEtBQU0sR0FDTkMsUUFBUSxHQXFCSkMsRUFBUyxLQUNiLEdBQUlILEVBQUtDLEtBQUtGLFFBQVVDLEVBQUtELE9BQVEsT0FBUUMsRUFBS0UsUUFBUyxHQUc3RCxNQUFPLENBQUVFLFVBbkJTLElBQ1RKLEVBQUtELE9Ba0JNTSxRQXRCSixJQUNQTCxFQUFLRixLQXFCZVEsUUFoQmIsSUFDUE4sRUFBS0MsS0Fld0JNLFVBYnBCLElBQ1RQLEVBQUtFLE9BWW1DTSxJQVRyQyxLQUNWUixFQUFLQyxLQUFLUSxLQUFLLE9BQ2ZOLEtBT29EQSxPQUFBQSxHQzdCeEQsU0FBU08sSUFDUCxNQUFNQyxFQUFZLENBQ2hCdEIsTUFBT3VCLE1BQU0sS0FBS0MsS0FBSyxDQUFFQyxTQUFTLEVBQU9DLE9BQU8sSUFDaERDLE1BQU8sQ0FDTG5CLEVBQU0sVUFBVyxHQUNqQkEsRUFBTSxhQUFjLEdBQ3BCQSxFQUFNLFVBQVcsR0FDakJBLEVBQU0sWUFBYSxHQUNuQkEsRUFBTSxZQUFhLElBRXJCb0IsVUFBVyxJQXdDUEMsRUFBMEJDLElBRTFCQSxFQUFjQyxNQUFNQyxJQUFTVixFQUFVdEIsTUFBTWdDLE9BRXRDRixFQUFjQyxNQUFNQyxHQUFRVixFQUFVdEIsTUFBTWdDLEdBQUtQLFlBSHpDLENBQUMsRUFBRyxHQUFJLEdBQUksR0FBSSxHQUFJLEdBQUksR0FBSSxHQUFJLElBTXRDTSxNQUFNRSxHQUNSLENBQUNBLEVBQUtBLEVBQU0sR0FBR0MsT0FBT0MsR0FDM0JMLEVBQWNNLFNBQVNELE9BNEUvQixNQUFPLENBQ0xFLFNBM0hlLElBQ1JmLEVBQVV0QixNQTJIakJzQyxTQXBIZSxJQUNSaEIsRUFBVUssTUFvSGpCWSxpQkF6SHVCLElBQ2hCakIsRUFBVU0sVUFBVVksS0FBSzdCLEdBQVNBLEVBQUs4QixXQUFVQyxPQXlIeERDLGNBdkdvQixDQUFDQyxFQUFhQyxFQUFrQkMsS0FDcEQsTUFBTUMsRUFBV0QsRUFBSzlCLFVBQ2hCeUIsRUFiYSxFQUFDRyxFQUFhQyxFQUFrQmxDLEtBRW5ELE1BQU04QixFQUFXLEdBQ2pCLElBQUssSUFBSU8sRUFBSSxFQUFHQSxFQUFJckMsRUFBS0ksWUFBYWlDLElBQ3BCLGVBQWhCSixFQUNJSCxFQUFTckIsS0FBS3lCLEVBQW1CRyxHQUNqQ1AsRUFBU3JCLEtBQUt5QixFQUF1QixHQUFKRyxHQUV2QyxPQUFPUCxHQUtVUSxDQUFhTCxFQUFhQyxFQUFrQkMsR0FDN0QsSUFBSyxJQUFJSSxFQUFJLEVBQUdBLEVBQUlULEVBQVMvQixPQUFRd0MsSUFDbkM1QixFQUFVdEIsTUFBTW1ELE9BQU9WLEVBQVNTLEdBQUksRUFBRyxDQUNyQ3pCLFNBQVMsRUFDVEMsT0FBTyxFQUNQZixLQUFNbUMsSUFJVixPQURBeEIsRUFBVU0sVUFBVVIsS0FBSyxDQUFFMkIsU0FBQUEsRUFBVU4sU0FBQUEsSUFDOUJBLEdBNkZQVyxjQXpCcUJDLElBQ3NCLEdBQXZDL0IsRUFBVXRCLE1BQU1xRCxHQUFZNUIsUUFDOUJILEVBQVV0QixNQUFNbUQsT0FBT0UsRUFBWSxFQUFHLENBQ3BDNUIsU0FBUyxFQUNUQyxPQUFPLEVBQ1A0QixZQUFZLEtBR2RoQyxFQUFVdEIsTUFBTXFELEdBQVkzQixPQUFRLEVBQ3BDSixFQUFVdEIsTUFBTXFELEdBQVkxQyxLQUFLUSxRQWlCbkNvQyxlQWJxQixJQUNkakMsRUFBVXRCLE1BQ2R3RCxRQUFRQyxHQUFPQSxFQUFHaEMsVUFDbEJlLEtBQUtpQixHQUFPQSxFQUFHOUMsT0FDZnVCLE9BQU91QixHQUFPQSxFQUFHM0MsV0FVcEJlLHVCQUFBQSxFQUNBNkIsb0JBMUUyQi9DLElBQzNCLElBQUlnRCxFQUF1QixHQW1DdkJsQixFQTFCNkIsQ0FBQ0csSUFDaEMsSUFBSyxJQUFJSSxFQUFJLEVBQUdBLEVBQUksSUFBTXJDLEVBQUtJLFlBQWFpQyxJQUFLLENBQy9DLElBQUlsQixFQUFnQixHQUVwQixHQUFvQixVQUFoQmMsRUFDRixJQUFLLElBQUlNLEVBQUksRUFBR0EsRUFBSXZDLEVBQUtJLFlBQWFtQyxJQUNwQ3BCLEVBQWNWLEtBQUs0QixFQUFJRSxRQUd6QixJQUFLLElBQUlBLEVBQUksRUFBR0EsRUFBSXZDLEVBQUtJLFlBQWFtQyxJQUNwQ3BCLEVBQWNWLEtBQUs0QixFQUFRLEdBQUpFLEdBS3ZCckIsRUFBdUJDLElBQ3pCNkIsRUFBcUJ2QyxLQUFLVSxHQUs5QixPQUFPNkIsRUFDTEMsS0FBS0MsTUFBTUQsS0FBS0UsU0FBV0gsRUFBcUJqRCxVQUlyQ3FELENBOUJiLENBQUMsUUFBUyxRQUFRSCxLQUFLQyxNQUFzQixFQUFoQkQsS0FBS0UsWUErQnBDLElBQUssSUFBSVosRUFBSSxFQUFHQSxFQUFJVCxFQUFTL0IsT0FBUXdDLElBQ25DNUIsRUFBVXRCLE1BQU1tRCxPQUFPVixFQUFTUyxHQUFJLEVBQUcsQ0FDckN6QixTQUFTLEVBQ1RDLE9BQU8sRUFDUGYsS0FBTUEsT0M1R2QsV0FDRSxNQUFNcUQsRUFBYTdELFNBQVM4RCxjQUFjLGdCQUNwQ0MsRUFBWS9ELFNBQVM4RCxjQUFjLFNBQ25DRSxFQUFhaEUsU0FBUzhELGNBQWMsd0JBQ3BDRyxFQUFhakUsU0FBUzhELGNBQWMseUJBRXBDSSxHQURpQmxFLFNBQVM4RCxjQUFjLG9CQUMxQjlELFNBQVM4RCxjQUFjLDJCQUNyQ0ssRUFBdUJuRSxTQUFTOEQsY0FBYyxrQkFHOUNNLEdBRldwRSxTQUFTOEQsY0FBYyx1QkFDZDlELFNBQVM4RCxjQUFjLGVBQy9COUQsU0FBUzhELGNBQWMsZUFzRHpDLE9DL0RGLFNBQWN4RCxHQUNaLElBQUkrRCxFQ0pOLFNBQWdCL0QsRUFBTWdFLEdBQ3BCLE1BQU1DLEVBQWEsQ0FDakJqRSxLQUFBQSxFQUNBVCxNQUFPcUIsSUFDUG9ELFNEQTZCLEdDdUIvQixNQUFPLENBQ0x6RCxRQWJjLElBQ1AwRCxFQUFXakUsS0FhbEJrRSxRQVZlQyxHQUNQRixFQUFXakUsS0FBT21FLEVBVTFCQyxZQVBrQixDQUFDQyxFQUFZQyxLQUMvQkQsRUFBVzFCLGNBQWMyQixJQU96QkMsYUF4Qm1CLElBQ1pOLEVBQVdELFFBd0JsQlEsWUFyQmtCLElBQ1ZQLEVBQVdELFNBQVdDLEVBQVdELFNEUnpCUyxDQUFPekUsR0FDckIwRSxFRUxOLFNBQXdCVixHQUN0QixNQUFNQyxFQUFhLENBQ2pCakUsS0FBTSxXQUNOVCxNQUFPcUIsSUFDUG9ELFNGQzZCLEVFQTdCVyxXQUFZLElBZVJDLEVBQWMsS0FDbEIsSUFBSUMsRUFBUTFCLEtBQUtDLE1BQXNCLElBQWhCRCxLQUFLRSxVQUc1QixPQUZJeUIsRUFBaUJELEVBQU9aLEVBQVdVLGFBQ3JDVixFQUFXVSxXQUFXaEUsS0FBS2tFLEdBQ3hCQyxFQUFpQkQsRUFBT1osRUFBV1UsWUFDakNFLEVBRHFERCxLQUl4REUsRUFBbUIsQ0FBQ1gsRUFBT1ksS0FDL0IsSUFBSyxJQUFJeEMsRUFBSSxFQUFHQSxFQUFJd0MsRUFBTTlFLE9BQVFzQyxJQUNoQyxPQUFJNEIsR0FBU1ksRUFBTXhDLElBU3ZCLE1BQU8sQ0FBRWhDLFFBdkJPLElBQ1AwRCxFQUFXakUsS0FzQkZvRSxZQUpHQyxJQUNuQkEsRUFBVzFCLGNBQWNpQyxNQUdJTCxhQS9CVixJQUNaTixFQUFXRCxRQThCeUJRLFlBM0J6QixJQUNWUCxFQUFXRCxTQUFXQyxFQUFXRCxTRlIzQmdCLEdBQ1pDLEVBQWFyRSxJQUNic0UsRUFBV3RFLElBQ1h1RSxFQUFjLEVBRWxCLE1BQU1DLEVBQWlCLElBQ2RILEVBQVdwRCxXQU9kd0QsRUFBYyxJQUNYSCxFQUFTckQsV0ErQ1p5RCxFQUFhLElBQ1Z2QixFQUFZUSxlQUdmZ0IsRUFBVSxJQUNQYixFQUFVSCxlQUdiaUIsRUFBcUIsS0FDckJGLElBQ0Z2QixFQUFZUyxjQUNaRSxFQUFVRixlQVdkLE1BQU8sQ0FDTFksZUFBQUEsRUFDQUssdUJBNUU2QixJQUN0QlIsRUFBV25ELG1CQTRFbEJ1RCxZQUFBQSxFQUNBSyxjQWhFb0IsS0FDcEIsTUFBTUMsRUFBV04sSUFDakIsSUFBSyxJQUFJbkYsRUFBTyxFQUFHQSxFQUFPeUYsRUFBUzFGLE9BQVFDLElBQ3pDZ0YsRUFBU2pDLG9CQUFvQjBDLEVBQVN6RixLQThEeEMwRixlQXZFcUIsSUFDUFIsSUFDS0QsR0FzRW5CVSxpQkE1RHVCLENBQUM3RCxFQUFVOEQsS0FDbEMsTUFBTUMsRUFBY1gsSUFFcEIsT0FEQUQsR0FBZSxFQUNSRixFQUFXL0MsY0FBYzRELEVBQU05RCxFQUFVK0QsRUFBWVosS0EwRDVEYSx5QkF2RCtCLElBQ3hCWixJQUFpQm5GLFNBQVdrRixFQXVEbkNjLGFBcERvQnJELElBQ2hCMEMsTUFDRnZCLEVBQVlLLFlBQVljLEVBQVV0QyxHQUNsQzRDLE1Ba0RGVSxVQTlDZ0IsS0FDWlgsTUFDRmIsRUFBVU4sWUFBWWEsR0FDdEJPLE1BNENGVyxVQXhDZ0IsSUFDVGpCLEVBQVNwQyxpQkF3Q2hCc0QsT0FyQ2EsSUFDTm5CLEVBQVduQyxpQkFxQ2xCd0MsV0FBQUEsRUFDQUMsUUFBQUEsRUFDQUMsbUJBQUFBLEVBQ0FhLGlCQW5Cd0JyRSxJQUN4QmlELEVBQVc3RCx1QkFBdUJZLEtEeEV6QnNFLENBQUs3QyxFQUFVVSxPQUVIeUIsaUJBbURoQixDQUFFVyxXQWJVLEtBQ2pCNUMsRUFBVzZDLGlCQUFpQixTQUFTLEtBQ25DLEdBQXVCLElBQW5CL0MsRUFBVVUsTUFBYSxPQUMzQk4sRUFBcUJqRSxVQUFVNkcsT0FBTyxRQUN0Qy9DLEVBQVdnRCxZQUFjakQsRUFBVVUsTUF4Q2IsTUFDeEIsSUFBSyxJQUFJNUIsRUFBSSxFQUFHQSxFQUFJLElBQUtBLElBQUssQ0FDNUIsTUFBTTlDLEVBQU9GLEVBQU1nRCxHQUNuQnFCLEVBQVkrQyxZQUFZbEgsS0FzQ3hCbUgsR0FDQXJELEVBQVdrRCxTQUNYLE1BQU1JLEVBQWlCbkgsU0FBU0MsY0FBYyxPQUM5Q2tILEVBQWVqSCxVQUFVQyxJQUFJLG9CQUM3QmdILEVBQWVILFlBQWMsbUJBQzdCNUMsRUFBVTZDLFlBQVlFLFNJL0Q1QkMsR0FBb0JQLGMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2NvbXBvbmVudHMvYm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9GYWN0b3J5RnVuY3Rpb25zL1NoaXBzLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvRmFjdG9yeUZ1bmN0aW9ucy9HYW1lYm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9Nb2R1bGVzL2Rpc3BsYXlDb250cm9sbGVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvTW9kdWxlcy9nYW1lLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvRmFjdG9yeUZ1bmN0aW9ucy9QbGF5ZXIuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9GYWN0b3J5RnVuY3Rpb25zL0NvbXB1dGVyUGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gYm9hcmQoaWQpIHtcbiAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gIGNlbGwuY2xhc3NMaXN0LmFkZChcImVtcHR5XCIpO1xuICBjZWxsLmNsYXNzTGlzdC5hZGQoXCJjZWxsXCIpO1xuICBjZWxsLnNldEF0dHJpYnV0ZShcImlkXCIsIGAke2lkfWApO1xuICByZXR1cm4gY2VsbDtcbn1cbmV4cG9ydCB7IGJvYXJkIH07XG4iLCJmdW5jdGlvbiBzaGlwcyhuYW1lLCBsZW5ndGgpIHtcbiAgY29uc3Qgc2hpcCA9IHtcbiAgICBuYW1lLFxuICAgIGxlbmd0aCxcbiAgICBoaXRzOiBbXSxcbiAgICBzdW5rZW46IGZhbHNlLFxuICB9O1xuXG4gIGNvbnN0IGdldE5hbWUgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHNoaXAubmFtZTtcbiAgfTtcbiAgY29uc3QgZ2V0TGVuZ3RoID0gKCkgPT4ge1xuICAgIHJldHVybiBzaGlwLmxlbmd0aDtcbiAgfTtcbiAgY29uc3QgZ2V0SGl0cyA9ICgpID0+IHtcbiAgICByZXR1cm4gc2hpcC5oaXRzO1xuICB9O1xuICBjb25zdCBzaGlwU3RhdGUgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHNoaXAuc3Vua2VuO1xuICB9O1xuXG4gIGNvbnN0IGhpdCA9ICgpID0+IHtcbiAgICBzaGlwLmhpdHMucHVzaChcImhpdFwiKTtcbiAgICBpc1N1bmsoKTtcbiAgfTtcblxuICBjb25zdCBpc1N1bmsgPSAoKSA9PiB7XG4gICAgaWYgKHNoaXAuaGl0cy5sZW5ndGggPT0gc2hpcC5sZW5ndGgpIHJldHVybiAoc2hpcC5zdW5rZW4gPSB0cnVlKTtcbiAgfTtcblxuICByZXR1cm4geyBnZXRMZW5ndGgsIGdldE5hbWUsIGdldEhpdHMsIHNoaXBTdGF0ZSwgaGl0LCBpc1N1bmsgfTtcbn1cblxuZXhwb3J0IHsgc2hpcHMgfTtcbiIsImltcG9ydCB7IHNoaXBzIH0gZnJvbSBcIi4vU2hpcHNcIjtcbmZ1bmN0aW9uIGdhbWVCb2FyZCgpIHtcbiAgY29uc3QgZ2FtZWJvYXJkID0ge1xuICAgIGJvYXJkOiBBcnJheSgxMDApLmZpbGwoeyBoYXNTaGlwOiBmYWxzZSwgaXNIaXQ6IGZhbHNlIH0pLFxuICAgIGZsZWV0OiBbXG4gICAgICBzaGlwcyhcImNhcnJpZXJcIiwgNSksXG4gICAgICBzaGlwcyhcImJhdHRsZXNoaXBcIiwgNCksXG4gICAgICBzaGlwcyhcImNydWlzZXJcIiwgMyksXG4gICAgICBzaGlwcyhcInN1Ym1hcmluZVwiLCAzKSxcbiAgICAgIHNoaXBzKFwiZGVzdHJveWVyXCIsIDIpLFxuICAgIF0sXG4gICAgbG9jYXRpb25zOiBbXSxcbiAgfTtcblxuICBjb25zdCBnZXRCb2FyZCA9ICgpID0+IHtcbiAgICByZXR1cm4gZ2FtZWJvYXJkLmJvYXJkO1xuICB9O1xuXG4gIGNvbnN0IGdldFNoaXBMb2NhdGlvbnMgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGdhbWVib2FyZC5sb2NhdGlvbnMubWFwKChzaGlwKSA9PiBzaGlwLmxvY2F0aW9uKS5mbGF0KCk7XG4gIH07XG5cbiAgY29uc3QgZ2V0RmxlZXQgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGdhbWVib2FyZC5mbGVldDtcbiAgfTtcblxuICBjb25zdCBzaGlwTG9jYXRpb24gPSAob3JpZW50YXRpb24sIHN0YXJ0aW5nUG9zaXRpb24sIHNoaXApID0+IHtcbiAgICAvLyByZXR1cm5zIGFuIGFycmF5IG9mIG51bWJlcnMgdGhhdCByZXByZXNlbnQgaW5kZXhlcyBvbiB0aGUgYm9hcmRcbiAgICBjb25zdCBsb2NhdGlvbiA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcC5nZXRMZW5ndGgoKTsgaSsrKSB7XG4gICAgICBvcmllbnRhdGlvbiA9PT0gXCJob3Jpem9udGFsXCJcbiAgICAgICAgPyBsb2NhdGlvbi5wdXNoKHN0YXJ0aW5nUG9zaXRpb24gKyBpKVxuICAgICAgICA6IGxvY2F0aW9uLnB1c2goc3RhcnRpbmdQb3NpdGlvbiArIGkgKiAxMCk7XG4gICAgfVxuICAgIHJldHVybiBsb2NhdGlvbjtcbiAgfTtcblxuICBjb25zdCBzaGlwUGxhY2VtZW50ID0gKG9yaWVudGF0aW9uLCBzdGFydGluZ1Bvc2l0aW9uLCBTaGlwKSA9PiB7XG4gICAgY29uc3Qgc2hpcE5hbWUgPSBTaGlwLmdldE5hbWUoKTtcbiAgICBjb25zdCBsb2NhdGlvbiA9IHNoaXBMb2NhdGlvbihvcmllbnRhdGlvbiwgc3RhcnRpbmdQb3NpdGlvbiwgU2hpcCk7XG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCBsb2NhdGlvbi5sZW5ndGg7IGorKykge1xuICAgICAgZ2FtZWJvYXJkLmJvYXJkLnNwbGljZShsb2NhdGlvbltqXSwgMSwge1xuICAgICAgICBoYXNTaGlwOiB0cnVlLFxuICAgICAgICBpc0hpdDogZmFsc2UsXG4gICAgICAgIHNoaXA6IFNoaXAsXG4gICAgICB9KTtcbiAgICB9XG4gICAgZ2FtZWJvYXJkLmxvY2F0aW9ucy5wdXNoKHsgc2hpcE5hbWUsIGxvY2F0aW9uIH0pO1xuICAgIHJldHVybiBsb2NhdGlvbjtcbiAgfTtcblxuICBjb25zdCBjaGVja0ZvclZhbGlkUGxhY2VtZW50ID0gKGxvY2F0aW9uQXJyYXkpID0+IHtcbiAgICBjb25zdCBjb2xsaXNpb25zID0gWzksIDE5LCAyOSwgMzksIDQ5LCA1OSwgNjksIDc5LCA4OV07XG4gICAgaWYgKGxvY2F0aW9uQXJyYXkuc29tZSgobG9jKSA9PiAhZ2FtZWJvYXJkLmJvYXJkW2xvY10pKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBlbHNlIGlmIChsb2NhdGlvbkFycmF5LnNvbWUoKGxvYykgPT4gZ2FtZWJvYXJkLmJvYXJkW2xvY10uaGFzU2hpcCkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgY29sbGlzaW9ucy5zb21lKChudW0pID0+IHtcbiAgICAgICAgcmV0dXJuIFtudW0sIG51bSArIDFdLmV2ZXJ5KChjb21iaW5hdGlvbikgPT5cbiAgICAgICAgICBsb2NhdGlvbkFycmF5LmluY2x1ZGVzKGNvbWJpbmF0aW9uKVxuICAgICAgICApO1xuICAgICAgfSlcbiAgICApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHJhbmRvbVNoaXBQbGFjZW1lbnQgPSAoc2hpcCkgPT4ge1xuICAgIGxldCBhbGxQb3NzaWJsZUxvY2F0aW9ucyA9IFtdO1xuXG4gICAgLy8gcmV0dXJucyBhIHJhbmRvbSBvcmllbnRhdGlvblxuXG4gICAgY29uc3QgcmFuZG9tT3JpZW50YXRpb24gPSAoKSA9PlxuICAgICAgW1wiaG9yaXpcIiwgXCJ2ZXJ0XCJdW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpXTtcblxuICAgIC8vIGZpbmRzIGFsbCBwb3NzaWJsZSBsb2NhdGlvbnMgYSBzaGlwIGNhbiBiZSBwbGFjZWQgYXRcblxuICAgIGNvbnN0IGZpbmRBbGxQb3NzaWJsZUxvY2F0aW9ucyA9IChvcmllbnRhdGlvbikgPT4ge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDAgLSBzaGlwLmdldExlbmd0aCgpOyBpKyspIHtcbiAgICAgICAgbGV0IGxvY2F0aW9uQXJyYXkgPSBbXTtcblxuICAgICAgICBpZiAob3JpZW50YXRpb24gPT09IFwiaG9yaXpcIilcbiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHNoaXAuZ2V0TGVuZ3RoKCk7IGorKykge1xuICAgICAgICAgICAgbG9jYXRpb25BcnJheS5wdXNoKGkgKyBqKTtcbiAgICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHNoaXAuZ2V0TGVuZ3RoKCk7IGorKykge1xuICAgICAgICAgICAgbG9jYXRpb25BcnJheS5wdXNoKGkgKyBqICogMTApO1xuICAgICAgICAgIH1cblxuICAgICAgICAvLyBjaGVja3Mgd2hldGhlciB0aGUgY3JlYXRlZCBsb2NhdGlvbiBpcyB2YWxpZCBvciBub3RcblxuICAgICAgICBpZiAoY2hlY2tGb3JWYWxpZFBsYWNlbWVudChsb2NhdGlvbkFycmF5KSlcbiAgICAgICAgICBhbGxQb3NzaWJsZUxvY2F0aW9ucy5wdXNoKGxvY2F0aW9uQXJyYXkpO1xuICAgICAgfVxuXG4gICAgICAvLyByZXR1cm5zIG9uZSByYW5kb20gc2hpcCBsb2NhdGlvbiBvdXQgb2YgbWFueVxuXG4gICAgICByZXR1cm4gYWxsUG9zc2libGVMb2NhdGlvbnNbXG4gICAgICAgIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGFsbFBvc3NpYmxlTG9jYXRpb25zLmxlbmd0aClcbiAgICAgIF07XG4gICAgfTtcblxuICAgIGxldCBsb2NhdGlvbiA9IGZpbmRBbGxQb3NzaWJsZUxvY2F0aW9ucyhyYW5kb21PcmllbnRhdGlvbigpKTtcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IGxvY2F0aW9uLmxlbmd0aDsgaisrKSB7XG4gICAgICBnYW1lYm9hcmQuYm9hcmQuc3BsaWNlKGxvY2F0aW9uW2pdLCAxLCB7XG4gICAgICAgIGhhc1NoaXA6IHRydWUsXG4gICAgICAgIGlzSGl0OiBmYWxzZSxcbiAgICAgICAgc2hpcDogc2hpcCxcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCByZWNlaXZlQXR0YWNrID0gKGNvb3JkaW5hdGUpID0+IHtcbiAgICBpZiAoZ2FtZWJvYXJkLmJvYXJkW2Nvb3JkaW5hdGVdLmhhc1NoaXAgPT0gZmFsc2UpXG4gICAgICBnYW1lYm9hcmQuYm9hcmQuc3BsaWNlKGNvb3JkaW5hdGUsIDEsIHtcbiAgICAgICAgaGFzU2hpcDogZmFsc2UsXG4gICAgICAgIGlzSGl0OiB0cnVlLFxuICAgICAgICBtaXNzZWRTaG90OiB0cnVlLFxuICAgICAgfSk7XG4gICAgZWxzZSB7XG4gICAgICBnYW1lYm9hcmQuYm9hcmRbY29vcmRpbmF0ZV0uaXNIaXQgPSB0cnVlO1xuICAgICAgZ2FtZWJvYXJkLmJvYXJkW2Nvb3JkaW5hdGVdLnNoaXAuaGl0KCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGNoZWNrU2hpcFN0YXRlID0gKCkgPT4ge1xuICAgIHJldHVybiBnYW1lYm9hcmQuYm9hcmRcbiAgICAgIC5maWx0ZXIoKGVsKSA9PiBlbC5oYXNTaGlwKVxuICAgICAgLm1hcCgoZWwpID0+IGVsLnNoaXApXG4gICAgICAuZXZlcnkoKGVsKSA9PiBlbC5pc1N1bmsoKSk7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBnZXRCb2FyZCxcbiAgICBnZXRGbGVldCxcbiAgICBnZXRTaGlwTG9jYXRpb25zLFxuICAgIHNoaXBQbGFjZW1lbnQsXG4gICAgcmVjZWl2ZUF0dGFjayxcbiAgICBjaGVja1NoaXBTdGF0ZSxcbiAgICBjaGVja0ZvclZhbGlkUGxhY2VtZW50LFxuICAgIHJhbmRvbVNoaXBQbGFjZW1lbnQsXG4gIH07XG59XG5cbmV4cG9ydCB7IGdhbWVCb2FyZCB9O1xuIiwiaW1wb3J0IHsgYm9hcmQgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9ib2FyZFwiO1xuaW1wb3J0IHsgZ2FtZSB9IGZyb20gXCIuL2dhbWVcIjtcblxuZnVuY3Rpb24gZGlzcGxheUNvbnRyb2xsZXIoKSB7XG4gIGNvbnN0IG5hbWVTY3JlZW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci1uYW1lXCIpO1xuICBjb25zdCBuYW1lSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25hbWVcIik7XG4gIGNvbnN0IHBsYXllck5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci1ib2FyZCA+IHNwYW5cIik7XG4gIGNvbnN0IHBsYXlCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci1uYW1lID4gYnV0dG9uXCIpO1xuICBjb25zdCBib2FyZENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYm9hcmQtY29udGFpbmVyXCIpO1xuICBjb25zdCBwbGF5ZXJCb2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyLWJvYXJkID4gLmJvYXJkXCIpO1xuICBjb25zdCBwbGF5ZXJCb2FyZENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyLWJvYXJkIFwiKTtcbiAgY29uc3QgY3B1Qm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNwdS1ib2FyZCA+IC5ib2FyZFwiKTtcbiAgY29uc3QgY3B1Qm9hcmRDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNwdS1ib2FyZCBcIik7XG4gIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY29udGFpbmVyXCIpO1xuICBsZXQgR2FtZSA9IGdhbWUobmFtZUlucHV0LnZhbHVlKTtcbiAgbGV0IGF4aXMgPSBcImhvcml6b250YWxcIjtcbiAgbGV0IHNoaXBUb1BsYWNlID0gR2FtZS5nZXRTaGlwVG9QbGFjZSgpO1xuXG4gIGNvbnN0IHJlbmRlclBsYXllckJvYXJkID0gKCkgPT4ge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTAwOyBpKyspIHtcbiAgICAgIGNvbnN0IGNlbGwgPSBib2FyZChpKTtcbiAgICAgIHBsYXllckJvYXJkLmFwcGVuZENoaWxkKGNlbGwpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCByZW5kZXJDcHVCb2FyZCA9ICgpID0+IHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDsgaSsrKSB7XG4gICAgICBjb25zdCBjZWxsID0gYm9hcmQoaSk7XG4gICAgICBjcHVCb2FyZC5hcHBlbmRDaGlsZChjZWxsKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgcGxhY2VQbGF5ZXJTaGlwcyA9IChlKSA9PiB7XG4gICAgaWYgKEdhbWUuY2hlY2tJZkFsbFNoaXBzQXJlUGxhY2VkKCkpIHJldHVybjtcbiAgICBjb25zdCBjZWxsID0gZS50YXJnZXQ7XG4gICAgaWYgKGNlbGwuY2xhc3NMaXN0LmNvbnRhaW5zKFwiZW1wdHlcIikgJiYgY2VsbC5jbGFzc0xpc3QuY29udGFpbnMoXCJjZWxsXCIpKSB7XG4gICAgICBjb25zdCBzdGFydGluZ1BvcyA9IGNlbGwuZ2V0QXR0cmlidXRlKFwiaWRcIik7XG4gICAgICBpZiAoIUdhbWUuaXNWYWxpZFBsYWNlbWVudChHYW1lLnBsYWNlUGxheWVyU2hpcHMoc3RhcnRpbmdQb3MsIGF4aXMpKSlcbiAgICAgICAgcmV0dXJuO1xuICAgICAgR2FtZS5wbGFjZVBsYXllclNoaXBzKHN0YXJ0aW5nUG9zLCBheGlzKTtcbiAgICAgIHJlbmRlclNoaXBzKCk7XG4gICAgICBzaGlwVG9QbGFjZSA9IEdhbWUuZ2V0U2hpcFRvUGxhY2U7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHJlbmRlclNoaXBzID0gKCkgPT4ge1xuICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gR2FtZS5nZXRQbGF5ZXJTaGlwTG9jYXRpb25zKCk7XG4gICAgY29vcmRpbmF0ZXMuZm9yRWFjaCgoY29vcmRpbmF0ZSkgPT4ge1xuICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5jZWxsLmVtcHR5IyR7Y29vcmRpbmF0ZX1gKTtcbiAgICAgIGNlbGwuY2xhc3NMaXN0LnJlbW92ZShcImVtcHR5XCIpO1xuICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKFwiaGl0XCIpO1xuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IGJpbmRFdmVudHMgPSAoKSA9PiB7XG4gICAgcGxheUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgaWYgKG5hbWVJbnB1dC52YWx1ZSA9PSBcIlwiKSByZXR1cm47XG4gICAgICBwbGF5ZXJCb2FyZENvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZVwiKTtcbiAgICAgIHBsYXllck5hbWUudGV4dENvbnRlbnQgPSBuYW1lSW5wdXQudmFsdWU7XG4gICAgICByZW5kZXJQbGF5ZXJCb2FyZCgpO1xuICAgICAgbmFtZVNjcmVlbi5yZW1vdmUoKTtcbiAgICAgIGNvbnN0IHBsYWNlU2hpcHNUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHBsYWNlU2hpcHNUZXh0LmNsYXNzTGlzdC5hZGQoXCJwbGFjZS1zaGlwcy10ZXh0XCIpO1xuICAgICAgcGxhY2VTaGlwc1RleHQudGV4dENvbnRlbnQgPSBcIlBsYWNlIHlvdXIgc2hpcHNcIjtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChwbGFjZVNoaXBzVGV4dCk7XG4gICAgfSk7XG4gIH07XG4gIHJldHVybiB7IGJpbmRFdmVudHMgfTtcbn1cblxuZXhwb3J0IHsgZGlzcGxheUNvbnRyb2xsZXIgfTtcbiIsImltcG9ydCB7IGdhbWVCb2FyZCB9IGZyb20gXCIuLi9GYWN0b3J5RnVuY3Rpb25zL0dhbWVib2FyZFwiO1xuaW1wb3J0IHsgcGxheWVyIH0gZnJvbSBcIi4uL0ZhY3RvcnlGdW5jdGlvbnMvUGxheWVyXCI7XG5pbXBvcnQgeyBjb21wdXRlclBsYXllciB9IGZyb20gXCIuLi9GYWN0b3J5RnVuY3Rpb25zL0NvbXB1dGVyUGxheWVyXCI7XG5cbmZ1bmN0aW9uIGdhbWUobmFtZSkge1xuICBsZXQgaHVtYW5QbGF5ZXIgPSBwbGF5ZXIobmFtZSwgdHJ1ZSk7XG4gIGxldCBjcHVQbGF5ZXIgPSBjb21wdXRlclBsYXllcihmYWxzZSk7XG4gIGxldCBodW1hbkJvYXJkID0gZ2FtZUJvYXJkKCk7XG4gIGxldCBjcHVCb2FyZCA9IGdhbWVCb2FyZCgpO1xuICBsZXQgc2hpcFRvUGxhY2UgPSAwO1xuXG4gIGNvbnN0IGdldFBsYXllckZsZWV0ID0gKCkgPT4ge1xuICAgIHJldHVybiBodW1hbkJvYXJkLmdldEZsZWV0KCk7XG4gIH07XG5cbiAgY29uc3QgZ2V0UGxheWVyU2hpcExvY2F0aW9ucyA9ICgpID0+IHtcbiAgICByZXR1cm4gaHVtYW5Cb2FyZC5nZXRTaGlwTG9jYXRpb25zKCk7XG4gIH07XG5cbiAgY29uc3QgZ2V0Q1BVRmxlZXQgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGNwdUJvYXJkLmdldEZsZWV0KCk7XG4gIH07XG5cbiAgY29uc3QgZ2V0U2hpcFRvUGxhY2UgPSAoKSA9PiB7XG4gICAgY29uc3QgZmxlZXQgPSBnZXRQbGF5ZXJGbGVldCgpO1xuICAgIGNvbnN0IHNoaXAgPSBmbGVldFtzaGlwVG9QbGFjZV07XG4gICAgcmV0dXJuIHNoaXA7XG4gIH07XG5cbiAgY29uc3QgcGxhY2VDUFVTaGlwcyA9ICgpID0+IHtcbiAgICBjb25zdCBjcHVGbGVldCA9IGdldENQVUZsZWV0KCk7XG4gICAgZm9yIChsZXQgc2hpcCA9IDA7IHNoaXAgPCBjcHVGbGVldC5sZW5ndGg7IHNoaXArKylcbiAgICAgIGNwdUJvYXJkLnJhbmRvbVNoaXBQbGFjZW1lbnQoY3B1RmxlZXRbc2hpcF0pO1xuICB9O1xuXG4gIGNvbnN0IHBsYWNlUGxheWVyU2hpcHMgPSAobG9jYXRpb24sIGF4aXMpID0+IHtcbiAgICBjb25zdCBwbGF5ZXJGbGVldCA9IGdldFBsYXllckZsZWV0KCk7XG4gICAgc2hpcFRvUGxhY2UgKz0gMTtcbiAgICByZXR1cm4gaHVtYW5Cb2FyZC5zaGlwUGxhY2VtZW50KGF4aXMsIGxvY2F0aW9uLCBwbGF5ZXJGbGVldFtzaGlwVG9QbGFjZV0pO1xuICB9O1xuXG4gIGNvbnN0IGNoZWNrSWZBbGxTaGlwc0FyZVBsYWNlZCA9ICgpID0+IHtcbiAgICByZXR1cm4gZ2V0UGxheWVyRmxlZXQoKS5sZW5ndGggPT09IHNoaXBUb1BsYWNlO1xuICB9O1xuXG4gIGNvbnN0IHBsYXllckF0dGFjayA9IChjb29yZGluYXRlKSA9PiB7XG4gICAgaWYgKHBsYXllclJvbGUoKSkge1xuICAgICAgaHVtYW5QbGF5ZXIuYXR0YWNrRW5lbXkoY3B1Qm9hcmQsIGNvb3JkaW5hdGUpO1xuICAgICAgc3dpdGNoUGxheWVyc1JvbGVzKCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGNwdUF0dGFjayA9ICgpID0+IHtcbiAgICBpZiAoY3B1Um9sZSgpKSB7XG4gICAgICBjcHVQbGF5ZXIuYXR0YWNrRW5lbXkoaHVtYW5Cb2FyZCk7XG4gICAgICBzd2l0Y2hQbGF5ZXJzUm9sZXMoKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgcGxheWVyV29uID0gKCkgPT4ge1xuICAgIHJldHVybiBjcHVCb2FyZC5jaGVja1NoaXBTdGF0ZSgpO1xuICB9O1xuXG4gIGNvbnN0IGNwdVdvbiA9ICgpID0+IHtcbiAgICByZXR1cm4gaHVtYW5Cb2FyZC5jaGVja1NoaXBTdGF0ZSgpO1xuICB9O1xuXG4gIGNvbnN0IHBsYXllclJvbGUgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGh1bWFuUGxheWVyLndob0lzUGxheWluZygpO1xuICB9O1xuXG4gIGNvbnN0IGNwdVJvbGUgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGNwdVBsYXllci53aG9Jc1BsYXlpbmcoKTtcbiAgfTtcblxuICBjb25zdCBzd2l0Y2hQbGF5ZXJzUm9sZXMgPSAoKSA9PiB7XG4gICAgaWYgKHBsYXllclJvbGUoKSkge1xuICAgICAgaHVtYW5QbGF5ZXIuc3dpdGNoUm9sZXMoKTtcbiAgICAgIGNwdVBsYXllci5zd2l0Y2hSb2xlcygpO1xuICAgIH0gZWxzZSB7XG4gICAgICBodW1hblBsYXllci5zd2l0Y2hSb2xlcygpO1xuICAgICAgY3B1UGxheWVyLnN3aXRjaFJvbGVzKCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGlzVmFsaWRQbGFjZW1lbnQgPSAobG9jYXRpb24pID0+IHtcbiAgICBodW1hbkJvYXJkLmNoZWNrRm9yVmFsaWRQbGFjZW1lbnQobG9jYXRpb24pO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgZ2V0UGxheWVyRmxlZXQsXG4gICAgZ2V0UGxheWVyU2hpcExvY2F0aW9ucyxcbiAgICBnZXRDUFVGbGVldCxcbiAgICBwbGFjZUNQVVNoaXBzLFxuICAgIGdldFNoaXBUb1BsYWNlLFxuICAgIHBsYWNlUGxheWVyU2hpcHMsXG4gICAgY2hlY2tJZkFsbFNoaXBzQXJlUGxhY2VkLFxuICAgIHBsYXllckF0dGFjayxcbiAgICBjcHVBdHRhY2ssXG4gICAgcGxheWVyV29uLFxuICAgIGNwdVdvbixcbiAgICBwbGF5ZXJSb2xlLFxuICAgIGNwdVJvbGUsXG4gICAgc3dpdGNoUGxheWVyc1JvbGVzLFxuICAgIGlzVmFsaWRQbGFjZW1lbnQsXG4gIH07XG59XG5cbmV4cG9ydCB7IGdhbWUgfTtcbiIsImltcG9ydCB7IGdhbWVCb2FyZCB9IGZyb20gXCIuL0dhbWVib2FyZFwiO1xuZnVuY3Rpb24gcGxheWVyKG5hbWUsIHBsYXlpbmcpIHtcbiAgY29uc3QgcGxheWVySW5mbyA9IHtcbiAgICBuYW1lLFxuICAgIGJvYXJkOiBnYW1lQm9hcmQoKSxcbiAgICBwbGF5aW5nLFxuICB9O1xuXG4gIGNvbnN0IHdob0lzUGxheWluZyA9ICgpID0+IHtcbiAgICByZXR1cm4gcGxheWVySW5mby5wbGF5aW5nO1xuICB9O1xuXG4gIGNvbnN0IHN3aXRjaFJvbGVzID0gKCkgPT4ge1xuICAgIHJldHVybiAocGxheWVySW5mby5wbGF5aW5nID0gIXBsYXllckluZm8ucGxheWluZyk7XG4gIH07XG5cbiAgY29uc3QgZ2V0TmFtZSA9ICgpID0+IHtcbiAgICByZXR1cm4gcGxheWVySW5mby5uYW1lO1xuICB9O1xuXG4gIGNvbnN0IHNldE5hbWUgPSAodmFsdWUpID0+IHtcbiAgICByZXR1cm4gKHBsYXllckluZm8ubmFtZSA9IHZhbHVlKTtcbiAgfTtcblxuICBjb25zdCBhdHRhY2tFbmVteSA9IChlbmVteUJvYXJkLCBzaG90KSA9PiB7XG4gICAgZW5lbXlCb2FyZC5yZWNlaXZlQXR0YWNrKHNob3QpO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgZ2V0TmFtZSxcbiAgICBzZXROYW1lLFxuICAgIGF0dGFja0VuZW15LFxuICAgIHdob0lzUGxheWluZyxcbiAgICBzd2l0Y2hSb2xlcyxcbiAgfTtcbn1cblxuZXhwb3J0IHsgcGxheWVyIH07XG4iLCJpbXBvcnQgeyBnYW1lQm9hcmQgfSBmcm9tIFwiLi9HYW1lYm9hcmRcIjtcbmZ1bmN0aW9uIGNvbXB1dGVyUGxheWVyKHBsYXlpbmcpIHtcbiAgY29uc3QgcGxheWVySW5mbyA9IHtcbiAgICBuYW1lOiBcImNvbXB1dGVyXCIsXG4gICAgYm9hcmQ6IGdhbWVCb2FyZCgpLFxuICAgIHBsYXlpbmcsXG4gICAgc2hvdHNGaXJlZDogW10sXG4gIH07XG5cbiAgY29uc3Qgd2hvSXNQbGF5aW5nID0gKCkgPT4ge1xuICAgIHJldHVybiBwbGF5ZXJJbmZvLnBsYXlpbmc7XG4gIH07XG5cbiAgY29uc3Qgc3dpdGNoUm9sZXMgPSAoKSA9PiB7XG4gICAgcmV0dXJuIChwbGF5ZXJJbmZvLnBsYXlpbmcgPSAhcGxheWVySW5mby5wbGF5aW5nKTtcbiAgfTtcblxuICBjb25zdCBnZXROYW1lID0gKCkgPT4ge1xuICAgIHJldHVybiBwbGF5ZXJJbmZvLm5hbWU7XG4gIH07XG5cbiAgY29uc3QgcmFuZG9tSW5kZXggPSAoKSA9PiB7XG4gICAgbGV0IGluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwKTtcbiAgICBpZiAoY2hlY2tSYW5kb21JbmRleChpbmRleCwgcGxheWVySW5mby5zaG90c0ZpcmVkKSlcbiAgICAgIHBsYXllckluZm8uc2hvdHNGaXJlZC5wdXNoKGluZGV4KTtcbiAgICBpZiAoIWNoZWNrUmFuZG9tSW5kZXgoaW5kZXgsIHBsYXllckluZm8uc2hvdHNGaXJlZCkpIHJldHVybiByYW5kb21JbmRleCgpO1xuICAgIHJldHVybiBpbmRleDtcbiAgfTtcblxuICBjb25zdCBjaGVja1JhbmRvbUluZGV4ID0gKHZhbHVlLCBhcnJheSkgPT4ge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICh2YWx1ZSA9PSBhcnJheVtpXSkgcmV0dXJuIGZhbHNlO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGF0dGFja0VuZW15ID0gKGVuZW15Qm9hcmQpID0+IHtcbiAgICBlbmVteUJvYXJkLnJlY2VpdmVBdHRhY2socmFuZG9tSW5kZXgoKSk7XG4gIH07XG5cbiAgcmV0dXJuIHsgZ2V0TmFtZSwgYXR0YWNrRW5lbXksIHdob0lzUGxheWluZywgc3dpdGNoUm9sZXMgfTtcbn1cbmV4cG9ydCB7IGNvbXB1dGVyUGxheWVyIH07XG4iLCJpbXBvcnQgeyBkaXNwbGF5Q29udHJvbGxlciB9IGZyb20gXCIuL01vZHVsZXMvZGlzcGxheUNvbnRyb2xsZXJcIjtcbmRpc3BsYXlDb250cm9sbGVyKCkuYmluZEV2ZW50cygpO1xuIl0sIm5hbWVzIjpbImJvYXJkIiwiaWQiLCJjZWxsIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwic2V0QXR0cmlidXRlIiwic2hpcHMiLCJuYW1lIiwibGVuZ3RoIiwic2hpcCIsImhpdHMiLCJzdW5rZW4iLCJpc1N1bmsiLCJnZXRMZW5ndGgiLCJnZXROYW1lIiwiZ2V0SGl0cyIsInNoaXBTdGF0ZSIsImhpdCIsInB1c2giLCJnYW1lQm9hcmQiLCJnYW1lYm9hcmQiLCJBcnJheSIsImZpbGwiLCJoYXNTaGlwIiwiaXNIaXQiLCJmbGVldCIsImxvY2F0aW9ucyIsImNoZWNrRm9yVmFsaWRQbGFjZW1lbnQiLCJsb2NhdGlvbkFycmF5Iiwic29tZSIsImxvYyIsIm51bSIsImV2ZXJ5IiwiY29tYmluYXRpb24iLCJpbmNsdWRlcyIsImdldEJvYXJkIiwiZ2V0RmxlZXQiLCJnZXRTaGlwTG9jYXRpb25zIiwibWFwIiwibG9jYXRpb24iLCJmbGF0Iiwic2hpcFBsYWNlbWVudCIsIm9yaWVudGF0aW9uIiwic3RhcnRpbmdQb3NpdGlvbiIsIlNoaXAiLCJzaGlwTmFtZSIsImkiLCJzaGlwTG9jYXRpb24iLCJqIiwic3BsaWNlIiwicmVjZWl2ZUF0dGFjayIsImNvb3JkaW5hdGUiLCJtaXNzZWRTaG90IiwiY2hlY2tTaGlwU3RhdGUiLCJmaWx0ZXIiLCJlbCIsInJhbmRvbVNoaXBQbGFjZW1lbnQiLCJhbGxQb3NzaWJsZUxvY2F0aW9ucyIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImZpbmRBbGxQb3NzaWJsZUxvY2F0aW9ucyIsIm5hbWVTY3JlZW4iLCJxdWVyeVNlbGVjdG9yIiwibmFtZUlucHV0IiwicGxheWVyTmFtZSIsInBsYXlCdXR0b24iLCJwbGF5ZXJCb2FyZCIsInBsYXllckJvYXJkQ29udGFpbmVyIiwiY29udGFpbmVyIiwiaHVtYW5QbGF5ZXIiLCJwbGF5aW5nIiwicGxheWVySW5mbyIsInNldE5hbWUiLCJ2YWx1ZSIsImF0dGFja0VuZW15IiwiZW5lbXlCb2FyZCIsInNob3QiLCJ3aG9Jc1BsYXlpbmciLCJzd2l0Y2hSb2xlcyIsInBsYXllciIsImNwdVBsYXllciIsInNob3RzRmlyZWQiLCJyYW5kb21JbmRleCIsImluZGV4IiwiY2hlY2tSYW5kb21JbmRleCIsImFycmF5IiwiY29tcHV0ZXJQbGF5ZXIiLCJodW1hbkJvYXJkIiwiY3B1Qm9hcmQiLCJzaGlwVG9QbGFjZSIsImdldFBsYXllckZsZWV0IiwiZ2V0Q1BVRmxlZXQiLCJwbGF5ZXJSb2xlIiwiY3B1Um9sZSIsInN3aXRjaFBsYXllcnNSb2xlcyIsImdldFBsYXllclNoaXBMb2NhdGlvbnMiLCJwbGFjZUNQVVNoaXBzIiwiY3B1RmxlZXQiLCJnZXRTaGlwVG9QbGFjZSIsInBsYWNlUGxheWVyU2hpcHMiLCJheGlzIiwicGxheWVyRmxlZXQiLCJjaGVja0lmQWxsU2hpcHNBcmVQbGFjZWQiLCJwbGF5ZXJBdHRhY2siLCJjcHVBdHRhY2siLCJwbGF5ZXJXb24iLCJjcHVXb24iLCJpc1ZhbGlkUGxhY2VtZW50IiwiZ2FtZSIsImJpbmRFdmVudHMiLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlIiwidGV4dENvbnRlbnQiLCJhcHBlbmRDaGlsZCIsInJlbmRlclBsYXllckJvYXJkIiwicGxhY2VTaGlwc1RleHQiLCJkaXNwbGF5Q29udHJvbGxlciJdLCJzb3VyY2VSb290IjoiIn0=