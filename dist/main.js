(()=>{"use strict";function e(e){const t=document.createElement("div");return t.classList.add("empty"),t.classList.add("cell"),t.setAttribute("coordinate",`${e}`),t}function t(e,t){const r={name:e,length:t,hits:[],sunken:!1},a=()=>{if(r.hits.length==r.length)return r.sunken=!0};return{getLength:()=>r.length,getName:()=>r.name,getHits:()=>r.hits,shipState:()=>r.sunken,hit:()=>{r.hits.push("hit"),a()},isSunk:a,length:t}}function r(){const e={board:Array(100).fill({hasShip:!1,isHit:!1}),fleet:[t("carrier",5),t("battleship",4),t("cruiser",3),t("submarine",3),t("destroyer",2)],locations:[]},r=t=>!t.some((t=>!e.board[t]))&&!t.some((t=>e.board[t].hasShip))&&![9,19,29,39,49,59,69,79,89].some((e=>[e,e+1].every((e=>t.includes(e)))));return{getBoard:()=>e.board,getFleet:()=>e.fleet,getShipLocations:()=>e.locations.flat(),shipPlacement:(t,r,a)=>{const n=((e,t,r)=>{const a=[];for(let n=0;n<r.getLength();n++)"horizontal"===e?a.push(t+n):a.push(t+10*n);return a})(t,r,a);for(let t=0;t<n.length;t++)e.board.splice(n[t],1,{hasShip:!0,isHit:!1,ship:a});return e.locations.push(n),n},receiveAttack:t=>{0==e.board[t].hasShip?e.board.splice(t,1,{hasShip:!1,isHit:!0,missedShot:!0}):(e.board[t].isHit=!0,e.board[t].ship.hit())},checkShipState:()=>e.board.filter((e=>e.hasShip)).map((e=>e.ship)).every((e=>e.isSunk())),checkForValidPlacement:r,randomShipPlacement:t=>{let a=[],n=(e=>{for(let n=0;n<100-t.getLength();n++){let o=[];if("horiz"===e)for(let e=0;e<t.getLength();e++)o.push(n+e);else for(let e=0;e<t.getLength();e++)o.push(n+10*e);r(o)&&a.push(o)}return a[Math.floor(Math.random()*a.length)]})(["horiz","vert"][Math.floor(2*Math.random())]);for(let r=0;r<n.length;r++)e.board.splice(n[r],1,{hasShip:!0,isHit:!1,ship:t})}}}(function(){const t=document.querySelector(".player-name"),a=document.querySelector("#name"),n=document.querySelector(".player-board > span"),o=document.querySelector(".player-name > button"),c=(document.querySelector(".board-container"),document.querySelector(".player-board > .board")),i=document.querySelector(".player-board "),l=(document.querySelector(".cpu-board > .board"),document.querySelector(".cpu-board "),document.querySelector(".container"));document.querySelector(".axis"),document.querySelector(".start");let s=function(e){let t=function(e,t){const a={name:e,board:r(),playing:!0};return{getName:()=>a.name,setName:e=>a.name=e,attackEnemy:(e,t)=>{e.receiveAttack(t)},whoIsPlaying:()=>a.playing,switchRoles:()=>a.playing=!a.playing}}(e),a=function(e){const t={name:"computer",board:r(),playing:!1,shotsFired:[]},a=()=>{let e=Math.floor(100*Math.random());return n(e,t.shotsFired)&&t.shotsFired.push(e),n(e,t.shotsFired)?e:a()},n=(e,t)=>{for(let r=0;r<t.length;r++)return e!=t[r]};return{getName:()=>t.name,attackEnemy:e=>{e.receiveAttack(a())},whoIsPlaying:()=>t.playing,switchRoles:()=>t.playing=!t.playing}}(),n=r(),o=r(),c=0;const i=()=>n.getFleet(),l=()=>o.getFleet(),s=()=>t.whoIsPlaying(),h=()=>a.whoIsPlaying(),u=()=>{s(),t.switchRoles(),a.switchRoles()};return{getPlayerFleet:i,getPlayerName:()=>t.getName(),getPlayerShipLocations:()=>n.getShipLocations(),getCPUFleet:l,placeCPUShips:()=>{const e=l();for(let t=0;t<e.length;t++)o.randomShipPlacement(e[t])},getShipToPlace:()=>i()[c],placePlayerShips:(e,t)=>{const r=i();n.shipPlacement(t,e,r[c]),c+=1},checkIfAllShipsArePlaced:()=>i().length===c,playerAttack:e=>{s()&&(t.attackEnemy(o,e),u())},cpuAttack:()=>{h()&&(a.attackEnemy(n),u())},playerWon:()=>o.checkShipState(),cpuWon:()=>n.checkShipState(),playerRole:s,cpuRole:h,switchPlayersRoles:u,isValidPlacement:e=>n.checkForValidPlacement(e)}}(a.value),h=s.getShipToPlace();const u=e=>{const t=[];for(let r=0;r<h.getLength();r++)t.push(e+r);return t};return{bindEvents:()=>{o.addEventListener("click",(()=>{if(""==a.value)return;i.classList.remove("hide"),n.textContent=a.value,(()=>{for(let t=0;t<100;t++){const r=e(t);c.appendChild(r)}})(),t.remove();const r=document.createElement("div");r.classList.add("place-ships-text"),r.textContent="Place your ships",l.appendChild(r)})),c.addEventListener("mouseout",(e=>{if(s.checkIfAllShipsArePlaced())return;const t=e.target,r=Number(t.getAttribute("coordinate"));u(r).forEach((e=>{const t=c.querySelector(`.empty.cell[coordinate="${e}"]`);t&&t.classList.remove("hover")}))})),c.addEventListener("mouseover",(e=>{if(s.checkIfAllShipsArePlaced())return;const t=e.target;if(t.classList.contains("cell","empty")){const e=Number(t.getAttribute("coordinate")),a=u(e);if(r=a,[9,19,29,39,49,59,69,79,89,99].some((e=>[e,e+1].every((e=>r.includes(e))))))return;a.forEach((e=>{const t=c.querySelector(`.empty.cell[coordinate="${e}"]`);t&&t.classList.add("hover")}))}var r})),c.addEventListener("click",(e=>{if(s.checkIfAllShipsArePlaced())return;const t=e.target;if(t.classList.contains("cell","empty")){const e=Number(t.getAttribute("coordinate")),r=u(e);if(!s.isValidPlacement(r))return;s.placePlayerShips(e,"horizontal"),s.getPlayerShipLocations().forEach((e=>{document.querySelector(`.cell.empty[coordinate="${e}"]`).classList.add("placed")})),h=s.getShipToPlace()}}))}}})().bindEvents()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoibUJBQUEsU0FBU0EsRUFBTUMsR0FDYixNQUFNQyxFQUFPQyxTQUFTQyxjQUFjLE9BSXBDLE9BSEFGLEVBQUtHLFVBQVVDLElBQUksU0FDbkJKLEVBQUtHLFVBQVVDLElBQUksUUFDbkJKLEVBQUtLLGFBQWEsYUFBYyxHQUFHTixLQUM1QkMsRUNMVCxTQUFTTSxFQUFNQyxFQUFNQyxHQUNuQixNQUFNQyxFQUFPLENBQ1hGLEtBQUFBLEVBQ0FDLE9BQUFBLEVBQ0FFLEtBQU0sR0FDTkMsUUFBUSxHQXFCSkMsRUFBUyxLQUNiLEdBQUlILEVBQUtDLEtBQUtGLFFBQVVDLEVBQUtELE9BQVEsT0FBUUMsRUFBS0UsUUFBUyxHQUc3RCxNQUFPLENBQUVFLFVBbkJTLElBQ1RKLEVBQUtELE9Ba0JNTSxRQXRCSixJQUNQTCxFQUFLRixLQXFCZVEsUUFoQmIsSUFDUE4sRUFBS0MsS0Fld0JNLFVBYnBCLElBQ1RQLEVBQUtFLE9BWW1DTSxJQVRyQyxLQUNWUixFQUFLQyxLQUFLUSxLQUFLLE9BQ2ZOLEtBT29EQSxPQUFBQSxFQUFRSixPQUFBQSxHQzdCaEUsU0FBU1csSUFDUCxNQUFNQyxFQUFZLENBQ2hCdEIsTUFBT3VCLE1BQU0sS0FBS0MsS0FBSyxDQUFFQyxTQUFTLEVBQU9DLE9BQU8sSUFDaERDLE1BQU8sQ0FDTG5CLEVBQU0sVUFBVyxHQUNqQkEsRUFBTSxhQUFjLEdBQ3BCQSxFQUFNLFVBQVcsR0FDakJBLEVBQU0sWUFBYSxHQUNuQkEsRUFBTSxZQUFhLElBRXJCb0IsVUFBVyxJQXVDUEMsRUFBMEJDLElBRTFCQSxFQUFjQyxNQUFNQyxJQUFTVixFQUFVdEIsTUFBTWdDLE9BRXRDRixFQUFjQyxNQUFNQyxHQUFRVixFQUFVdEIsTUFBTWdDLEdBQUtQLFlBSHpDLENBQUMsRUFBRyxHQUFJLEdBQUksR0FBSSxHQUFJLEdBQUksR0FBSSxHQUFJLElBTXRDTSxNQUFNRSxHQUNSLENBQUNBLEVBQUtBLEVBQU0sR0FBR0MsT0FBT0MsR0FDM0JMLEVBQWNNLFNBQVNELE9BNEUvQixNQUFPLENBQ0xFLFNBMUhlLElBQ1JmLEVBQVV0QixNQTBIakJzQyxTQW5IZSxJQUNSaEIsRUFBVUssTUFtSGpCWSxpQkF4SHVCLElBQ2hCakIsRUFBVU0sVUFBVVksT0F3SDNCQyxjQXRHb0IsQ0FBQ0MsRUFBYUMsRUFBa0JDLEtBQ3BELE1BQU1DLEVBWmEsRUFBQ0gsRUFBYUMsRUFBa0JoQyxLQUVuRCxNQUFNa0MsRUFBVyxHQUNqQixJQUFLLElBQUlDLEVBQUksRUFBR0EsRUFBSW5DLEVBQUtJLFlBQWErQixJQUNwQixlQUFoQkosRUFDSUcsRUFBU3pCLEtBQUt1QixFQUFtQkcsR0FDakNELEVBQVN6QixLQUFLdUIsRUFBdUIsR0FBSkcsR0FFdkMsT0FBT0QsR0FJVUUsQ0FBYUwsRUFBYUMsRUFBa0JDLEdBQzdELElBQUssSUFBSUksRUFBSSxFQUFHQSxFQUFJSCxFQUFTbkMsT0FBUXNDLElBQ25DMUIsRUFBVXRCLE1BQU1pRCxPQUFPSixFQUFTRyxHQUFJLEVBQUcsQ0FDckN2QixTQUFTLEVBQ1RDLE9BQU8sRUFDUGYsS0FBTWlDLElBSVYsT0FEQXRCLEVBQVVNLFVBQVVSLEtBQUt5QixHQUNsQkEsR0E2RlBLLGNBekJxQkMsSUFDc0IsR0FBdkM3QixFQUFVdEIsTUFBTW1ELEdBQVkxQixRQUM5QkgsRUFBVXRCLE1BQU1pRCxPQUFPRSxFQUFZLEVBQUcsQ0FDcEMxQixTQUFTLEVBQ1RDLE9BQU8sRUFDUDBCLFlBQVksS0FHZDlCLEVBQVV0QixNQUFNbUQsR0FBWXpCLE9BQVEsRUFDcENKLEVBQVV0QixNQUFNbUQsR0FBWXhDLEtBQUtRLFFBaUJuQ2tDLGVBYnFCLElBQ2QvQixFQUFVdEIsTUFDZHNELFFBQVFDLEdBQU9BLEVBQUc5QixVQUNsQitCLEtBQUtELEdBQU9BLEVBQUc1QyxPQUNmdUIsT0FBT3FCLEdBQU9BLEVBQUd6QyxXQVVwQmUsdUJBQUFBLEVBQ0E0QixvQkExRTJCOUMsSUFDM0IsSUFBSStDLEVBQXVCLEdBbUN2QmIsRUExQjZCLENBQUNILElBQ2hDLElBQUssSUFBSUksRUFBSSxFQUFHQSxFQUFJLElBQU1uQyxFQUFLSSxZQUFhK0IsSUFBSyxDQUMvQyxJQUFJaEIsRUFBZ0IsR0FFcEIsR0FBb0IsVUFBaEJZLEVBQ0YsSUFBSyxJQUFJTSxFQUFJLEVBQUdBLEVBQUlyQyxFQUFLSSxZQUFhaUMsSUFDcENsQixFQUFjVixLQUFLMEIsRUFBSUUsUUFHekIsSUFBSyxJQUFJQSxFQUFJLEVBQUdBLEVBQUlyQyxFQUFLSSxZQUFhaUMsSUFDcENsQixFQUFjVixLQUFLMEIsRUFBUSxHQUFKRSxHQUt2Qm5CLEVBQXVCQyxJQUN6QjRCLEVBQXFCdEMsS0FBS1UsR0FLOUIsT0FBTzRCLEVBQ0xDLEtBQUtDLE1BQU1ELEtBQUtFLFNBQVdILEVBQXFCaEQsVUFJckNvRCxDQTlCYixDQUFDLFFBQVMsUUFBUUgsS0FBS0MsTUFBc0IsRUFBaEJELEtBQUtFLFlBK0JwQyxJQUFLLElBQUliLEVBQUksRUFBR0EsRUFBSUgsRUFBU25DLE9BQVFzQyxJQUNuQzFCLEVBQVV0QixNQUFNaUQsT0FBT0osRUFBU0csR0FBSSxFQUFHLENBQ3JDdkIsU0FBUyxFQUNUQyxPQUFPLEVBQ1BmLEtBQU1BLE9DM0dkLFdBQ0UsTUFBTW9ELEVBQWE1RCxTQUFTNkQsY0FBYyxnQkFDcENDLEVBQVk5RCxTQUFTNkQsY0FBYyxTQUNuQ0UsRUFBYS9ELFNBQVM2RCxjQUFjLHdCQUNwQ0csRUFBYWhFLFNBQVM2RCxjQUFjLHlCQUVwQ0ksR0FEaUJqRSxTQUFTNkQsY0FBYyxvQkFDMUI3RCxTQUFTNkQsY0FBYywyQkFDckNLLEVBQXVCbEUsU0FBUzZELGNBQWMsa0JBRzlDTSxHQUZXbkUsU0FBUzZELGNBQWMsdUJBQ2Q3RCxTQUFTNkQsY0FBYyxlQUMvQjdELFNBQVM2RCxjQUFjLGVBQ3RCN0QsU0FBUzZELGNBQWMsU0FDdEI3RCxTQUFTNkQsY0FBYyxVQUMzQyxJQUFJTyxFQ1pOLFNBQWM5RCxHQUNaLElBQUkrRCxFQ0pOLFNBQWdCL0QsRUFBTWdFLEdBQ3BCLE1BQU1DLEVBQWEsQ0FDakJqRSxLQUFBQSxFQUNBVCxNQUFPcUIsSUFDUG9ELFNEQTZCLEdDdUIvQixNQUFPLENBQ0x6RCxRQWJjLElBQ1AwRCxFQUFXakUsS0FhbEJrRSxRQVZlQyxHQUNQRixFQUFXakUsS0FBT21FLEVBVTFCQyxZQVBrQixDQUFDQyxFQUFZQyxLQUMvQkQsRUFBVzVCLGNBQWM2QixJQU96QkMsYUF4Qm1CLElBQ1pOLEVBQVdELFFBd0JsQlEsWUFyQmtCLElBQ1ZQLEVBQVdELFNBQVdDLEVBQVdELFNEUnpCUyxDQUFPekUsR0FDckIwRSxFRUxOLFNBQXdCVixHQUN0QixNQUFNQyxFQUFhLENBQ2pCakUsS0FBTSxXQUNOVCxNQUFPcUIsSUFDUG9ELFNGQzZCLEVFQTdCVyxXQUFZLElBZVJDLEVBQWMsS0FDbEIsSUFBSUMsRUFBUTNCLEtBQUtDLE1BQXNCLElBQWhCRCxLQUFLRSxVQUc1QixPQUZJMEIsRUFBaUJELEVBQU9aLEVBQVdVLGFBQ3JDVixFQUFXVSxXQUFXaEUsS0FBS2tFLEdBQ3hCQyxFQUFpQkQsRUFBT1osRUFBV1UsWUFDakNFLEVBRHFERCxLQUl4REUsRUFBbUIsQ0FBQ1gsRUFBT1ksS0FDL0IsSUFBSyxJQUFJMUMsRUFBSSxFQUFHQSxFQUFJMEMsRUFBTTlFLE9BQVFvQyxJQUNoQyxPQUFJOEIsR0FBU1ksRUFBTTFDLElBU3ZCLE1BQU8sQ0FBRTlCLFFBdkJPLElBQ1AwRCxFQUFXakUsS0FzQkZvRSxZQUpHQyxJQUNuQkEsRUFBVzVCLGNBQWNtQyxNQUdJTCxhQS9CVixJQUNaTixFQUFXRCxRQThCeUJRLFlBM0J6QixJQUNWUCxFQUFXRCxTQUFXQyxFQUFXRCxTRlIzQmdCLEdBQ1pDLEVBQWFyRSxJQUNic0UsRUFBV3RFLElBQ1h1RSxFQUFjLEVBRWxCLE1BQU1DLEVBQWlCLElBQ2RILEVBQVdwRCxXQVdkd0QsRUFBYyxJQUNYSCxFQUFTckQsV0ErQ1p5RCxFQUFhLElBQ1Z2QixFQUFZUSxlQUdmZ0IsRUFBVSxJQUNQYixFQUFVSCxlQUdiaUIsRUFBcUIsS0FDckJGLElBQ0Z2QixFQUFZUyxjQUNaRSxFQUFVRixlQVdkLE1BQU8sQ0FDTFksZUFBQUEsRUFDQUssY0FoRm9CLElBQ2IxQixFQUFZeEQsVUFnRm5CbUYsdUJBN0U2QixJQUN0QlQsRUFBV25ELG1CQTZFbEJ1RCxZQUFBQSxFQUNBTSxjQWpFb0IsS0FDcEIsTUFBTUMsRUFBV1AsSUFDakIsSUFBSyxJQUFJbkYsRUFBTyxFQUFHQSxFQUFPMEYsRUFBUzNGLE9BQVFDLElBQ3pDZ0YsRUFBU2xDLG9CQUFvQjRDLEVBQVMxRixLQStEeEMyRixlQXhFcUIsSUFDUFQsSUFDS0QsR0F1RW5CVyxpQkE3RHVCLENBQUMxRCxFQUFVMkQsS0FDbEMsTUFBTUMsRUFBY1osSUFDcEJILEVBQVdqRCxjQUFjK0QsRUFBTTNELEVBQVU0RCxFQUFZYixJQUNyREEsR0FBZSxHQTJEZmMseUJBeEQrQixJQUN4QmIsSUFBaUJuRixTQUFXa0YsRUF3RG5DZSxhQXJEb0J4RCxJQUNoQjRDLE1BQ0Z2QixFQUFZSyxZQUFZYyxFQUFVeEMsR0FDbEM4QyxNQW1ERlcsVUEvQ2dCLEtBQ1paLE1BQ0ZiLEVBQVVOLFlBQVlhLEdBQ3RCTyxNQTZDRlksVUF6Q2dCLElBQ1RsQixFQUFTdEMsaUJBeUNoQnlELE9BdENhLElBQ05wQixFQUFXckMsaUJBc0NsQjBDLFdBQUFBLEVBQ0FDLFFBQUFBLEVBQ0FDLG1CQUFBQSxFQUNBYyxpQkFwQndCbEUsR0FDakI2QyxFQUFXN0QsdUJBQXVCZ0IsSUQxRWhDbUUsQ0FBSy9DLEVBQVVXLE9BRXRCZ0IsRUFBY3JCLEVBQUsrQixpQkFFdkIsTUFjTVcsRUFBaUI5RCxJQUNyQixNQUFNTixFQUFXLEdBRWYsSUFBSyxJQUFJQyxFQUFJLEVBQUdBLEVBQUk4QyxFQUFZN0UsWUFBYStCLElBQzNDRCxFQUFTekIsS0FBSytCLEVBQWFMLEdBTS9CLE9BQU9ELEdBbUZULE1BQU8sQ0FBRXFFLFdBdkRVLEtBQ2pCL0MsRUFBV2dELGlCQUFpQixTQUFTLEtBQ25DLEdBQXVCLElBQW5CbEQsRUFBVVcsTUFBYSxPQUMzQlAsRUFBcUJoRSxVQUFVK0csT0FBTyxRQUN0Q2xELEVBQVdtRCxZQUFjcEQsRUFBVVcsTUF4RGIsTUFDeEIsSUFBSyxJQUFJOUIsRUFBSSxFQUFHQSxFQUFJLElBQUtBLElBQUssQ0FDNUIsTUFBTTVDLEVBQU9GLEVBQU04QyxHQUNuQnNCLEVBQVlrRCxZQUFZcEgsS0FzRHhCcUgsR0FDQXhELEVBQVdxRCxTQUNYLE1BQU1JLEVBQWlCckgsU0FBU0MsY0FBYyxPQUM5Q29ILEVBQWVuSCxVQUFVQyxJQUFJLG9CQUM3QmtILEVBQWVILFlBQWMsbUJBQzdCL0MsRUFBVWdELFlBQVlFLE1BR3hCcEQsRUFBWStDLGlCQUFpQixZQUFhTSxJQUN4QyxHQUFJbEQsRUFBS21DLDJCQUE0QixPQUNyQyxNQUFNeEcsRUFBT3VILEVBQUVDLE9BQ1RDLEVBQWdCQyxPQUFPMUgsRUFBSzJILGFBQWEsZUFDakNaLEVBQWNVLEdBQ3RCRyxTQUFTQyxJQUNiLE1BQU03SCxFQUFPa0UsRUFBWUosY0FDdkIsMkJBQTJCK0QsT0FFekI3SCxHQUFNQSxFQUFLRyxVQUFVK0csT0FBTyxlQUlwQ2hELEVBQVkrQyxpQkFBaUIsYUFBY00sSUFDekMsR0FBSWxELEVBQUttQywyQkFBNEIsT0FDckMsTUFBTXhHLEVBQU91SCxFQUFFQyxPQUNmLEdBQUl4SCxFQUFLRyxVQUFVMkgsU0FBUyxPQUFRLFNBQVUsQ0FDNUMsTUFBTUwsRUFBZ0JDLE9BQU8xSCxFQUFLMkgsYUFBYSxlQUN6Q0ksRUFBUWhCLEVBQWNVLEdBQzVCLEdBekQwQjdGLEVBeURFbUcsRUF4RGIsQ0FBQyxFQUFHLEdBQUksR0FBSSxHQUFJLEdBQUksR0FBSSxHQUFJLEdBQUksR0FBSSxJQUUxQ2xHLE1BQU1FLEdBQ1IsQ0FBQ0EsRUFBS0EsRUFBTSxHQUFHQyxPQUFPQyxHQUMzQkwsRUFBY00sU0FBU0QsT0FvRFcsT0FDcEM4RixFQUFNSCxTQUFTQyxJQUNiLE1BQU03SCxFQUFPa0UsRUFBWUosY0FDdkIsMkJBQTJCK0QsT0FFekI3SCxHQUFNQSxFQUFLRyxVQUFVQyxJQUFJLFlBOUROLElBQUN3QixLQW1FOUJzQyxFQUFZK0MsaUJBQWlCLFNBQVVNLElBQ3JDLEdBQUlsRCxFQUFLbUMsMkJBQTRCLE9BQ3JDLE1BQU14RyxFQUFPdUgsRUFBRUMsT0FDZixHQUFJeEgsRUFBS0csVUFBVTJILFNBQVMsT0FBUSxTQUFVLENBQzVDLE1BQU1MLEVBQWdCQyxPQUFPMUgsRUFBSzJILGFBQWEsZUFDekNJLEVBQVFoQixFQUFjVSxHQUM1QixJQUFLcEQsRUFBS3dDLGlCQUFpQmtCLEdBQVEsT0FDbkMxRCxFQUFLZ0MsaUJBQWlCb0IsRUF4R2pCLGNBOENXcEQsRUFBSzRCLHlCQUNiMkIsU0FBUzNFLElBQ05oRCxTQUFTNkQsY0FDcEIsMkJBQTJCYixPQUV4QjlDLFVBQVVDLElBQUksYUF1RGpCc0YsRUFBY3JCLEVBQUsrQix3QkkxSDNCNEIsR0FBb0JoQixjIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9jb21wb25lbnRzL2JvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvRmFjdG9yeUZ1bmN0aW9ucy9TaGlwcy5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL0ZhY3RvcnlGdW5jdGlvbnMvR2FtZWJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvTW9kdWxlcy9kaXNwbGF5Q29udHJvbGxlci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL01vZHVsZXMvZ2FtZS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL0ZhY3RvcnlGdW5jdGlvbnMvUGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvRmFjdG9yeUZ1bmN0aW9ucy9Db21wdXRlclBsYXllci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIGJvYXJkKGlkKSB7XG4gIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICBjZWxsLmNsYXNzTGlzdC5hZGQoXCJlbXB0eVwiKTtcbiAgY2VsbC5jbGFzc0xpc3QuYWRkKFwiY2VsbFwiKTtcbiAgY2VsbC5zZXRBdHRyaWJ1dGUoXCJjb29yZGluYXRlXCIsIGAke2lkfWApO1xuICByZXR1cm4gY2VsbDtcbn1cbmV4cG9ydCB7IGJvYXJkIH07XG4iLCJmdW5jdGlvbiBzaGlwcyhuYW1lLCBsZW5ndGgpIHtcbiAgY29uc3Qgc2hpcCA9IHtcbiAgICBuYW1lLFxuICAgIGxlbmd0aCxcbiAgICBoaXRzOiBbXSxcbiAgICBzdW5rZW46IGZhbHNlLFxuICB9O1xuXG4gIGNvbnN0IGdldE5hbWUgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHNoaXAubmFtZTtcbiAgfTtcbiAgY29uc3QgZ2V0TGVuZ3RoID0gKCkgPT4ge1xuICAgIHJldHVybiBzaGlwLmxlbmd0aDtcbiAgfTtcbiAgY29uc3QgZ2V0SGl0cyA9ICgpID0+IHtcbiAgICByZXR1cm4gc2hpcC5oaXRzO1xuICB9O1xuICBjb25zdCBzaGlwU3RhdGUgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHNoaXAuc3Vua2VuO1xuICB9O1xuXG4gIGNvbnN0IGhpdCA9ICgpID0+IHtcbiAgICBzaGlwLmhpdHMucHVzaChcImhpdFwiKTtcbiAgICBpc1N1bmsoKTtcbiAgfTtcblxuICBjb25zdCBpc1N1bmsgPSAoKSA9PiB7XG4gICAgaWYgKHNoaXAuaGl0cy5sZW5ndGggPT0gc2hpcC5sZW5ndGgpIHJldHVybiAoc2hpcC5zdW5rZW4gPSB0cnVlKTtcbiAgfTtcblxuICByZXR1cm4geyBnZXRMZW5ndGgsIGdldE5hbWUsIGdldEhpdHMsIHNoaXBTdGF0ZSwgaGl0LCBpc1N1bmssIGxlbmd0aCB9O1xufVxuXG5leHBvcnQgeyBzaGlwcyB9O1xuIiwiaW1wb3J0IHsgc2hpcHMgfSBmcm9tIFwiLi9TaGlwc1wiO1xuZnVuY3Rpb24gZ2FtZUJvYXJkKCkge1xuICBjb25zdCBnYW1lYm9hcmQgPSB7XG4gICAgYm9hcmQ6IEFycmF5KDEwMCkuZmlsbCh7IGhhc1NoaXA6IGZhbHNlLCBpc0hpdDogZmFsc2UgfSksXG4gICAgZmxlZXQ6IFtcbiAgICAgIHNoaXBzKFwiY2FycmllclwiLCA1KSxcbiAgICAgIHNoaXBzKFwiYmF0dGxlc2hpcFwiLCA0KSxcbiAgICAgIHNoaXBzKFwiY3J1aXNlclwiLCAzKSxcbiAgICAgIHNoaXBzKFwic3VibWFyaW5lXCIsIDMpLFxuICAgICAgc2hpcHMoXCJkZXN0cm95ZXJcIiwgMiksXG4gICAgXSxcbiAgICBsb2NhdGlvbnM6IFtdLFxuICB9O1xuXG4gIGNvbnN0IGdldEJvYXJkID0gKCkgPT4ge1xuICAgIHJldHVybiBnYW1lYm9hcmQuYm9hcmQ7XG4gIH07XG5cbiAgY29uc3QgZ2V0U2hpcExvY2F0aW9ucyA9ICgpID0+IHtcbiAgICByZXR1cm4gZ2FtZWJvYXJkLmxvY2F0aW9ucy5mbGF0KCk7XG4gIH07XG5cbiAgY29uc3QgZ2V0RmxlZXQgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGdhbWVib2FyZC5mbGVldDtcbiAgfTtcblxuICBjb25zdCBzaGlwTG9jYXRpb24gPSAob3JpZW50YXRpb24sIHN0YXJ0aW5nUG9zaXRpb24sIHNoaXApID0+IHtcbiAgICAvLyByZXR1cm5zIGFuIGFycmF5IG9mIG51bWJlcnMgdGhhdCByZXByZXNlbnQgaW5kZXhlcyBvbiB0aGUgYm9hcmRcbiAgICBjb25zdCBsb2NhdGlvbiA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcC5nZXRMZW5ndGgoKTsgaSsrKSB7XG4gICAgICBvcmllbnRhdGlvbiA9PT0gXCJob3Jpem9udGFsXCJcbiAgICAgICAgPyBsb2NhdGlvbi5wdXNoKHN0YXJ0aW5nUG9zaXRpb24gKyBpKVxuICAgICAgICA6IGxvY2F0aW9uLnB1c2goc3RhcnRpbmdQb3NpdGlvbiArIGkgKiAxMCk7XG4gICAgfVxuICAgIHJldHVybiBsb2NhdGlvbjtcbiAgfTtcblxuICBjb25zdCBzaGlwUGxhY2VtZW50ID0gKG9yaWVudGF0aW9uLCBzdGFydGluZ1Bvc2l0aW9uLCBTaGlwKSA9PiB7XG4gICAgY29uc3QgbG9jYXRpb24gPSBzaGlwTG9jYXRpb24ob3JpZW50YXRpb24sIHN0YXJ0aW5nUG9zaXRpb24sIFNoaXApO1xuICAgIGZvciAobGV0IGogPSAwOyBqIDwgbG9jYXRpb24ubGVuZ3RoOyBqKyspIHtcbiAgICAgIGdhbWVib2FyZC5ib2FyZC5zcGxpY2UobG9jYXRpb25bal0sIDEsIHtcbiAgICAgICAgaGFzU2hpcDogdHJ1ZSxcbiAgICAgICAgaXNIaXQ6IGZhbHNlLFxuICAgICAgICBzaGlwOiBTaGlwLFxuICAgICAgfSk7XG4gICAgfVxuICAgIGdhbWVib2FyZC5sb2NhdGlvbnMucHVzaChsb2NhdGlvbik7XG4gICAgcmV0dXJuIGxvY2F0aW9uO1xuICB9O1xuXG4gIGNvbnN0IGNoZWNrRm9yVmFsaWRQbGFjZW1lbnQgPSAobG9jYXRpb25BcnJheSkgPT4ge1xuICAgIGNvbnN0IGNvbGxpc2lvbnMgPSBbOSwgMTksIDI5LCAzOSwgNDksIDU5LCA2OSwgNzksIDg5XTtcbiAgICBpZiAobG9jYXRpb25BcnJheS5zb21lKChsb2MpID0+ICFnYW1lYm9hcmQuYm9hcmRbbG9jXSkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGVsc2UgaWYgKGxvY2F0aW9uQXJyYXkuc29tZSgobG9jKSA9PiBnYW1lYm9hcmQuYm9hcmRbbG9jXS5oYXNTaGlwKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICBjb2xsaXNpb25zLnNvbWUoKG51bSkgPT4ge1xuICAgICAgICByZXR1cm4gW251bSwgbnVtICsgMV0uZXZlcnkoKGNvbWJpbmF0aW9uKSA9PlxuICAgICAgICAgIGxvY2F0aW9uQXJyYXkuaW5jbHVkZXMoY29tYmluYXRpb24pXG4gICAgICAgICk7XG4gICAgICB9KVxuICAgICkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgcmFuZG9tU2hpcFBsYWNlbWVudCA9IChzaGlwKSA9PiB7XG4gICAgbGV0IGFsbFBvc3NpYmxlTG9jYXRpb25zID0gW107XG5cbiAgICAvLyByZXR1cm5zIGEgcmFuZG9tIG9yaWVudGF0aW9uXG5cbiAgICBjb25zdCByYW5kb21PcmllbnRhdGlvbiA9ICgpID0+XG4gICAgICBbXCJob3JpelwiLCBcInZlcnRcIl1bTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMildO1xuXG4gICAgLy8gZmluZHMgYWxsIHBvc3NpYmxlIGxvY2F0aW9ucyBhIHNoaXAgY2FuIGJlIHBsYWNlZCBhdFxuXG4gICAgY29uc3QgZmluZEFsbFBvc3NpYmxlTG9jYXRpb25zID0gKG9yaWVudGF0aW9uKSA9PiB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMCAtIHNoaXAuZ2V0TGVuZ3RoKCk7IGkrKykge1xuICAgICAgICBsZXQgbG9jYXRpb25BcnJheSA9IFtdO1xuXG4gICAgICAgIGlmIChvcmllbnRhdGlvbiA9PT0gXCJob3JpelwiKVxuICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgc2hpcC5nZXRMZW5ndGgoKTsgaisrKSB7XG4gICAgICAgICAgICBsb2NhdGlvbkFycmF5LnB1c2goaSArIGopO1xuICAgICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgc2hpcC5nZXRMZW5ndGgoKTsgaisrKSB7XG4gICAgICAgICAgICBsb2NhdGlvbkFycmF5LnB1c2goaSArIGogKiAxMCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgIC8vIGNoZWNrcyB3aGV0aGVyIHRoZSBjcmVhdGVkIGxvY2F0aW9uIGlzIHZhbGlkIG9yIG5vdFxuXG4gICAgICAgIGlmIChjaGVja0ZvclZhbGlkUGxhY2VtZW50KGxvY2F0aW9uQXJyYXkpKVxuICAgICAgICAgIGFsbFBvc3NpYmxlTG9jYXRpb25zLnB1c2gobG9jYXRpb25BcnJheSk7XG4gICAgICB9XG5cbiAgICAgIC8vIHJldHVybnMgb25lIHJhbmRvbSBzaGlwIGxvY2F0aW9uIG91dCBvZiBtYW55XG5cbiAgICAgIHJldHVybiBhbGxQb3NzaWJsZUxvY2F0aW9uc1tcbiAgICAgICAgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogYWxsUG9zc2libGVMb2NhdGlvbnMubGVuZ3RoKVxuICAgICAgXTtcbiAgICB9O1xuXG4gICAgbGV0IGxvY2F0aW9uID0gZmluZEFsbFBvc3NpYmxlTG9jYXRpb25zKHJhbmRvbU9yaWVudGF0aW9uKCkpO1xuICAgIGZvciAobGV0IGogPSAwOyBqIDwgbG9jYXRpb24ubGVuZ3RoOyBqKyspIHtcbiAgICAgIGdhbWVib2FyZC5ib2FyZC5zcGxpY2UobG9jYXRpb25bal0sIDEsIHtcbiAgICAgICAgaGFzU2hpcDogdHJ1ZSxcbiAgICAgICAgaXNIaXQ6IGZhbHNlLFxuICAgICAgICBzaGlwOiBzaGlwLFxuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSAoY29vcmRpbmF0ZSkgPT4ge1xuICAgIGlmIChnYW1lYm9hcmQuYm9hcmRbY29vcmRpbmF0ZV0uaGFzU2hpcCA9PSBmYWxzZSlcbiAgICAgIGdhbWVib2FyZC5ib2FyZC5zcGxpY2UoY29vcmRpbmF0ZSwgMSwge1xuICAgICAgICBoYXNTaGlwOiBmYWxzZSxcbiAgICAgICAgaXNIaXQ6IHRydWUsXG4gICAgICAgIG1pc3NlZFNob3Q6IHRydWUsXG4gICAgICB9KTtcbiAgICBlbHNlIHtcbiAgICAgIGdhbWVib2FyZC5ib2FyZFtjb29yZGluYXRlXS5pc0hpdCA9IHRydWU7XG4gICAgICBnYW1lYm9hcmQuYm9hcmRbY29vcmRpbmF0ZV0uc2hpcC5oaXQoKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgY2hlY2tTaGlwU3RhdGUgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGdhbWVib2FyZC5ib2FyZFxuICAgICAgLmZpbHRlcigoZWwpID0+IGVsLmhhc1NoaXApXG4gICAgICAubWFwKChlbCkgPT4gZWwuc2hpcClcbiAgICAgIC5ldmVyeSgoZWwpID0+IGVsLmlzU3VuaygpKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGdldEJvYXJkLFxuICAgIGdldEZsZWV0LFxuICAgIGdldFNoaXBMb2NhdGlvbnMsXG4gICAgc2hpcFBsYWNlbWVudCxcbiAgICByZWNlaXZlQXR0YWNrLFxuICAgIGNoZWNrU2hpcFN0YXRlLFxuICAgIGNoZWNrRm9yVmFsaWRQbGFjZW1lbnQsXG4gICAgcmFuZG9tU2hpcFBsYWNlbWVudCxcbiAgfTtcbn1cblxuZXhwb3J0IHsgZ2FtZUJvYXJkIH07XG4iLCJpbXBvcnQgeyBib2FyZCB9IGZyb20gXCIuLi9jb21wb25lbnRzL2JvYXJkXCI7XG5pbXBvcnQgeyBnYW1lIH0gZnJvbSBcIi4vZ2FtZVwiO1xuXG5mdW5jdGlvbiBkaXNwbGF5Q29udHJvbGxlcigpIHtcbiAgY29uc3QgbmFtZVNjcmVlbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyLW5hbWVcIik7XG4gIGNvbnN0IG5hbWVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmFtZVwiKTtcbiAgY29uc3QgcGxheWVyTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyLWJvYXJkID4gc3BhblwiKTtcbiAgY29uc3QgcGxheUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyLW5hbWUgPiBidXR0b25cIik7XG4gIGNvbnN0IGJvYXJkQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5ib2FyZC1jb250YWluZXJcIik7XG4gIGNvbnN0IHBsYXllckJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItYm9hcmQgPiAuYm9hcmRcIik7XG4gIGNvbnN0IHBsYXllckJvYXJkQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItYm9hcmQgXCIpO1xuICBjb25zdCBjcHVCb2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY3B1LWJvYXJkID4gLmJvYXJkXCIpO1xuICBjb25zdCBjcHVCb2FyZENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY3B1LWJvYXJkIFwiKTtcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jb250YWluZXJcIik7XG4gIGNvbnN0IGNoYW5nZUF4aXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmF4aXNcIik7XG4gIGNvbnN0IHN0YXJ0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zdGFydFwiKTtcbiAgbGV0IEdhbWUgPSBnYW1lKG5hbWVJbnB1dC52YWx1ZSk7XG4gIGxldCBheGlzID0gXCJob3Jpem9udGFsXCI7XG4gIGxldCBzaGlwVG9QbGFjZSA9IEdhbWUuZ2V0U2hpcFRvUGxhY2UoKTtcblxuICBjb25zdCByZW5kZXJQbGF5ZXJCb2FyZCA9ICgpID0+IHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDsgaSsrKSB7XG4gICAgICBjb25zdCBjZWxsID0gYm9hcmQoaSk7XG4gICAgICBwbGF5ZXJCb2FyZC5hcHBlbmRDaGlsZChjZWxsKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgcmVuZGVyQ3B1Qm9hcmQgPSAoKSA9PiB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDA7IGkrKykge1xuICAgICAgY29uc3QgY2VsbCA9IGJvYXJkKGkpO1xuICAgICAgY3B1Qm9hcmQuYXBwZW5kQ2hpbGQoY2VsbCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGdlbmVyYXRlQmxvY2sgPSAoY29vcmRpbmF0ZSkgPT4ge1xuICAgIGNvbnN0IGxvY2F0aW9uID0gW107XG4gICAgaWYgKGF4aXMgPT09IFwiaG9yaXpvbnRhbFwiKVxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwVG9QbGFjZS5nZXRMZW5ndGgoKTsgaSsrKSB7XG4gICAgICAgIGxvY2F0aW9uLnB1c2goY29vcmRpbmF0ZSArIGkpO1xuICAgICAgfVxuICAgIGVsc2VcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcFRvUGxhY2UuZ2V0TGVuZ3RoKCk7IGkrKykge1xuICAgICAgICBsb2NhdGlvbi5wdXNoKGNvb3JkaW5hdGUgKyBpICogMTApO1xuICAgICAgfVxuICAgIHJldHVybiBsb2NhdGlvbjtcbiAgfTtcblxuICBjb25zdCBjaGVja0ZvclZhbGlkUGxhY2VtZW50ID0gKGxvY2F0aW9uQXJyYXkpID0+IHtcbiAgICBjb25zdCBjb2xsaXNpb25zID0gWzksIDE5LCAyOSwgMzksIDQ5LCA1OSwgNjksIDc5LCA4OSwgOTldO1xuICAgIGlmIChcbiAgICAgIGNvbGxpc2lvbnMuc29tZSgobnVtKSA9PiB7XG4gICAgICAgIHJldHVybiBbbnVtLCBudW0gKyAxXS5ldmVyeSgoY29tYmluYXRpb24pID0+XG4gICAgICAgICAgbG9jYXRpb25BcnJheS5pbmNsdWRlcyhjb21iaW5hdGlvbilcbiAgICAgICAgKTtcbiAgICAgIH0pXG4gICAgKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCByZW5kZXJTaGlwcyA9ICgpID0+IHtcbiAgICBjb25zdCBjb29yZGluYXRlcyA9IEdhbWUuZ2V0UGxheWVyU2hpcExvY2F0aW9ucygpO1xuICAgIGNvb3JkaW5hdGVzLmZvckVhY2goKGNvb3JkaW5hdGUpID0+IHtcbiAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICBgLmNlbGwuZW1wdHlbY29vcmRpbmF0ZT1cIiR7Y29vcmRpbmF0ZX1cIl1gXG4gICAgICApO1xuICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKFwicGxhY2VkXCIpO1xuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IGJpbmRFdmVudHMgPSAoKSA9PiB7XG4gICAgcGxheUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgaWYgKG5hbWVJbnB1dC52YWx1ZSA9PSBcIlwiKSByZXR1cm47XG4gICAgICBwbGF5ZXJCb2FyZENvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZVwiKTtcbiAgICAgIHBsYXllck5hbWUudGV4dENvbnRlbnQgPSBuYW1lSW5wdXQudmFsdWU7XG4gICAgICByZW5kZXJQbGF5ZXJCb2FyZCgpO1xuICAgICAgbmFtZVNjcmVlbi5yZW1vdmUoKTtcbiAgICAgIGNvbnN0IHBsYWNlU2hpcHNUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHBsYWNlU2hpcHNUZXh0LmNsYXNzTGlzdC5hZGQoXCJwbGFjZS1zaGlwcy10ZXh0XCIpO1xuICAgICAgcGxhY2VTaGlwc1RleHQudGV4dENvbnRlbnQgPSBcIlBsYWNlIHlvdXIgc2hpcHNcIjtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChwbGFjZVNoaXBzVGV4dCk7XG4gICAgfSk7XG5cbiAgICBwbGF5ZXJCb2FyZC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdXRcIiwgKGUpID0+IHtcbiAgICAgIGlmIChHYW1lLmNoZWNrSWZBbGxTaGlwc0FyZVBsYWNlZCgpKSByZXR1cm47XG4gICAgICBjb25zdCBjZWxsID0gZS50YXJnZXQ7XG4gICAgICBjb25zdCBzdGFydGluZ1BvaW50ID0gTnVtYmVyKGNlbGwuZ2V0QXR0cmlidXRlKFwiY29vcmRpbmF0ZVwiKSk7XG4gICAgICBjb25zdCBibG9jayA9IGdlbmVyYXRlQmxvY2soc3RhcnRpbmdQb2ludCk7XG4gICAgICBibG9jay5mb3JFYWNoKChzcXVhcmUpID0+IHtcbiAgICAgICAgY29uc3QgY2VsbCA9IHBsYXllckJvYXJkLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgYC5lbXB0eS5jZWxsW2Nvb3JkaW5hdGU9XCIke3NxdWFyZX1cIl1gXG4gICAgICAgICk7XG4gICAgICAgIGlmIChjZWxsKSBjZWxsLmNsYXNzTGlzdC5yZW1vdmUoXCJob3ZlclwiKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgcGxheWVyQm9hcmQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLCAoZSkgPT4ge1xuICAgICAgaWYgKEdhbWUuY2hlY2tJZkFsbFNoaXBzQXJlUGxhY2VkKCkpIHJldHVybjtcbiAgICAgIGNvbnN0IGNlbGwgPSBlLnRhcmdldDtcbiAgICAgIGlmIChjZWxsLmNsYXNzTGlzdC5jb250YWlucyhcImNlbGxcIiwgXCJlbXB0eVwiKSkge1xuICAgICAgICBjb25zdCBzdGFydGluZ1BvaW50ID0gTnVtYmVyKGNlbGwuZ2V0QXR0cmlidXRlKFwiY29vcmRpbmF0ZVwiKSk7XG4gICAgICAgIGNvbnN0IGJsb2NrID0gZ2VuZXJhdGVCbG9jayhzdGFydGluZ1BvaW50KTtcbiAgICAgICAgaWYgKCFjaGVja0ZvclZhbGlkUGxhY2VtZW50KGJsb2NrKSkgcmV0dXJuO1xuICAgICAgICBibG9jay5mb3JFYWNoKChzcXVhcmUpID0+IHtcbiAgICAgICAgICBjb25zdCBjZWxsID0gcGxheWVyQm9hcmQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgIGAuZW1wdHkuY2VsbFtjb29yZGluYXRlPVwiJHtzcXVhcmV9XCJdYFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKGNlbGwpIGNlbGwuY2xhc3NMaXN0LmFkZChcImhvdmVyXCIpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHBsYXllckJvYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgaWYgKEdhbWUuY2hlY2tJZkFsbFNoaXBzQXJlUGxhY2VkKCkpIHJldHVybjtcbiAgICAgIGNvbnN0IGNlbGwgPSBlLnRhcmdldDtcbiAgICAgIGlmIChjZWxsLmNsYXNzTGlzdC5jb250YWlucyhcImNlbGxcIiwgXCJlbXB0eVwiKSkge1xuICAgICAgICBjb25zdCBzdGFydGluZ1BvaW50ID0gTnVtYmVyKGNlbGwuZ2V0QXR0cmlidXRlKFwiY29vcmRpbmF0ZVwiKSk7XG4gICAgICAgIGNvbnN0IGJsb2NrID0gZ2VuZXJhdGVCbG9jayhzdGFydGluZ1BvaW50KTtcbiAgICAgICAgaWYgKCFHYW1lLmlzVmFsaWRQbGFjZW1lbnQoYmxvY2spKSByZXR1cm47XG4gICAgICAgIEdhbWUucGxhY2VQbGF5ZXJTaGlwcyhzdGFydGluZ1BvaW50LCBheGlzKTtcbiAgICAgICAgcmVuZGVyU2hpcHMoKTtcbiAgICAgICAgc2hpcFRvUGxhY2UgPSBHYW1lLmdldFNoaXBUb1BsYWNlKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG4gIHJldHVybiB7IGJpbmRFdmVudHMgfTtcbn1cblxuZXhwb3J0IHsgZGlzcGxheUNvbnRyb2xsZXIgfTtcbiIsImltcG9ydCB7IGdhbWVCb2FyZCB9IGZyb20gXCIuLi9GYWN0b3J5RnVuY3Rpb25zL0dhbWVib2FyZFwiO1xuaW1wb3J0IHsgcGxheWVyIH0gZnJvbSBcIi4uL0ZhY3RvcnlGdW5jdGlvbnMvUGxheWVyXCI7XG5pbXBvcnQgeyBjb21wdXRlclBsYXllciB9IGZyb20gXCIuLi9GYWN0b3J5RnVuY3Rpb25zL0NvbXB1dGVyUGxheWVyXCI7XG5cbmZ1bmN0aW9uIGdhbWUobmFtZSkge1xuICBsZXQgaHVtYW5QbGF5ZXIgPSBwbGF5ZXIobmFtZSwgdHJ1ZSk7XG4gIGxldCBjcHVQbGF5ZXIgPSBjb21wdXRlclBsYXllcihmYWxzZSk7XG4gIGxldCBodW1hbkJvYXJkID0gZ2FtZUJvYXJkKCk7XG4gIGxldCBjcHVCb2FyZCA9IGdhbWVCb2FyZCgpO1xuICBsZXQgc2hpcFRvUGxhY2UgPSAwO1xuXG4gIGNvbnN0IGdldFBsYXllckZsZWV0ID0gKCkgPT4ge1xuICAgIHJldHVybiBodW1hbkJvYXJkLmdldEZsZWV0KCk7XG4gIH07XG5cbiAgY29uc3QgZ2V0UGxheWVyTmFtZSA9ICgpID0+IHtcbiAgICByZXR1cm4gaHVtYW5QbGF5ZXIuZ2V0TmFtZSgpO1xuICB9O1xuXG4gIGNvbnN0IGdldFBsYXllclNoaXBMb2NhdGlvbnMgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGh1bWFuQm9hcmQuZ2V0U2hpcExvY2F0aW9ucygpO1xuICB9O1xuXG4gIGNvbnN0IGdldENQVUZsZWV0ID0gKCkgPT4ge1xuICAgIHJldHVybiBjcHVCb2FyZC5nZXRGbGVldCgpO1xuICB9O1xuXG4gIGNvbnN0IGdldFNoaXBUb1BsYWNlID0gKCkgPT4ge1xuICAgIGNvbnN0IGZsZWV0ID0gZ2V0UGxheWVyRmxlZXQoKTtcbiAgICBjb25zdCBzaGlwID0gZmxlZXRbc2hpcFRvUGxhY2VdO1xuICAgIHJldHVybiBzaGlwO1xuICB9O1xuXG4gIGNvbnN0IHBsYWNlQ1BVU2hpcHMgPSAoKSA9PiB7XG4gICAgY29uc3QgY3B1RmxlZXQgPSBnZXRDUFVGbGVldCgpO1xuICAgIGZvciAobGV0IHNoaXAgPSAwOyBzaGlwIDwgY3B1RmxlZXQubGVuZ3RoOyBzaGlwKyspXG4gICAgICBjcHVCb2FyZC5yYW5kb21TaGlwUGxhY2VtZW50KGNwdUZsZWV0W3NoaXBdKTtcbiAgfTtcblxuICBjb25zdCBwbGFjZVBsYXllclNoaXBzID0gKGxvY2F0aW9uLCBheGlzKSA9PiB7XG4gICAgY29uc3QgcGxheWVyRmxlZXQgPSBnZXRQbGF5ZXJGbGVldCgpO1xuICAgIGh1bWFuQm9hcmQuc2hpcFBsYWNlbWVudChheGlzLCBsb2NhdGlvbiwgcGxheWVyRmxlZXRbc2hpcFRvUGxhY2VdKTtcbiAgICBzaGlwVG9QbGFjZSArPSAxO1xuICB9O1xuXG4gIGNvbnN0IGNoZWNrSWZBbGxTaGlwc0FyZVBsYWNlZCA9ICgpID0+IHtcbiAgICByZXR1cm4gZ2V0UGxheWVyRmxlZXQoKS5sZW5ndGggPT09IHNoaXBUb1BsYWNlO1xuICB9O1xuXG4gIGNvbnN0IHBsYXllckF0dGFjayA9IChjb29yZGluYXRlKSA9PiB7XG4gICAgaWYgKHBsYXllclJvbGUoKSkge1xuICAgICAgaHVtYW5QbGF5ZXIuYXR0YWNrRW5lbXkoY3B1Qm9hcmQsIGNvb3JkaW5hdGUpO1xuICAgICAgc3dpdGNoUGxheWVyc1JvbGVzKCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGNwdUF0dGFjayA9ICgpID0+IHtcbiAgICBpZiAoY3B1Um9sZSgpKSB7XG4gICAgICBjcHVQbGF5ZXIuYXR0YWNrRW5lbXkoaHVtYW5Cb2FyZCk7XG4gICAgICBzd2l0Y2hQbGF5ZXJzUm9sZXMoKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgcGxheWVyV29uID0gKCkgPT4ge1xuICAgIHJldHVybiBjcHVCb2FyZC5jaGVja1NoaXBTdGF0ZSgpO1xuICB9O1xuXG4gIGNvbnN0IGNwdVdvbiA9ICgpID0+IHtcbiAgICByZXR1cm4gaHVtYW5Cb2FyZC5jaGVja1NoaXBTdGF0ZSgpO1xuICB9O1xuXG4gIGNvbnN0IHBsYXllclJvbGUgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGh1bWFuUGxheWVyLndob0lzUGxheWluZygpO1xuICB9O1xuXG4gIGNvbnN0IGNwdVJvbGUgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGNwdVBsYXllci53aG9Jc1BsYXlpbmcoKTtcbiAgfTtcblxuICBjb25zdCBzd2l0Y2hQbGF5ZXJzUm9sZXMgPSAoKSA9PiB7XG4gICAgaWYgKHBsYXllclJvbGUoKSkge1xuICAgICAgaHVtYW5QbGF5ZXIuc3dpdGNoUm9sZXMoKTtcbiAgICAgIGNwdVBsYXllci5zd2l0Y2hSb2xlcygpO1xuICAgIH0gZWxzZSB7XG4gICAgICBodW1hblBsYXllci5zd2l0Y2hSb2xlcygpO1xuICAgICAgY3B1UGxheWVyLnN3aXRjaFJvbGVzKCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGlzVmFsaWRQbGFjZW1lbnQgPSAobG9jYXRpb24pID0+IHtcbiAgICByZXR1cm4gaHVtYW5Cb2FyZC5jaGVja0ZvclZhbGlkUGxhY2VtZW50KGxvY2F0aW9uKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGdldFBsYXllckZsZWV0LFxuICAgIGdldFBsYXllck5hbWUsXG4gICAgZ2V0UGxheWVyU2hpcExvY2F0aW9ucyxcbiAgICBnZXRDUFVGbGVldCxcbiAgICBwbGFjZUNQVVNoaXBzLFxuICAgIGdldFNoaXBUb1BsYWNlLFxuICAgIHBsYWNlUGxheWVyU2hpcHMsXG4gICAgY2hlY2tJZkFsbFNoaXBzQXJlUGxhY2VkLFxuICAgIHBsYXllckF0dGFjayxcbiAgICBjcHVBdHRhY2ssXG4gICAgcGxheWVyV29uLFxuICAgIGNwdVdvbixcbiAgICBwbGF5ZXJSb2xlLFxuICAgIGNwdVJvbGUsXG4gICAgc3dpdGNoUGxheWVyc1JvbGVzLFxuICAgIGlzVmFsaWRQbGFjZW1lbnQsXG4gIH07XG59XG5cbmV4cG9ydCB7IGdhbWUgfTtcbiIsImltcG9ydCB7IGdhbWVCb2FyZCB9IGZyb20gXCIuL0dhbWVib2FyZFwiO1xuZnVuY3Rpb24gcGxheWVyKG5hbWUsIHBsYXlpbmcpIHtcbiAgY29uc3QgcGxheWVySW5mbyA9IHtcbiAgICBuYW1lLFxuICAgIGJvYXJkOiBnYW1lQm9hcmQoKSxcbiAgICBwbGF5aW5nLFxuICB9O1xuXG4gIGNvbnN0IHdob0lzUGxheWluZyA9ICgpID0+IHtcbiAgICByZXR1cm4gcGxheWVySW5mby5wbGF5aW5nO1xuICB9O1xuXG4gIGNvbnN0IHN3aXRjaFJvbGVzID0gKCkgPT4ge1xuICAgIHJldHVybiAocGxheWVySW5mby5wbGF5aW5nID0gIXBsYXllckluZm8ucGxheWluZyk7XG4gIH07XG5cbiAgY29uc3QgZ2V0TmFtZSA9ICgpID0+IHtcbiAgICByZXR1cm4gcGxheWVySW5mby5uYW1lO1xuICB9O1xuXG4gIGNvbnN0IHNldE5hbWUgPSAodmFsdWUpID0+IHtcbiAgICByZXR1cm4gKHBsYXllckluZm8ubmFtZSA9IHZhbHVlKTtcbiAgfTtcblxuICBjb25zdCBhdHRhY2tFbmVteSA9IChlbmVteUJvYXJkLCBzaG90KSA9PiB7XG4gICAgZW5lbXlCb2FyZC5yZWNlaXZlQXR0YWNrKHNob3QpO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgZ2V0TmFtZSxcbiAgICBzZXROYW1lLFxuICAgIGF0dGFja0VuZW15LFxuICAgIHdob0lzUGxheWluZyxcbiAgICBzd2l0Y2hSb2xlcyxcbiAgfTtcbn1cblxuZXhwb3J0IHsgcGxheWVyIH07XG4iLCJpbXBvcnQgeyBnYW1lQm9hcmQgfSBmcm9tIFwiLi9HYW1lYm9hcmRcIjtcbmZ1bmN0aW9uIGNvbXB1dGVyUGxheWVyKHBsYXlpbmcpIHtcbiAgY29uc3QgcGxheWVySW5mbyA9IHtcbiAgICBuYW1lOiBcImNvbXB1dGVyXCIsXG4gICAgYm9hcmQ6IGdhbWVCb2FyZCgpLFxuICAgIHBsYXlpbmcsXG4gICAgc2hvdHNGaXJlZDogW10sXG4gIH07XG5cbiAgY29uc3Qgd2hvSXNQbGF5aW5nID0gKCkgPT4ge1xuICAgIHJldHVybiBwbGF5ZXJJbmZvLnBsYXlpbmc7XG4gIH07XG5cbiAgY29uc3Qgc3dpdGNoUm9sZXMgPSAoKSA9PiB7XG4gICAgcmV0dXJuIChwbGF5ZXJJbmZvLnBsYXlpbmcgPSAhcGxheWVySW5mby5wbGF5aW5nKTtcbiAgfTtcblxuICBjb25zdCBnZXROYW1lID0gKCkgPT4ge1xuICAgIHJldHVybiBwbGF5ZXJJbmZvLm5hbWU7XG4gIH07XG5cbiAgY29uc3QgcmFuZG9tSW5kZXggPSAoKSA9PiB7XG4gICAgbGV0IGluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwKTtcbiAgICBpZiAoY2hlY2tSYW5kb21JbmRleChpbmRleCwgcGxheWVySW5mby5zaG90c0ZpcmVkKSlcbiAgICAgIHBsYXllckluZm8uc2hvdHNGaXJlZC5wdXNoKGluZGV4KTtcbiAgICBpZiAoIWNoZWNrUmFuZG9tSW5kZXgoaW5kZXgsIHBsYXllckluZm8uc2hvdHNGaXJlZCkpIHJldHVybiByYW5kb21JbmRleCgpO1xuICAgIHJldHVybiBpbmRleDtcbiAgfTtcblxuICBjb25zdCBjaGVja1JhbmRvbUluZGV4ID0gKHZhbHVlLCBhcnJheSkgPT4ge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICh2YWx1ZSA9PSBhcnJheVtpXSkgcmV0dXJuIGZhbHNlO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGF0dGFja0VuZW15ID0gKGVuZW15Qm9hcmQpID0+IHtcbiAgICBlbmVteUJvYXJkLnJlY2VpdmVBdHRhY2socmFuZG9tSW5kZXgoKSk7XG4gIH07XG5cbiAgcmV0dXJuIHsgZ2V0TmFtZSwgYXR0YWNrRW5lbXksIHdob0lzUGxheWluZywgc3dpdGNoUm9sZXMgfTtcbn1cbmV4cG9ydCB7IGNvbXB1dGVyUGxheWVyIH07XG4iLCJpbXBvcnQgeyBkaXNwbGF5Q29udHJvbGxlciB9IGZyb20gXCIuL01vZHVsZXMvZGlzcGxheUNvbnRyb2xsZXJcIjtcbmRpc3BsYXlDb250cm9sbGVyKCkuYmluZEV2ZW50cygpO1xuIl0sIm5hbWVzIjpbImJvYXJkIiwiaWQiLCJjZWxsIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwic2V0QXR0cmlidXRlIiwic2hpcHMiLCJuYW1lIiwibGVuZ3RoIiwic2hpcCIsImhpdHMiLCJzdW5rZW4iLCJpc1N1bmsiLCJnZXRMZW5ndGgiLCJnZXROYW1lIiwiZ2V0SGl0cyIsInNoaXBTdGF0ZSIsImhpdCIsInB1c2giLCJnYW1lQm9hcmQiLCJnYW1lYm9hcmQiLCJBcnJheSIsImZpbGwiLCJoYXNTaGlwIiwiaXNIaXQiLCJmbGVldCIsImxvY2F0aW9ucyIsImNoZWNrRm9yVmFsaWRQbGFjZW1lbnQiLCJsb2NhdGlvbkFycmF5Iiwic29tZSIsImxvYyIsIm51bSIsImV2ZXJ5IiwiY29tYmluYXRpb24iLCJpbmNsdWRlcyIsImdldEJvYXJkIiwiZ2V0RmxlZXQiLCJnZXRTaGlwTG9jYXRpb25zIiwiZmxhdCIsInNoaXBQbGFjZW1lbnQiLCJvcmllbnRhdGlvbiIsInN0YXJ0aW5nUG9zaXRpb24iLCJTaGlwIiwibG9jYXRpb24iLCJpIiwic2hpcExvY2F0aW9uIiwiaiIsInNwbGljZSIsInJlY2VpdmVBdHRhY2siLCJjb29yZGluYXRlIiwibWlzc2VkU2hvdCIsImNoZWNrU2hpcFN0YXRlIiwiZmlsdGVyIiwiZWwiLCJtYXAiLCJyYW5kb21TaGlwUGxhY2VtZW50IiwiYWxsUG9zc2libGVMb2NhdGlvbnMiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJmaW5kQWxsUG9zc2libGVMb2NhdGlvbnMiLCJuYW1lU2NyZWVuIiwicXVlcnlTZWxlY3RvciIsIm5hbWVJbnB1dCIsInBsYXllck5hbWUiLCJwbGF5QnV0dG9uIiwicGxheWVyQm9hcmQiLCJwbGF5ZXJCb2FyZENvbnRhaW5lciIsImNvbnRhaW5lciIsIkdhbWUiLCJodW1hblBsYXllciIsInBsYXlpbmciLCJwbGF5ZXJJbmZvIiwic2V0TmFtZSIsInZhbHVlIiwiYXR0YWNrRW5lbXkiLCJlbmVteUJvYXJkIiwic2hvdCIsIndob0lzUGxheWluZyIsInN3aXRjaFJvbGVzIiwicGxheWVyIiwiY3B1UGxheWVyIiwic2hvdHNGaXJlZCIsInJhbmRvbUluZGV4IiwiaW5kZXgiLCJjaGVja1JhbmRvbUluZGV4IiwiYXJyYXkiLCJjb21wdXRlclBsYXllciIsImh1bWFuQm9hcmQiLCJjcHVCb2FyZCIsInNoaXBUb1BsYWNlIiwiZ2V0UGxheWVyRmxlZXQiLCJnZXRDUFVGbGVldCIsInBsYXllclJvbGUiLCJjcHVSb2xlIiwic3dpdGNoUGxheWVyc1JvbGVzIiwiZ2V0UGxheWVyTmFtZSIsImdldFBsYXllclNoaXBMb2NhdGlvbnMiLCJwbGFjZUNQVVNoaXBzIiwiY3B1RmxlZXQiLCJnZXRTaGlwVG9QbGFjZSIsInBsYWNlUGxheWVyU2hpcHMiLCJheGlzIiwicGxheWVyRmxlZXQiLCJjaGVja0lmQWxsU2hpcHNBcmVQbGFjZWQiLCJwbGF5ZXJBdHRhY2siLCJjcHVBdHRhY2siLCJwbGF5ZXJXb24iLCJjcHVXb24iLCJpc1ZhbGlkUGxhY2VtZW50IiwiZ2FtZSIsImdlbmVyYXRlQmxvY2siLCJiaW5kRXZlbnRzIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZSIsInRleHRDb250ZW50IiwiYXBwZW5kQ2hpbGQiLCJyZW5kZXJQbGF5ZXJCb2FyZCIsInBsYWNlU2hpcHNUZXh0IiwiZSIsInRhcmdldCIsInN0YXJ0aW5nUG9pbnQiLCJOdW1iZXIiLCJnZXRBdHRyaWJ1dGUiLCJmb3JFYWNoIiwic3F1YXJlIiwiY29udGFpbnMiLCJibG9jayIsImRpc3BsYXlDb250cm9sbGVyIl0sInNvdXJjZVJvb3QiOiIifQ==