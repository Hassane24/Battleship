(()=>{"use strict";function e(e){const t=document.createElement("div");return t.classList.add("empty"),t.classList.add("cell"),t.setAttribute("coordinate",`${e}`),t}function t(e,t){const s={name:e,length:t,hits:[]};return{getLength:()=>s.length,getName:()=>s.name,getHits:()=>s.hits,hit:()=>{s.hits.push("hit")},isSunk:()=>s.hits.length===s.length}}function s(){const e={board:Array(100).fill({hasShip:!1,isHit:!1}),fleet:[t("carrier",5),t("battleship",4),t("cruiser",3),t("submarine",3),t("destroyer",2)],locations:[]},s=t=>!t.some((t=>!e.board[t]))&&!t.some((t=>e.board[t].hasShip))&&![9,19,29,39,49,59,69,79,89].some((e=>[e,e+1].every((e=>t.includes(e)))));return{getBoard:()=>e.board,getFleet:()=>e.fleet,getShipLocations:()=>e.locations.flat(),shipPlacement:(t,s,r)=>{const o=((e,t,s)=>{const r=[];for(let o=0;o<s.getLength();o++)"horizontal"===e?r.push(t+o):r.push(t+10*o);return r})(t,s,r);for(let t=0;t<o.length;t++)e.board.splice(o[t],1,{hasShip:!0,isHit:!1,ship:r});return e.locations.push(o),o},receiveAttack:t=>{0==e.board[t].hasShip?e.board.splice(t,1,{hasShip:!1,isHit:!0,missedShot:!0}):(e.board[t].isHit=!0,e.board[t].ship.hit())},checkShipState:()=>e.board.filter((e=>e.hasShip)).map((e=>e.ship)).every((e=>e.isSunk())),checkForValidPlacement:s,randomShipPlacement:t=>{let r=[],o=(e=>{for(let o=0;o<100-t.getLength();o++){let a=[];if("horiz"===e)for(let e=0;e<t.getLength();e++)a.push(o+e);else for(let e=0;e<t.getLength();e++)a.push(o+10*e);s(a)&&r.push(a)}return r[Math.floor(Math.random()*r.length)]})(["horiz","vert"][Math.floor(2*Math.random())]);for(let s=0;s<o.length;s++)e.board.splice(o[s],1,{hasShip:!0,isHit:!1,ship:t});e.locations.push(o)},getHits:()=>{const t=e.board,s=[];for(let e=0;e<t.length;e++)t[e].hasShip&&t[e].isHit&&s.push(e);return s},getMisses:()=>{const t=e.board,s=[];for(let e=0;e<t.length;e++)t[e].missedShot&&s.push(e);return s}}}function r(e){let t=function(e,t){const r={name:e,board:s(),playing:!0};return{getName:()=>r.name,setName:e=>r.name=e,attackEnemy:(e,t)=>{e.receiveAttack(t)},whoIsPlaying:()=>r.playing,switchRoles:()=>r.playing=!r.playing}}(e),r=function(e){const t={name:"computer",board:s(),playing:e,shotsFired:[]},r=(e,t)=>e.some((e=>e.toString()===t.toString())),o=()=>Math.floor(100*Math.random());return{getName:()=>t.name,attackEnemy:e=>{e.receiveAttack((e=>{let t;t=o();const s=[...e.getMisses(),...e.getHits()];for(;r(s,t);)t=o();return t})(e))},whoIsPlaying:()=>t.playing,switchRoles:()=>t.playing=!t.playing}}(!1),o=s(),a=s(),c=0;const i=()=>o.getFleet(),l=()=>a.getFleet(),n=()=>t.whoIsPlaying(),h=()=>r.whoIsPlaying(),d=()=>{n(),t.switchRoles(),r.switchRoles()};return{getPlayerFleet:i,getPlayerName:()=>t.getName(),getPlayerShipLocations:()=>o.getShipLocations(),getCPUFleet:l,placeCPUShips:()=>{const e=l();for(let t=0;t<e.length;t++)a.randomShipPlacement(e[t])},getShipToPlace:()=>i()[c],placePlayerShips:(e,t)=>{const s=i();o.shipPlacement(t,e,s[c]),c+=1},checkIfAllShipsArePlaced:()=>i().length===c,playerAttack:e=>{n()&&(t.attackEnemy(a,e),d())},cpuAttack:()=>{h()&&(r.attackEnemy(o),d())},playerWon:()=>a.checkShipState(),cpuWon:()=>o.checkShipState(),playerRole:n,cpuRole:h,switchPlayersRoles:d,isValidPlacement:e=>o.checkForValidPlacement(e),getPlayerMisses:()=>a.getMisses(),getCpuMisses:()=>o.getMisses(),getPlayerHits:()=>a.getHits(),getCpuHits:()=>o.getHits()}}(function(){const t=document.querySelector(".player-name"),s=document.querySelector("#name"),o=document.querySelector(".player-board > span"),a=document.querySelector(".player-name > button"),c=(document.querySelector(".board-container"),document.querySelector(".player-board > .board")),i=document.querySelector(".player-board "),l=document.querySelector(".cpu-board > .board"),n=document.querySelector(".cpu-board "),h=document.querySelector(".container"),d=document.querySelector(".axis"),u=document.querySelector(".start");let p=r(s.value),m="horizontal",g=p.getShipToPlace();const y=e=>{const t=[];if("horizontal"===m)for(let s=0;s<g.getLength();s++)t.push(e+s);else for(let s=0;s<g.getLength();s++)t.push(e+10*s);return t},S=()=>m="horizontal"===m?"vert":"horizontal",f=()=>{document.querySelector(".place-ships-text").remove(),(()=>{for(let t=0;t<100;t++){const s=e(t);l.appendChild(s)}})(),n.classList.remove("hide"),d.classList.add("hide"),u.classList.add("hide"),l.querySelectorAll(".empty.cell").forEach((e=>e.classList.add("shoot"))),p.placeCPUShips(),c.querySelectorAll(".hover").forEach((e=>e.classList.remove("hover")))};return{bindEvents:()=>{a.addEventListener("click",(()=>{if(""==s.value)return;i.classList.remove("hide"),o.textContent=s.value,(()=>{for(let t=0;t<100;t++){const s=e(t);c.appendChild(s)}})(),t.remove();const r=document.createElement("div");r.classList.add("place-ships-text"),r.textContent="Place your ships",h.appendChild(r)})),c.addEventListener("mouseout",(e=>{if(p.checkIfAllShipsArePlaced())return;const t=e.target,s=Number(t.getAttribute("coordinate"));y(s).forEach((e=>{const t=c.querySelector(`.empty.cell[coordinate="${e}"]`);t&&t.classList.remove("hover")}))})),c.addEventListener("mouseover",(e=>{if(p.checkIfAllShipsArePlaced())return;const t=e.target;if(t.classList.contains("cell","empty")){const e=Number(t.getAttribute("coordinate")),r=y(e);if(s=r,[9,19,29,39,49,59,69,79,89,99].some((e=>[e,e+1].every((e=>s.includes(e))))))return;r.forEach((e=>{const t=c.querySelector(`.empty.cell[coordinate="${e}"]`);t&&t.classList.add("hover")}))}var s})),c.addEventListener("click",(e=>{if(p.checkIfAllShipsArePlaced())return;const t=e.target;if(t.classList.contains("cell","empty")){const e=Number(t.getAttribute("coordinate")),s=y(e);if(!p.isValidPlacement(s))return;p.placePlayerShips(e,m),p.getPlayerShipLocations().forEach((e=>{document.querySelector(`.cell.empty[coordinate="${e}"]`).classList.add("placed")})),g=p.getShipToPlace(),p.checkIfAllShipsArePlaced()&&u.classList.remove("hide")}})),d.addEventListener("click",S),u.addEventListener("click",f),l.addEventListener("click",(e=>{const t=Number(e.target.getAttribute("coordinate"));if(p.cpuWon())return h.textContent="Computer Won";if(p.playerWon())return h.textContent="You won";if(e.target.classList.contains("empty")){if(p.playerRole()){p.playerAttack(t);const e=p.getPlayerHits(),s=p.getPlayerMisses();e.forEach((e=>{const t=l.querySelector(`.cell.empty[coordinate="${e}"]`);t.classList.remove("empty"),t.classList.add("hit")})),s.forEach((e=>{const t=l.querySelector(`.cell.empty[coordinate="${e}"]`);t.classList.remove("empty"),t.classList.add("miss")}))}if(p.cpuRole()){p.cpuAttack();const e=p.getCpuHits(),t=p.getCpuMisses();e.forEach((e=>{const t=c.querySelector(`.cell.empty[coordinate="${e}"]`);t.classList.remove("placed"),t.classList.add("hit")})),t.forEach((e=>{c.querySelector(`.cell.empty[coordinate="${e}"]`).classList.add("miss")}))}}}))}}})().bindEvents()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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a0IsSUFDcEIsTUFBTUQsRUFBVTdELEVBQVMwQixjQUN2QiwyQkFBMkJvQyxPQUU3QkQsRUFBUTdJLFVBQVV3SCxPQUFPLFNBQ3pCcUIsRUFBUTdJLFVBQVVDLElBQUksV0FJMUIsR0FBSW1ILEVBQUsvQixVQUFXLENBQ2xCK0IsRUFBS25CLFlBQ0wsTUFBTThDLEVBQVUzQixFQUFLWixhQUNmd0MsRUFBWTVCLEVBQUtkLGVBQ3ZCeUMsRUFBUW5CLFNBQVNqSCxJQUNmLE1BQU1rSSxFQUFVL0IsRUFBWUosY0FDMUIsMkJBQTJCL0YsT0FFN0JrSSxFQUFRN0ksVUFBVXdILE9BQU8sVUFDekJxQixFQUFRN0ksVUFBVUMsSUFBSSxVQUV4QitJLEVBQVVwQixTQUFTa0IsSUFDRGhDLEVBQVlKLGNBQzFCLDJCQUEyQm9DLE9BRXJCOUksVUFBVUMsSUFBSSxtQkMvTGxDZ0osR0FBb0JwQixjIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9jb21wb25lbnRzL2JvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvRmFjdG9yeUZ1bmN0aW9ucy9TaGlwcy5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL0ZhY3RvcnlGdW5jdGlvbnMvR2FtZWJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvTW9kdWxlcy9nYW1lLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvRmFjdG9yeUZ1bmN0aW9ucy9QbGF5ZXIuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9GYWN0b3J5RnVuY3Rpb25zL0NvbXB1dGVyUGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvTW9kdWxlcy9kaXNwbGF5Q29udHJvbGxlci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIGJvYXJkKGlkKSB7XG4gIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICBjZWxsLmNsYXNzTGlzdC5hZGQoXCJlbXB0eVwiKTtcbiAgY2VsbC5jbGFzc0xpc3QuYWRkKFwiY2VsbFwiKTtcbiAgY2VsbC5zZXRBdHRyaWJ1dGUoXCJjb29yZGluYXRlXCIsIGAke2lkfWApO1xuICByZXR1cm4gY2VsbDtcbn1cbmV4cG9ydCB7IGJvYXJkIH07XG4iLCJmdW5jdGlvbiBzaGlwcyhuYW1lLCBsZW5ndGgpIHtcbiAgY29uc3Qgc2hpcCA9IHtcbiAgICBuYW1lLFxuICAgIGxlbmd0aCxcbiAgICBoaXRzOiBbXSxcbiAgfTtcblxuICBjb25zdCBnZXROYW1lID0gKCkgPT4ge1xuICAgIHJldHVybiBzaGlwLm5hbWU7XG4gIH07XG4gIGNvbnN0IGdldExlbmd0aCA9ICgpID0+IHtcbiAgICByZXR1cm4gc2hpcC5sZW5ndGg7XG4gIH07XG4gIGNvbnN0IGdldEhpdHMgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHNoaXAuaGl0cztcbiAgfTtcblxuICBjb25zdCBoaXQgPSAoKSA9PiB7XG4gICAgc2hpcC5oaXRzLnB1c2goXCJoaXRcIik7XG4gIH07XG5cbiAgY29uc3QgaXNTdW5rID0gKCkgPT4ge1xuICAgIHJldHVybiBzaGlwLmhpdHMubGVuZ3RoID09PSBzaGlwLmxlbmd0aDtcbiAgfTtcblxuICByZXR1cm4geyBnZXRMZW5ndGgsIGdldE5hbWUsIGdldEhpdHMsIGhpdCwgaXNTdW5rIH07XG59XG5cbmV4cG9ydCB7IHNoaXBzIH07XG4iLCJpbXBvcnQgeyBzaGlwcyB9IGZyb20gXCIuL1NoaXBzXCI7XG5mdW5jdGlvbiBnYW1lQm9hcmQoKSB7XG4gIGNvbnN0IGdhbWVib2FyZCA9IHtcbiAgICBib2FyZDogQXJyYXkoMTAwKS5maWxsKHsgaGFzU2hpcDogZmFsc2UsIGlzSGl0OiBmYWxzZSB9KSxcbiAgICBmbGVldDogW1xuICAgICAgc2hpcHMoXCJjYXJyaWVyXCIsIDUpLFxuICAgICAgc2hpcHMoXCJiYXR0bGVzaGlwXCIsIDQpLFxuICAgICAgc2hpcHMoXCJjcnVpc2VyXCIsIDMpLFxuICAgICAgc2hpcHMoXCJzdWJtYXJpbmVcIiwgMyksXG4gICAgICBzaGlwcyhcImRlc3Ryb3llclwiLCAyKSxcbiAgICBdLFxuICAgIGxvY2F0aW9uczogW10sXG4gIH07XG5cbiAgY29uc3QgZ2V0Qm9hcmQgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGdhbWVib2FyZC5ib2FyZDtcbiAgfTtcblxuICBjb25zdCBnZXRTaGlwTG9jYXRpb25zID0gKCkgPT4ge1xuICAgIHJldHVybiBnYW1lYm9hcmQubG9jYXRpb25zLmZsYXQoKTtcbiAgfTtcblxuICBjb25zdCBnZXRGbGVldCA9ICgpID0+IHtcbiAgICByZXR1cm4gZ2FtZWJvYXJkLmZsZWV0O1xuICB9O1xuXG4gIGNvbnN0IHNoaXBMb2NhdGlvbiA9IChvcmllbnRhdGlvbiwgc3RhcnRpbmdQb3NpdGlvbiwgc2hpcCkgPT4ge1xuICAgIC8vIHJldHVybnMgYW4gYXJyYXkgb2YgbnVtYmVycyB0aGF0IHJlcHJlc2VudCBpbmRleGVzIG9uIHRoZSBib2FyZFxuICAgIGNvbnN0IGxvY2F0aW9uID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwLmdldExlbmd0aCgpOyBpKyspIHtcbiAgICAgIG9yaWVudGF0aW9uID09PSBcImhvcml6b250YWxcIlxuICAgICAgICA/IGxvY2F0aW9uLnB1c2goc3RhcnRpbmdQb3NpdGlvbiArIGkpXG4gICAgICAgIDogbG9jYXRpb24ucHVzaChzdGFydGluZ1Bvc2l0aW9uICsgaSAqIDEwKTtcbiAgICB9XG4gICAgcmV0dXJuIGxvY2F0aW9uO1xuICB9O1xuXG4gIGNvbnN0IHNoaXBQbGFjZW1lbnQgPSAob3JpZW50YXRpb24sIHN0YXJ0aW5nUG9zaXRpb24sIFNoaXApID0+IHtcbiAgICBjb25zdCBsb2NhdGlvbiA9IHNoaXBMb2NhdGlvbihvcmllbnRhdGlvbiwgc3RhcnRpbmdQb3NpdGlvbiwgU2hpcCk7XG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCBsb2NhdGlvbi5sZW5ndGg7IGorKykge1xuICAgICAgZ2FtZWJvYXJkLmJvYXJkLnNwbGljZShsb2NhdGlvbltqXSwgMSwge1xuICAgICAgICBoYXNTaGlwOiB0cnVlLFxuICAgICAgICBpc0hpdDogZmFsc2UsXG4gICAgICAgIHNoaXA6IFNoaXAsXG4gICAgICB9KTtcbiAgICB9XG4gICAgZ2FtZWJvYXJkLmxvY2F0aW9ucy5wdXNoKGxvY2F0aW9uKTtcbiAgICByZXR1cm4gbG9jYXRpb247XG4gIH07XG5cbiAgY29uc3QgY2hlY2tGb3JWYWxpZFBsYWNlbWVudCA9IChsb2NhdGlvbkFycmF5KSA9PiB7XG4gICAgY29uc3QgY29sbGlzaW9ucyA9IFs5LCAxOSwgMjksIDM5LCA0OSwgNTksIDY5LCA3OSwgODldO1xuICAgIGlmIChsb2NhdGlvbkFycmF5LnNvbWUoKGxvYykgPT4gIWdhbWVib2FyZC5ib2FyZFtsb2NdKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gZWxzZSBpZiAobG9jYXRpb25BcnJheS5zb21lKChsb2MpID0+IGdhbWVib2FyZC5ib2FyZFtsb2NdLmhhc1NoaXApKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIGNvbGxpc2lvbnMuc29tZSgobnVtKSA9PiB7XG4gICAgICAgIHJldHVybiBbbnVtLCBudW0gKyAxXS5ldmVyeSgoY29tYmluYXRpb24pID0+XG4gICAgICAgICAgbG9jYXRpb25BcnJheS5pbmNsdWRlcyhjb21iaW5hdGlvbilcbiAgICAgICAgKTtcbiAgICAgIH0pXG4gICAgKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCByYW5kb21TaGlwUGxhY2VtZW50ID0gKHNoaXApID0+IHtcbiAgICBsZXQgYWxsUG9zc2libGVMb2NhdGlvbnMgPSBbXTtcblxuICAgIC8vIHJldHVybnMgYSByYW5kb20gb3JpZW50YXRpb25cblxuICAgIGNvbnN0IHJhbmRvbU9yaWVudGF0aW9uID0gKCkgPT5cbiAgICAgIFtcImhvcml6XCIsIFwidmVydFwiXVtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKV07XG5cbiAgICAvLyBmaW5kcyBhbGwgcG9zc2libGUgbG9jYXRpb25zIGEgc2hpcCBjYW4gYmUgcGxhY2VkIGF0XG5cbiAgICBjb25zdCBmaW5kQWxsUG9zc2libGVMb2NhdGlvbnMgPSAob3JpZW50YXRpb24pID0+IHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTAwIC0gc2hpcC5nZXRMZW5ndGgoKTsgaSsrKSB7XG4gICAgICAgIGxldCBsb2NhdGlvbkFycmF5ID0gW107XG5cbiAgICAgICAgaWYgKG9yaWVudGF0aW9uID09PSBcImhvcml6XCIpXG4gICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGlwLmdldExlbmd0aCgpOyBqKyspIHtcbiAgICAgICAgICAgIGxvY2F0aW9uQXJyYXkucHVzaChpICsgaik7XG4gICAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGlwLmdldExlbmd0aCgpOyBqKyspIHtcbiAgICAgICAgICAgIGxvY2F0aW9uQXJyYXkucHVzaChpICsgaiAqIDEwKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgLy8gY2hlY2tzIHdoZXRoZXIgdGhlIGNyZWF0ZWQgbG9jYXRpb24gaXMgdmFsaWQgb3Igbm90XG5cbiAgICAgICAgaWYgKGNoZWNrRm9yVmFsaWRQbGFjZW1lbnQobG9jYXRpb25BcnJheSkpXG4gICAgICAgICAgYWxsUG9zc2libGVMb2NhdGlvbnMucHVzaChsb2NhdGlvbkFycmF5KTtcbiAgICAgIH1cblxuICAgICAgLy8gcmV0dXJucyBvbmUgcmFuZG9tIHNoaXAgbG9jYXRpb24gb3V0IG9mIG1hbnlcblxuICAgICAgcmV0dXJuIGFsbFBvc3NpYmxlTG9jYXRpb25zW1xuICAgICAgICBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBhbGxQb3NzaWJsZUxvY2F0aW9ucy5sZW5ndGgpXG4gICAgICBdO1xuICAgIH07XG5cbiAgICBsZXQgbG9jYXRpb24gPSBmaW5kQWxsUG9zc2libGVMb2NhdGlvbnMocmFuZG9tT3JpZW50YXRpb24oKSk7XG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCBsb2NhdGlvbi5sZW5ndGg7IGorKykge1xuICAgICAgZ2FtZWJvYXJkLmJvYXJkLnNwbGljZShsb2NhdGlvbltqXSwgMSwge1xuICAgICAgICBoYXNTaGlwOiB0cnVlLFxuICAgICAgICBpc0hpdDogZmFsc2UsXG4gICAgICAgIHNoaXA6IHNoaXAsXG4gICAgICB9KTtcbiAgICB9XG4gICAgZ2FtZWJvYXJkLmxvY2F0aW9ucy5wdXNoKGxvY2F0aW9uKTtcbiAgfTtcblxuICBjb25zdCByZWNlaXZlQXR0YWNrID0gKGNvb3JkaW5hdGUpID0+IHtcbiAgICBpZiAoZ2FtZWJvYXJkLmJvYXJkW2Nvb3JkaW5hdGVdLmhhc1NoaXAgPT0gZmFsc2UpXG4gICAgICBnYW1lYm9hcmQuYm9hcmQuc3BsaWNlKGNvb3JkaW5hdGUsIDEsIHtcbiAgICAgICAgaGFzU2hpcDogZmFsc2UsXG4gICAgICAgIGlzSGl0OiB0cnVlLFxuICAgICAgICBtaXNzZWRTaG90OiB0cnVlLFxuICAgICAgfSk7XG4gICAgZWxzZSB7XG4gICAgICBnYW1lYm9hcmQuYm9hcmRbY29vcmRpbmF0ZV0uaXNIaXQgPSB0cnVlO1xuICAgICAgZ2FtZWJvYXJkLmJvYXJkW2Nvb3JkaW5hdGVdLnNoaXAuaGl0KCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGNoZWNrU2hpcFN0YXRlID0gKCkgPT4ge1xuICAgIHJldHVybiBnYW1lYm9hcmQuYm9hcmRcbiAgICAgIC5maWx0ZXIoKGVsKSA9PiBlbC5oYXNTaGlwKVxuICAgICAgLm1hcCgoZWwpID0+IGVsLnNoaXApXG4gICAgICAuZXZlcnkoKGVsKSA9PiBlbC5pc1N1bmsoKSk7XG4gIH07XG5cbiAgY29uc3QgZ2V0TWlzc2VzID0gKCkgPT4ge1xuICAgIGNvbnN0IGJvYXJkID0gZ2FtZWJvYXJkLmJvYXJkO1xuICAgIGNvbnN0IG1pc3NlcyA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9hcmQubGVuZ3RoOyBpKyspXG4gICAgICBpZiAoYm9hcmRbaV0ubWlzc2VkU2hvdCkgbWlzc2VzLnB1c2goaSk7XG4gICAgcmV0dXJuIG1pc3NlcztcbiAgfTtcblxuICBjb25zdCBnZXRIaXRzID0gKCkgPT4ge1xuICAgIGNvbnN0IGJvYXJkID0gZ2FtZWJvYXJkLmJvYXJkO1xuICAgIGNvbnN0IGhpdHMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJvYXJkLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoYm9hcmRbaV0uaGFzU2hpcCAmJiBib2FyZFtpXS5pc0hpdCkgaGl0cy5wdXNoKGkpO1xuICAgIH1cbiAgICByZXR1cm4gaGl0cztcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGdldEJvYXJkLFxuICAgIGdldEZsZWV0LFxuICAgIGdldFNoaXBMb2NhdGlvbnMsXG4gICAgc2hpcFBsYWNlbWVudCxcbiAgICByZWNlaXZlQXR0YWNrLFxuICAgIGNoZWNrU2hpcFN0YXRlLFxuICAgIGNoZWNrRm9yVmFsaWRQbGFjZW1lbnQsXG4gICAgcmFuZG9tU2hpcFBsYWNlbWVudCxcbiAgICBnZXRIaXRzLFxuICAgIGdldE1pc3NlcyxcbiAgfTtcbn1cblxuZXhwb3J0IHsgZ2FtZUJvYXJkIH07XG4iLCJpbXBvcnQgeyBnYW1lQm9hcmQgfSBmcm9tIFwiLi4vRmFjdG9yeUZ1bmN0aW9ucy9HYW1lYm9hcmRcIjtcbmltcG9ydCB7IHBsYXllciB9IGZyb20gXCIuLi9GYWN0b3J5RnVuY3Rpb25zL1BsYXllclwiO1xuaW1wb3J0IHsgY29tcHV0ZXJQbGF5ZXIgfSBmcm9tIFwiLi4vRmFjdG9yeUZ1bmN0aW9ucy9Db21wdXRlclBsYXllclwiO1xuXG5mdW5jdGlvbiBnYW1lKG5hbWUpIHtcbiAgbGV0IGh1bWFuUGxheWVyID0gcGxheWVyKG5hbWUsIHRydWUpO1xuICBsZXQgY3B1UGxheWVyID0gY29tcHV0ZXJQbGF5ZXIoZmFsc2UpO1xuICBsZXQgaHVtYW5Cb2FyZCA9IGdhbWVCb2FyZCgpO1xuICBsZXQgY3B1Qm9hcmQgPSBnYW1lQm9hcmQoKTtcbiAgbGV0IHNoaXBUb1BsYWNlID0gMDtcblxuICBjb25zdCBnZXRQbGF5ZXJGbGVldCA9ICgpID0+IHtcbiAgICByZXR1cm4gaHVtYW5Cb2FyZC5nZXRGbGVldCgpO1xuICB9O1xuXG4gIGNvbnN0IGdldFBsYXllck5hbWUgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGh1bWFuUGxheWVyLmdldE5hbWUoKTtcbiAgfTtcblxuICBjb25zdCBnZXRQbGF5ZXJTaGlwTG9jYXRpb25zID0gKCkgPT4ge1xuICAgIHJldHVybiBodW1hbkJvYXJkLmdldFNoaXBMb2NhdGlvbnMoKTtcbiAgfTtcblxuICBjb25zdCBnZXRDUFVGbGVldCA9ICgpID0+IHtcbiAgICByZXR1cm4gY3B1Qm9hcmQuZ2V0RmxlZXQoKTtcbiAgfTtcblxuICBjb25zdCBnZXRTaGlwVG9QbGFjZSA9ICgpID0+IHtcbiAgICBjb25zdCBmbGVldCA9IGdldFBsYXllckZsZWV0KCk7XG4gICAgY29uc3Qgc2hpcCA9IGZsZWV0W3NoaXBUb1BsYWNlXTtcbiAgICByZXR1cm4gc2hpcDtcbiAgfTtcblxuICBjb25zdCBwbGFjZUNQVVNoaXBzID0gKCkgPT4ge1xuICAgIGNvbnN0IGNwdUZsZWV0ID0gZ2V0Q1BVRmxlZXQoKTtcbiAgICBmb3IgKGxldCBzaGlwID0gMDsgc2hpcCA8IGNwdUZsZWV0Lmxlbmd0aDsgc2hpcCsrKVxuICAgICAgY3B1Qm9hcmQucmFuZG9tU2hpcFBsYWNlbWVudChjcHVGbGVldFtzaGlwXSk7XG4gIH07XG5cbiAgY29uc3QgcGxhY2VQbGF5ZXJTaGlwcyA9IChsb2NhdGlvbiwgYXhpcykgPT4ge1xuICAgIGNvbnN0IHBsYXllckZsZWV0ID0gZ2V0UGxheWVyRmxlZXQoKTtcbiAgICBodW1hbkJvYXJkLnNoaXBQbGFjZW1lbnQoYXhpcywgbG9jYXRpb24sIHBsYXllckZsZWV0W3NoaXBUb1BsYWNlXSk7XG4gICAgc2hpcFRvUGxhY2UgKz0gMTtcbiAgfTtcblxuICBjb25zdCBjaGVja0lmQWxsU2hpcHNBcmVQbGFjZWQgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGdldFBsYXllckZsZWV0KCkubGVuZ3RoID09PSBzaGlwVG9QbGFjZTtcbiAgfTtcblxuICBjb25zdCBwbGF5ZXJBdHRhY2sgPSAoY29vcmRpbmF0ZSkgPT4ge1xuICAgIGlmIChwbGF5ZXJSb2xlKCkpIHtcbiAgICAgIGh1bWFuUGxheWVyLmF0dGFja0VuZW15KGNwdUJvYXJkLCBjb29yZGluYXRlKTtcbiAgICAgIHN3aXRjaFBsYXllcnNSb2xlcygpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBjcHVBdHRhY2sgPSAoKSA9PiB7XG4gICAgaWYgKGNwdVJvbGUoKSkge1xuICAgICAgY3B1UGxheWVyLmF0dGFja0VuZW15KGh1bWFuQm9hcmQpO1xuICAgICAgc3dpdGNoUGxheWVyc1JvbGVzKCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHBsYXllcldvbiA9ICgpID0+IHtcbiAgICByZXR1cm4gY3B1Qm9hcmQuY2hlY2tTaGlwU3RhdGUoKTtcbiAgfTtcblxuICBjb25zdCBjcHVXb24gPSAoKSA9PiB7XG4gICAgcmV0dXJuIGh1bWFuQm9hcmQuY2hlY2tTaGlwU3RhdGUoKTtcbiAgfTtcblxuICBjb25zdCBwbGF5ZXJSb2xlID0gKCkgPT4ge1xuICAgIHJldHVybiBodW1hblBsYXllci53aG9Jc1BsYXlpbmcoKTtcbiAgfTtcblxuICBjb25zdCBjcHVSb2xlID0gKCkgPT4ge1xuICAgIHJldHVybiBjcHVQbGF5ZXIud2hvSXNQbGF5aW5nKCk7XG4gIH07XG5cbiAgY29uc3Qgc3dpdGNoUGxheWVyc1JvbGVzID0gKCkgPT4ge1xuICAgIGlmIChwbGF5ZXJSb2xlKCkpIHtcbiAgICAgIGh1bWFuUGxheWVyLnN3aXRjaFJvbGVzKCk7XG4gICAgICBjcHVQbGF5ZXIuc3dpdGNoUm9sZXMoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaHVtYW5QbGF5ZXIuc3dpdGNoUm9sZXMoKTtcbiAgICAgIGNwdVBsYXllci5zd2l0Y2hSb2xlcygpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBpc1ZhbGlkUGxhY2VtZW50ID0gKGxvY2F0aW9uKSA9PiB7XG4gICAgcmV0dXJuIGh1bWFuQm9hcmQuY2hlY2tGb3JWYWxpZFBsYWNlbWVudChsb2NhdGlvbik7XG4gIH07XG5cbiAgY29uc3QgZ2V0UGxheWVyTWlzc2VzID0gKCkgPT4ge1xuICAgIHJldHVybiBjcHVCb2FyZC5nZXRNaXNzZXMoKTtcbiAgfTtcblxuICBjb25zdCBnZXRDcHVNaXNzZXMgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGh1bWFuQm9hcmQuZ2V0TWlzc2VzKCk7XG4gIH07XG5cbiAgY29uc3QgZ2V0UGxheWVySGl0cyA9ICgpID0+IHtcbiAgICByZXR1cm4gY3B1Qm9hcmQuZ2V0SGl0cygpO1xuICB9O1xuXG4gIGNvbnN0IGdldENwdUhpdHMgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGh1bWFuQm9hcmQuZ2V0SGl0cygpO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgZ2V0UGxheWVyRmxlZXQsXG4gICAgZ2V0UGxheWVyTmFtZSxcbiAgICBnZXRQbGF5ZXJTaGlwTG9jYXRpb25zLFxuICAgIGdldENQVUZsZWV0LFxuICAgIHBsYWNlQ1BVU2hpcHMsXG4gICAgZ2V0U2hpcFRvUGxhY2UsXG4gICAgcGxhY2VQbGF5ZXJTaGlwcyxcbiAgICBjaGVja0lmQWxsU2hpcHNBcmVQbGFjZWQsXG4gICAgcGxheWVyQXR0YWNrLFxuICAgIGNwdUF0dGFjayxcbiAgICBwbGF5ZXJXb24sXG4gICAgY3B1V29uLFxuICAgIHBsYXllclJvbGUsXG4gICAgY3B1Um9sZSxcbiAgICBzd2l0Y2hQbGF5ZXJzUm9sZXMsXG4gICAgaXNWYWxpZFBsYWNlbWVudCxcbiAgICBnZXRQbGF5ZXJNaXNzZXMsXG4gICAgZ2V0Q3B1TWlzc2VzLFxuICAgIGdldFBsYXllckhpdHMsXG4gICAgZ2V0Q3B1SGl0cyxcbiAgfTtcbn1cblxuZXhwb3J0IHsgZ2FtZSB9O1xuIiwiaW1wb3J0IHsgZ2FtZUJvYXJkIH0gZnJvbSBcIi4vR2FtZWJvYXJkXCI7XG5mdW5jdGlvbiBwbGF5ZXIobmFtZSwgcGxheWluZykge1xuICBjb25zdCBwbGF5ZXJJbmZvID0ge1xuICAgIG5hbWUsXG4gICAgYm9hcmQ6IGdhbWVCb2FyZCgpLFxuICAgIHBsYXlpbmcsXG4gIH07XG5cbiAgY29uc3Qgd2hvSXNQbGF5aW5nID0gKCkgPT4ge1xuICAgIHJldHVybiBwbGF5ZXJJbmZvLnBsYXlpbmc7XG4gIH07XG5cbiAgY29uc3Qgc3dpdGNoUm9sZXMgPSAoKSA9PiB7XG4gICAgcmV0dXJuIChwbGF5ZXJJbmZvLnBsYXlpbmcgPSAhcGxheWVySW5mby5wbGF5aW5nKTtcbiAgfTtcblxuICBjb25zdCBnZXROYW1lID0gKCkgPT4ge1xuICAgIHJldHVybiBwbGF5ZXJJbmZvLm5hbWU7XG4gIH07XG5cbiAgY29uc3Qgc2V0TmFtZSA9ICh2YWx1ZSkgPT4ge1xuICAgIHJldHVybiAocGxheWVySW5mby5uYW1lID0gdmFsdWUpO1xuICB9O1xuXG4gIGNvbnN0IGF0dGFja0VuZW15ID0gKGVuZW15Qm9hcmQsIHNob3QpID0+IHtcbiAgICBlbmVteUJvYXJkLnJlY2VpdmVBdHRhY2soc2hvdCk7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBnZXROYW1lLFxuICAgIHNldE5hbWUsXG4gICAgYXR0YWNrRW5lbXksXG4gICAgd2hvSXNQbGF5aW5nLFxuICAgIHN3aXRjaFJvbGVzLFxuICB9O1xufVxuXG5leHBvcnQgeyBwbGF5ZXIgfTtcbiIsImltcG9ydCB7IGdhbWVCb2FyZCB9IGZyb20gXCIuL0dhbWVib2FyZFwiO1xuZnVuY3Rpb24gY29tcHV0ZXJQbGF5ZXIocGxheWluZykge1xuICBjb25zdCBwbGF5ZXJJbmZvID0ge1xuICAgIG5hbWU6IFwiY29tcHV0ZXJcIixcbiAgICBib2FyZDogZ2FtZUJvYXJkKCksXG4gICAgcGxheWluZyxcbiAgICBzaG90c0ZpcmVkOiBbXSxcbiAgfTtcblxuICBjb25zdCB3aG9Jc1BsYXlpbmcgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHBsYXllckluZm8ucGxheWluZztcbiAgfTtcblxuICBjb25zdCBzd2l0Y2hSb2xlcyA9ICgpID0+IHtcbiAgICByZXR1cm4gKHBsYXllckluZm8ucGxheWluZyA9ICFwbGF5ZXJJbmZvLnBsYXlpbmcpO1xuICB9O1xuXG4gIGNvbnN0IGdldE5hbWUgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHBsYXllckluZm8ubmFtZTtcbiAgfTtcblxuICBjb25zdCBpbmNsdWRlcyA9IChjb29yZGluYXRlcywgY29vcmRpbmF0ZSkgPT5cbiAgICBjb29yZGluYXRlcy5zb21lKChjZWxsKSA9PiBjZWxsLnRvU3RyaW5nKCkgPT09IGNvb3JkaW5hdGUudG9TdHJpbmcoKSk7XG5cbiAgY29uc3QgcmFuZG9tSW5kZXggPSAoKSA9PiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDApO1xuXG4gIGNvbnN0IGNoZWNrUmFuZG9tSW5kZXggPSAoYm9hcmQpID0+IHtcbiAgICBsZXQgY29vcmRpYXRlO1xuICAgIGNvb3JkaWF0ZSA9IHJhbmRvbUluZGV4KCk7XG4gICAgY29uc3QgZGFtYWdlZENlbGxzID0gWy4uLmJvYXJkLmdldE1pc3NlcygpLCAuLi5ib2FyZC5nZXRIaXRzKCldO1xuICAgIHdoaWxlIChpbmNsdWRlcyhkYW1hZ2VkQ2VsbHMsIGNvb3JkaWF0ZSkpIGNvb3JkaWF0ZSA9IHJhbmRvbUluZGV4KCk7XG4gICAgcmV0dXJuIGNvb3JkaWF0ZTtcbiAgfTtcbiAgY29uc3QgYXR0YWNrRW5lbXkgPSAoZW5lbXlCb2FyZCkgPT4ge1xuICAgIGVuZW15Qm9hcmQucmVjZWl2ZUF0dGFjayhjaGVja1JhbmRvbUluZGV4KGVuZW15Qm9hcmQpKTtcbiAgfTtcblxuICByZXR1cm4geyBnZXROYW1lLCBhdHRhY2tFbmVteSwgd2hvSXNQbGF5aW5nLCBzd2l0Y2hSb2xlcyB9O1xufVxuZXhwb3J0IHsgY29tcHV0ZXJQbGF5ZXIgfTtcbiIsImltcG9ydCB7IGJvYXJkIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvYm9hcmRcIjtcbmltcG9ydCB7IGdhbWUgfSBmcm9tIFwiLi9nYW1lXCI7XG5cbmZ1bmN0aW9uIGRpc3BsYXlDb250cm9sbGVyKCkge1xuICBjb25zdCBuYW1lU2NyZWVuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItbmFtZVwiKTtcbiAgY29uc3QgbmFtZUlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNuYW1lXCIpO1xuICBjb25zdCBwbGF5ZXJOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItYm9hcmQgPiBzcGFuXCIpO1xuICBjb25zdCBwbGF5QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItbmFtZSA+IGJ1dHRvblwiKTtcbiAgY29uc3QgYm9hcmRDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmJvYXJkLWNvbnRhaW5lclwiKTtcbiAgY29uc3QgcGxheWVyQm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci1ib2FyZCA+IC5ib2FyZFwiKTtcbiAgY29uc3QgcGxheWVyQm9hcmRDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci1ib2FyZCBcIik7XG4gIGNvbnN0IGNwdUJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jcHUtYm9hcmQgPiAuYm9hcmRcIik7XG4gIGNvbnN0IGNwdUJvYXJkQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jcHUtYm9hcmQgXCIpO1xuICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNvbnRhaW5lclwiKTtcbiAgY29uc3QgY2hhbmdlQXhpcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYXhpc1wiKTtcbiAgY29uc3Qgc3RhcnRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnN0YXJ0XCIpO1xuICBsZXQgR2FtZSA9IGdhbWUobmFtZUlucHV0LnZhbHVlKTtcbiAgbGV0IGF4aXMgPSBcImhvcml6b250YWxcIjtcbiAgbGV0IHNoaXBUb1BsYWNlID0gR2FtZS5nZXRTaGlwVG9QbGFjZSgpO1xuXG4gIGNvbnN0IHJlbmRlclBsYXllckJvYXJkID0gKCkgPT4ge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTAwOyBpKyspIHtcbiAgICAgIGNvbnN0IGNlbGwgPSBib2FyZChpKTtcbiAgICAgIHBsYXllckJvYXJkLmFwcGVuZENoaWxkKGNlbGwpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCByZW5kZXJDcHVCb2FyZCA9ICgpID0+IHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDsgaSsrKSB7XG4gICAgICBjb25zdCBjZWxsID0gYm9hcmQoaSk7XG4gICAgICBjcHVCb2FyZC5hcHBlbmRDaGlsZChjZWxsKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZ2VuZXJhdGVCbG9jayA9IChjb29yZGluYXRlKSA9PiB7XG4gICAgY29uc3QgbG9jYXRpb24gPSBbXTtcbiAgICBpZiAoYXhpcyA9PT0gXCJob3Jpem9udGFsXCIpXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBUb1BsYWNlLmdldExlbmd0aCgpOyBpKyspIHtcbiAgICAgICAgbG9jYXRpb24ucHVzaChjb29yZGluYXRlICsgaSk7XG4gICAgICB9XG4gICAgZWxzZVxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwVG9QbGFjZS5nZXRMZW5ndGgoKTsgaSsrKSB7XG4gICAgICAgIGxvY2F0aW9uLnB1c2goY29vcmRpbmF0ZSArIGkgKiAxMCk7XG4gICAgICB9XG4gICAgcmV0dXJuIGxvY2F0aW9uO1xuICB9O1xuXG4gIGNvbnN0IGNoZWNrRm9yVmFsaWRQbGFjZW1lbnQgPSAobG9jYXRpb25BcnJheSkgPT4ge1xuICAgIGNvbnN0IGNvbGxpc2lvbnMgPSBbOSwgMTksIDI5LCAzOSwgNDksIDU5LCA2OSwgNzksIDg5LCA5OV07XG4gICAgaWYgKFxuICAgICAgY29sbGlzaW9ucy5zb21lKChudW0pID0+IHtcbiAgICAgICAgcmV0dXJuIFtudW0sIG51bSArIDFdLmV2ZXJ5KChjb21iaW5hdGlvbikgPT5cbiAgICAgICAgICBsb2NhdGlvbkFycmF5LmluY2x1ZGVzKGNvbWJpbmF0aW9uKVxuICAgICAgICApO1xuICAgICAgfSlcbiAgICApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHJlbmRlclNoaXBzID0gKCkgPT4ge1xuICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gR2FtZS5nZXRQbGF5ZXJTaGlwTG9jYXRpb25zKCk7XG4gICAgY29vcmRpbmF0ZXMuZm9yRWFjaCgoY29vcmRpbmF0ZSkgPT4ge1xuICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgIGAuY2VsbC5lbXB0eVtjb29yZGluYXRlPVwiJHtjb29yZGluYXRlfVwiXWBcbiAgICAgICk7XG4gICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoXCJwbGFjZWRcIik7XG4gICAgfSk7XG4gIH07XG5cbiAgY29uc3QgY2hhbmdlT3JpZW50YXRpb24gPSAoKSA9PiB7XG4gICAgaWYgKGF4aXMgPT09IFwiaG9yaXpvbnRhbFwiKSByZXR1cm4gKGF4aXMgPSBcInZlcnRcIik7XG4gICAgZWxzZSByZXR1cm4gKGF4aXMgPSBcImhvcml6b250YWxcIik7XG4gIH07XG5cbiAgY29uc3Qgc3RhcnRCYXR0bGUgPSAoKSA9PiB7XG4gICAgY29uc3QgcGxhY2VTaGlwc1RleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYWNlLXNoaXBzLXRleHRcIik7XG4gICAgcGxhY2VTaGlwc1RleHQucmVtb3ZlKCk7XG4gICAgcmVuZGVyQ3B1Qm9hcmQoKTtcbiAgICBjcHVCb2FyZENvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZVwiKTtcbiAgICBjaGFuZ2VBeGlzLmNsYXNzTGlzdC5hZGQoXCJoaWRlXCIpO1xuICAgIHN0YXJ0QnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJoaWRlXCIpO1xuICAgIGNvbnN0IGNwdUNlbGxzID0gY3B1Qm9hcmQucXVlcnlTZWxlY3RvckFsbChcIi5lbXB0eS5jZWxsXCIpO1xuICAgIGNwdUNlbGxzLmZvckVhY2goKGNlbGwpID0+IGNlbGwuY2xhc3NMaXN0LmFkZChcInNob290XCIpKTtcbiAgICBHYW1lLnBsYWNlQ1BVU2hpcHMoKTtcbiAgICBjb25zdCBwbGF5ZXJDZWxscyA9IHBsYXllckJvYXJkLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuaG92ZXJcIik7XG4gICAgcGxheWVyQ2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4gY2VsbC5jbGFzc0xpc3QucmVtb3ZlKFwiaG92ZXJcIikpO1xuICB9O1xuXG4gIGNvbnN0IGJpbmRFdmVudHMgPSAoKSA9PiB7XG4gICAgcGxheUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgaWYgKG5hbWVJbnB1dC52YWx1ZSA9PSBcIlwiKSByZXR1cm47XG4gICAgICBwbGF5ZXJCb2FyZENvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZVwiKTtcbiAgICAgIHBsYXllck5hbWUudGV4dENvbnRlbnQgPSBuYW1lSW5wdXQudmFsdWU7XG4gICAgICByZW5kZXJQbGF5ZXJCb2FyZCgpO1xuICAgICAgbmFtZVNjcmVlbi5yZW1vdmUoKTtcbiAgICAgIGNvbnN0IHBsYWNlU2hpcHNUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHBsYWNlU2hpcHNUZXh0LmNsYXNzTGlzdC5hZGQoXCJwbGFjZS1zaGlwcy10ZXh0XCIpO1xuICAgICAgcGxhY2VTaGlwc1RleHQudGV4dENvbnRlbnQgPSBcIlBsYWNlIHlvdXIgc2hpcHNcIjtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChwbGFjZVNoaXBzVGV4dCk7XG4gICAgfSk7XG5cbiAgICBwbGF5ZXJCb2FyZC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdXRcIiwgKGUpID0+IHtcbiAgICAgIGlmIChHYW1lLmNoZWNrSWZBbGxTaGlwc0FyZVBsYWNlZCgpKSByZXR1cm47XG4gICAgICBjb25zdCBjZWxsID0gZS50YXJnZXQ7XG4gICAgICBjb25zdCBzdGFydGluZ1BvaW50ID0gTnVtYmVyKGNlbGwuZ2V0QXR0cmlidXRlKFwiY29vcmRpbmF0ZVwiKSk7XG4gICAgICBjb25zdCBibG9jayA9IGdlbmVyYXRlQmxvY2soc3RhcnRpbmdQb2ludCk7XG4gICAgICBibG9jay5mb3JFYWNoKChzcXVhcmUpID0+IHtcbiAgICAgICAgY29uc3QgY2VsbCA9IHBsYXllckJvYXJkLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgYC5lbXB0eS5jZWxsW2Nvb3JkaW5hdGU9XCIke3NxdWFyZX1cIl1gXG4gICAgICAgICk7XG4gICAgICAgIGlmIChjZWxsKSBjZWxsLmNsYXNzTGlzdC5yZW1vdmUoXCJob3ZlclwiKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgcGxheWVyQm9hcmQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLCAoZSkgPT4ge1xuICAgICAgaWYgKEdhbWUuY2hlY2tJZkFsbFNoaXBzQXJlUGxhY2VkKCkpIHJldHVybjtcbiAgICAgIGNvbnN0IGNlbGwgPSBlLnRhcmdldDtcbiAgICAgIGlmIChjZWxsLmNsYXNzTGlzdC5jb250YWlucyhcImNlbGxcIiwgXCJlbXB0eVwiKSkge1xuICAgICAgICBjb25zdCBzdGFydGluZ1BvaW50ID0gTnVtYmVyKGNlbGwuZ2V0QXR0cmlidXRlKFwiY29vcmRpbmF0ZVwiKSk7XG4gICAgICAgIGNvbnN0IGJsb2NrID0gZ2VuZXJhdGVCbG9jayhzdGFydGluZ1BvaW50KTtcbiAgICAgICAgaWYgKCFjaGVja0ZvclZhbGlkUGxhY2VtZW50KGJsb2NrKSkgcmV0dXJuO1xuICAgICAgICBibG9jay5mb3JFYWNoKChzcXVhcmUpID0+IHtcbiAgICAgICAgICBjb25zdCBjZWxsID0gcGxheWVyQm9hcmQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgIGAuZW1wdHkuY2VsbFtjb29yZGluYXRlPVwiJHtzcXVhcmV9XCJdYFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKGNlbGwpIGNlbGwuY2xhc3NMaXN0LmFkZChcImhvdmVyXCIpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHBsYXllckJvYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgaWYgKEdhbWUuY2hlY2tJZkFsbFNoaXBzQXJlUGxhY2VkKCkpIHJldHVybjtcbiAgICAgIGNvbnN0IGNlbGwgPSBlLnRhcmdldDtcbiAgICAgIGlmIChjZWxsLmNsYXNzTGlzdC5jb250YWlucyhcImNlbGxcIiwgXCJlbXB0eVwiKSkge1xuICAgICAgICBjb25zdCBzdGFydGluZ1BvaW50ID0gTnVtYmVyKGNlbGwuZ2V0QXR0cmlidXRlKFwiY29vcmRpbmF0ZVwiKSk7XG4gICAgICAgIGNvbnN0IGJsb2NrID0gZ2VuZXJhdGVCbG9jayhzdGFydGluZ1BvaW50KTtcbiAgICAgICAgaWYgKCFHYW1lLmlzVmFsaWRQbGFjZW1lbnQoYmxvY2spKSByZXR1cm47XG4gICAgICAgIEdhbWUucGxhY2VQbGF5ZXJTaGlwcyhzdGFydGluZ1BvaW50LCBheGlzKTtcbiAgICAgICAgcmVuZGVyU2hpcHMoKTtcbiAgICAgICAgc2hpcFRvUGxhY2UgPSBHYW1lLmdldFNoaXBUb1BsYWNlKCk7XG4gICAgICAgIGlmIChHYW1lLmNoZWNrSWZBbGxTaGlwc0FyZVBsYWNlZCgpKVxuICAgICAgICAgIHN0YXJ0QnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRlXCIpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgY2hhbmdlQXhpcy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY2hhbmdlT3JpZW50YXRpb24pO1xuXG4gICAgc3RhcnRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHN0YXJ0QmF0dGxlKTtcblxuICAgIGNwdUJvYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgY29uc3QgY2VsbFRvQXR0YWNrID0gTnVtYmVyKGUudGFyZ2V0LmdldEF0dHJpYnV0ZShcImNvb3JkaW5hdGVcIikpO1xuICAgICAgaWYgKEdhbWUuY3B1V29uKCkpIHJldHVybiAoY29udGFpbmVyLnRleHRDb250ZW50ID0gXCJDb21wdXRlciBXb25cIik7XG4gICAgICBpZiAoR2FtZS5wbGF5ZXJXb24oKSkgcmV0dXJuIChjb250YWluZXIudGV4dENvbnRlbnQgPSBcIllvdSB3b25cIik7XG4gICAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiZW1wdHlcIikpIHtcbiAgICAgICAgaWYgKEdhbWUucGxheWVyUm9sZSgpKSB7XG4gICAgICAgICAgR2FtZS5wbGF5ZXJBdHRhY2soY2VsbFRvQXR0YWNrKTtcbiAgICAgICAgICBjb25zdCBwbGF5ZXJIaXRzID0gR2FtZS5nZXRQbGF5ZXJIaXRzKCk7XG4gICAgICAgICAgY29uc3QgcGxheWVyTWlzc2VzID0gR2FtZS5nZXRQbGF5ZXJNaXNzZXMoKTtcbiAgICAgICAgICBwbGF5ZXJIaXRzLmZvckVhY2goKGhpdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaGl0Q2VsbCA9IGNwdUJvYXJkLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgICAgIGAuY2VsbC5lbXB0eVtjb29yZGluYXRlPVwiJHtoaXR9XCJdYFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGhpdENlbGwuY2xhc3NMaXN0LnJlbW92ZShcImVtcHR5XCIpO1xuICAgICAgICAgICAgaGl0Q2VsbC5jbGFzc0xpc3QuYWRkKFwiaGl0XCIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHBsYXllck1pc3Nlcy5mb3JFYWNoKChtaXNzKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBoaXRDZWxsID0gY3B1Qm9hcmQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgICAgYC5jZWxsLmVtcHR5W2Nvb3JkaW5hdGU9XCIke21pc3N9XCJdYFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGhpdENlbGwuY2xhc3NMaXN0LnJlbW92ZShcImVtcHR5XCIpO1xuICAgICAgICAgICAgaGl0Q2VsbC5jbGFzc0xpc3QuYWRkKFwibWlzc1wiKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChHYW1lLmNwdVJvbGUoKSkge1xuICAgICAgICAgIEdhbWUuY3B1QXR0YWNrKCk7XG4gICAgICAgICAgY29uc3QgY3B1SGl0cyA9IEdhbWUuZ2V0Q3B1SGl0cygpO1xuICAgICAgICAgIGNvbnN0IGNwdU1pc3NlcyA9IEdhbWUuZ2V0Q3B1TWlzc2VzKCk7XG4gICAgICAgICAgY3B1SGl0cy5mb3JFYWNoKChoaXQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGhpdENlbGwgPSBwbGF5ZXJCb2FyZC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgICAgICBgLmNlbGwuZW1wdHlbY29vcmRpbmF0ZT1cIiR7aGl0fVwiXWBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBoaXRDZWxsLmNsYXNzTGlzdC5yZW1vdmUoXCJwbGFjZWRcIik7XG4gICAgICAgICAgICBoaXRDZWxsLmNsYXNzTGlzdC5hZGQoXCJoaXRcIik7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY3B1TWlzc2VzLmZvckVhY2goKG1pc3MpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGhpdENlbGwgPSBwbGF5ZXJCb2FyZC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgICAgICBgLmNlbGwuZW1wdHlbY29vcmRpbmF0ZT1cIiR7bWlzc31cIl1gXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaGl0Q2VsbC5jbGFzc0xpc3QuYWRkKFwibWlzc1wiKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9O1xuICByZXR1cm4geyBiaW5kRXZlbnRzIH07XG59XG5cbmV4cG9ydCB7IGRpc3BsYXlDb250cm9sbGVyIH07XG4iLCJpbXBvcnQgeyBkaXNwbGF5Q29udHJvbGxlciB9IGZyb20gXCIuL01vZHVsZXMvZGlzcGxheUNvbnRyb2xsZXJcIjtcbmRpc3BsYXlDb250cm9sbGVyKCkuYmluZEV2ZW50cygpO1xuIl0sIm5hbWVzIjpbImJvYXJkIiwiaWQiLCJjZWxsIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwic2V0QXR0cmlidXRlIiwic2hpcHMiLCJuYW1lIiwibGVuZ3RoIiwic2hpcCIsImhpdHMiLCJnZXRMZW5ndGgiLCJnZXROYW1lIiwiZ2V0SGl0cyIsImhpdCIsInB1c2giLCJpc1N1bmsiLCJnYW1lQm9hcmQiLCJnYW1lYm9hcmQiLCJBcnJheSIsImZpbGwiLCJoYXNTaGlwIiwiaXNIaXQiLCJmbGVldCIsImxvY2F0aW9ucyIsImNoZWNrRm9yVmFsaWRQbGFjZW1lbnQiLCJsb2NhdGlvbkFycmF5Iiwic29tZSIsImxvYyIsIm51bSIsImV2ZXJ5IiwiY29tYmluYXRpb24iLCJpbmNsdWRlcyIsImdldEJvYXJkIiwiZ2V0RmxlZXQiLCJnZXRTaGlwTG9jYXRpb25zIiwiZmxhdCIsInNoaXBQbGFjZW1lbnQiLCJvcmllbnRhdGlvbiIsInN0YXJ0aW5nUG9zaXRpb24iLCJTaGlwIiwibG9jYXRpb24iLCJpIiwic2hpcExvY2F0aW9uIiwiaiIsInNwbGljZSIsInJlY2VpdmVBdHRhY2siLCJjb29yZGluYXRlIiwibWlzc2VkU2hvdCIsImNoZWNrU2hpcFN0YXRlIiwiZmlsdGVyIiwiZWwiLCJtYXAiLCJyYW5kb21TaGlwUGxhY2VtZW50IiwiYWxsUG9zc2libGVMb2NhdGlvbnMiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJmaW5kQWxsUG9zc2libGVMb2NhdGlvbnMiLCJnZXRNaXNzZXMiLCJtaXNzZXMiLCJnYW1lIiwiaHVtYW5QbGF5ZXIiLCJwbGF5aW5nIiwicGxheWVySW5mbyIsInNldE5hbWUiLCJ2YWx1ZSIsImF0dGFja0VuZW15IiwiZW5lbXlCb2FyZCIsInNob3QiLCJ3aG9Jc1BsYXlpbmciLCJzd2l0Y2hSb2xlcyIsInBsYXllciIsImNwdVBsYXllciIsInNob3RzRmlyZWQiLCJjb29yZGluYXRlcyIsInRvU3RyaW5nIiwicmFuZG9tSW5kZXgiLCJjb29yZGlhdGUiLCJkYW1hZ2VkQ2VsbHMiLCJjaGVja1JhbmRvbUluZGV4IiwiY29tcHV0ZXJQbGF5ZXIiLCJodW1hbkJvYXJkIiwiY3B1Qm9hcmQiLCJzaGlwVG9QbGFjZSIsImdldFBsYXllckZsZWV0IiwiZ2V0Q1BVRmxlZXQiLCJwbGF5ZXJSb2xlIiwiY3B1Um9sZSIsInN3aXRjaFBsYXllcnNSb2xlcyIsImdldFBsYXllck5hbWUiLCJnZXRQbGF5ZXJTaGlwTG9jYXRpb25zIiwicGxhY2VDUFVTaGlwcyIsImNwdUZsZWV0IiwiZ2V0U2hpcFRvUGxhY2UiLCJwbGFjZVBsYXllclNoaXBzIiwiYXhpcyIsInBsYXllckZsZWV0IiwiY2hlY2tJZkFsbFNoaXBzQXJlUGxhY2VkIiwicGxheWVyQXR0YWNrIiwiY3B1QXR0YWNrIiwicGxheWVyV29uIiwiY3B1V29uIiwiaXNWYWxpZFBsYWNlbWVudCIsImdldFBsYXllck1pc3NlcyIsImdldENwdU1pc3NlcyIsImdldFBsYXllckhpdHMiLCJnZXRDcHVIaXRzIiwibmFtZVNjcmVlbiIsInF1ZXJ5U2VsZWN0b3IiLCJuYW1lSW5wdXQiLCJwbGF5ZXJOYW1lIiwicGxheUJ1dHRvbiIsInBsYXllckJvYXJkIiwicGxheWVyQm9hcmRDb250YWluZXIiLCJjcHVCb2FyZENvbnRhaW5lciIsImNvbnRhaW5lciIsImNoYW5nZUF4aXMiLCJzdGFydEJ1dHRvbiIsIkdhbWUiLCJnZW5lcmF0ZUJsb2NrIiwiY2hhbmdlT3JpZW50YXRpb24iLCJzdGFydEJhdHRsZSIsInJlbW92ZSIsImFwcGVuZENoaWxkIiwicmVuZGVyQ3B1Qm9hcmQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImJpbmRFdmVudHMiLCJhZGRFdmVudExpc3RlbmVyIiwidGV4dENvbnRlbnQiLCJyZW5kZXJQbGF5ZXJCb2FyZCIsInBsYWNlU2hpcHNUZXh0IiwiZSIsInRhcmdldCIsInN0YXJ0aW5nUG9pbnQiLCJOdW1iZXIiLCJnZXRBdHRyaWJ1dGUiLCJzcXVhcmUiLCJjb250YWlucyIsImJsb2NrIiwiY2VsbFRvQXR0YWNrIiwicGxheWVySGl0cyIsInBsYXllck1pc3NlcyIsImhpdENlbGwiLCJtaXNzIiwiY3B1SGl0cyIsImNwdU1pc3NlcyIsImRpc3BsYXlDb250cm9sbGVyIl0sInNvdXJjZVJvb3QiOiIifQ==