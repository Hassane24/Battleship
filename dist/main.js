(()=>{"use strict";function e(e){const t=document.createElement("div");return t.classList.add("empty"),t.classList.add("cell"),t.setAttribute("coordinate",`${e}`),t}function t(e,t){const n={name:e,length:t,hits:[],sunken:!1},o=()=>{if(n.hits.length==n.length)return n.sunken=!0};return{getLength:()=>n.length,getName:()=>n.name,getHits:()=>n.hits,shipState:()=>n.sunken,hit:()=>{n.hits.push("hit"),o()},isSunk:o}}function n(){const e={board:Array(100).fill({hasShip:!1,isHit:!1}),fleet:[t("carrier",5),t("battleship",4),t("cruiser",3),t("submarine",3),t("destroyer",2)],locations:[]},n=t=>!t.some((t=>!e.board[t]))&&!t.some((t=>e.board[t].hasShip))&&![9,19,29,39,49,59,69,79,89].some((e=>[e,e+1].every((e=>t.includes(e)))));return{getBoard:()=>e.board,getFleet:()=>e.fleet,getShipLocations:()=>e.locations.map((e=>e.location)).flat(),shipPlacement:(t,n,o)=>{const a=o.getName(),r=((e,t,n)=>{const o=[];for(let a=0;a<n.getLength();a++)"horizontal"===e?o.push(t+a):o.push(t+10*a);return o})(t,n,o);for(let t=0;t<r.length;t++)e.board.splice(r[t],1,{hasShip:!0,isHit:!1,ship:o});return e.locations.push({shipName:a,location:r}),r},receiveAttack:t=>{0==e.board[t].hasShip?e.board.splice(t,1,{hasShip:!1,isHit:!0,missedShot:!0}):(e.board[t].isHit=!0,e.board[t].ship.hit())},checkShipState:()=>e.board.filter((e=>e.hasShip)).map((e=>e.ship)).every((e=>e.isSunk())),checkForValidPlacement:n,randomShipPlacement:t=>{let o=[],a=(e=>{for(let a=0;a<100-t.getLength();a++){let r=[];if("horiz"===e)for(let e=0;e<t.getLength();e++)r.push(a+e);else for(let e=0;e<t.getLength();e++)r.push(a+10*e);n(r)&&o.push(r)}return o[Math.floor(Math.random()*o.length)]})(["horiz","vert"][Math.floor(2*Math.random())]);for(let n=0;n<a.length;n++)e.board.splice(a[n],1,{hasShip:!0,isHit:!1,ship:t})}}}(function(){const t=document.querySelector(".player-name"),o=document.querySelector("#name"),a=document.querySelector(".player-board > span"),r=document.querySelector(".player-name > button"),l=(document.querySelector(".board-container"),document.querySelector(".player-board > .board")),i=document.querySelector(".player-board "),s=(document.querySelector(".cpu-board > .board"),document.querySelector(".cpu-board "),document.querySelector(".container"));let c=function(e){let t=function(e,t){const o={name:e,board:n(),playing:!0};return{getName:()=>o.name,setName:e=>o.name=e,attackEnemy:(e,t)=>{e.receiveAttack(t)},whoIsPlaying:()=>o.playing,switchRoles:()=>o.playing=!o.playing}}(e),o=function(e){const t={name:"computer",board:n(),playing:!1,shotsFired:[]},o=()=>{let e=Math.floor(100*Math.random());return a(e,t.shotsFired)&&t.shotsFired.push(e),a(e,t.shotsFired)?e:o()},a=(e,t)=>{for(let n=0;n<t.length;n++)return e!=t[n]};return{getName:()=>t.name,attackEnemy:e=>{e.receiveAttack(o())},whoIsPlaying:()=>t.playing,switchRoles:()=>t.playing=!t.playing}}(),a=n(),r=n(),l=0;const i=()=>a.getFleet(),s=()=>r.getFleet(),c=()=>t.whoIsPlaying(),h=()=>o.whoIsPlaying(),u=()=>{c(),t.switchRoles(),o.switchRoles()};return{getPlayerFleet:i,getPlayerShipLocations:()=>a.getShipLocations(),getCPUFleet:s,placeCPUShips:()=>{const e=s();for(let t=0;t<e.length;t++)r.randomShipPlacement(e[t])},getShipToPlace:()=>i()[l],placePlayerShips:(e,t)=>{const n=i();return l+=1,a.shipPlacement(t,e,n[l])},checkIfAllShipsArePlaced:()=>i().length===l,playerAttack:e=>{c()&&(t.attackEnemy(r,e),u())},cpuAttack:()=>{h()&&(o.attackEnemy(a),u())},playerWon:()=>r.checkShipState(),cpuWon:()=>a.checkShipState(),playerRole:c,cpuRole:h,switchPlayersRoles:u,isValidPlacement:e=>{a.checkForValidPlacement(e)}}}(o.value),h=c.getShipToPlace();return{bindEvents:()=>{r.addEventListener("click",(()=>{if(""==o.value)return;i.classList.remove("hide"),a.textContent=o.value,(()=>{for(let t=0;t<100;t++){const n=e(t);l.appendChild(n)}})(),t.remove();const n=document.createElement("div");n.classList.add("place-ships-text"),n.textContent="Place your ships",s.appendChild(n)})),l.addEventListener("mouseover",(e=>{const t=(e=>{const t=[];for(let n=0;n<h.getLength();n++)t.push(e+n);return t})(e.target.getAttribute("coordinate"));console.log(t),t.forEach((e=>{const t=l.querySelector(`.empty.cell[coordinate="${e}"]`);t&&(t.style.backgroundColor="yellow")}))}))}}})().bindEvents()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEtBbUR4Qm9ILEdBQ0F0RCxFQUFXbUQsU0FDWCxNQUFNSSxFQUFpQnBILFNBQVNDLGNBQWMsT0FDOUNtSCxFQUFlbEgsVUFBVUMsSUFBSSxvQkFDN0JpSCxFQUFlSCxZQUFjLG1CQUM3QjdDLEVBQVU4QyxZQUFZRSxNQUd4QmxELEVBQVk2QyxpQkFBaUIsYUFBY00sSUFDekMsTUFFTUMsRUFuRFksQ0FBQ3BFLElBQ3JCLE1BQU1aLEVBQVcsR0FFZixJQUFLLElBQUlPLEVBQUksRUFBR0EsRUFBSTZDLEVBQVk5RSxZQUFhaUMsSUFDM0NQLEVBQVNyQixLQUFLaUMsRUFBYUwsR0FNL0IsT0FBT1AsR0F5Q1NpRixDQUZERixFQUFFRyxPQUNVQyxhQUFhLGVBRXRDQyxRQUFRQyxJQUFJTCxHQUNaQSxFQUFNTSxTQUFTQyxJQUNiLE1BQU05SCxFQUFPbUUsRUFBWUosY0FDdkIsMkJBQTJCK0QsT0FFekI5SCxJQUFNQSxFQUFLK0gsTUFBTUMsZ0JBQWtCLG1CSXhGL0NDLEdBQW9CbEIsYyIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvY29tcG9uZW50cy9ib2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL0ZhY3RvcnlGdW5jdGlvbnMvU2hpcHMuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9GYWN0b3J5RnVuY3Rpb25zL0dhbWVib2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL01vZHVsZXMvZGlzcGxheUNvbnRyb2xsZXIuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9Nb2R1bGVzL2dhbWUuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9GYWN0b3J5RnVuY3Rpb25zL1BsYXllci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL0ZhY3RvcnlGdW5jdGlvbnMvQ29tcHV0ZXJQbGF5ZXIuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBib2FyZChpZCkge1xuICBjb25zdCBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgY2VsbC5jbGFzc0xpc3QuYWRkKFwiZW1wdHlcIik7XG4gIGNlbGwuY2xhc3NMaXN0LmFkZChcImNlbGxcIik7XG4gIGNlbGwuc2V0QXR0cmlidXRlKFwiY29vcmRpbmF0ZVwiLCBgJHtpZH1gKTtcbiAgcmV0dXJuIGNlbGw7XG59XG5leHBvcnQgeyBib2FyZCB9O1xuIiwiZnVuY3Rpb24gc2hpcHMobmFtZSwgbGVuZ3RoKSB7XG4gIGNvbnN0IHNoaXAgPSB7XG4gICAgbmFtZSxcbiAgICBsZW5ndGgsXG4gICAgaGl0czogW10sXG4gICAgc3Vua2VuOiBmYWxzZSxcbiAgfTtcblxuICBjb25zdCBnZXROYW1lID0gKCkgPT4ge1xuICAgIHJldHVybiBzaGlwLm5hbWU7XG4gIH07XG4gIGNvbnN0IGdldExlbmd0aCA9ICgpID0+IHtcbiAgICByZXR1cm4gc2hpcC5sZW5ndGg7XG4gIH07XG4gIGNvbnN0IGdldEhpdHMgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHNoaXAuaGl0cztcbiAgfTtcbiAgY29uc3Qgc2hpcFN0YXRlID0gKCkgPT4ge1xuICAgIHJldHVybiBzaGlwLnN1bmtlbjtcbiAgfTtcblxuICBjb25zdCBoaXQgPSAoKSA9PiB7XG4gICAgc2hpcC5oaXRzLnB1c2goXCJoaXRcIik7XG4gICAgaXNTdW5rKCk7XG4gIH07XG5cbiAgY29uc3QgaXNTdW5rID0gKCkgPT4ge1xuICAgIGlmIChzaGlwLmhpdHMubGVuZ3RoID09IHNoaXAubGVuZ3RoKSByZXR1cm4gKHNoaXAuc3Vua2VuID0gdHJ1ZSk7XG4gIH07XG5cbiAgcmV0dXJuIHsgZ2V0TGVuZ3RoLCBnZXROYW1lLCBnZXRIaXRzLCBzaGlwU3RhdGUsIGhpdCwgaXNTdW5rIH07XG59XG5cbmV4cG9ydCB7IHNoaXBzIH07XG4iLCJpbXBvcnQgeyBzaGlwcyB9IGZyb20gXCIuL1NoaXBzXCI7XG5mdW5jdGlvbiBnYW1lQm9hcmQoKSB7XG4gIGNvbnN0IGdhbWVib2FyZCA9IHtcbiAgICBib2FyZDogQXJyYXkoMTAwKS5maWxsKHsgaGFzU2hpcDogZmFsc2UsIGlzSGl0OiBmYWxzZSB9KSxcbiAgICBmbGVldDogW1xuICAgICAgc2hpcHMoXCJjYXJyaWVyXCIsIDUpLFxuICAgICAgc2hpcHMoXCJiYXR0bGVzaGlwXCIsIDQpLFxuICAgICAgc2hpcHMoXCJjcnVpc2VyXCIsIDMpLFxuICAgICAgc2hpcHMoXCJzdWJtYXJpbmVcIiwgMyksXG4gICAgICBzaGlwcyhcImRlc3Ryb3llclwiLCAyKSxcbiAgICBdLFxuICAgIGxvY2F0aW9uczogW10sXG4gIH07XG5cbiAgY29uc3QgZ2V0Qm9hcmQgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGdhbWVib2FyZC5ib2FyZDtcbiAgfTtcblxuICBjb25zdCBnZXRTaGlwTG9jYXRpb25zID0gKCkgPT4ge1xuICAgIHJldHVybiBnYW1lYm9hcmQubG9jYXRpb25zLm1hcCgoc2hpcCkgPT4gc2hpcC5sb2NhdGlvbikuZmxhdCgpO1xuICB9O1xuXG4gIGNvbnN0IGdldEZsZWV0ID0gKCkgPT4ge1xuICAgIHJldHVybiBnYW1lYm9hcmQuZmxlZXQ7XG4gIH07XG5cbiAgY29uc3Qgc2hpcExvY2F0aW9uID0gKG9yaWVudGF0aW9uLCBzdGFydGluZ1Bvc2l0aW9uLCBzaGlwKSA9PiB7XG4gICAgLy8gcmV0dXJucyBhbiBhcnJheSBvZiBudW1iZXJzIHRoYXQgcmVwcmVzZW50IGluZGV4ZXMgb24gdGhlIGJvYXJkXG4gICAgY29uc3QgbG9jYXRpb24gPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXAuZ2V0TGVuZ3RoKCk7IGkrKykge1xuICAgICAgb3JpZW50YXRpb24gPT09IFwiaG9yaXpvbnRhbFwiXG4gICAgICAgID8gbG9jYXRpb24ucHVzaChzdGFydGluZ1Bvc2l0aW9uICsgaSlcbiAgICAgICAgOiBsb2NhdGlvbi5wdXNoKHN0YXJ0aW5nUG9zaXRpb24gKyBpICogMTApO1xuICAgIH1cbiAgICByZXR1cm4gbG9jYXRpb247XG4gIH07XG5cbiAgY29uc3Qgc2hpcFBsYWNlbWVudCA9IChvcmllbnRhdGlvbiwgc3RhcnRpbmdQb3NpdGlvbiwgU2hpcCkgPT4ge1xuICAgIGNvbnN0IHNoaXBOYW1lID0gU2hpcC5nZXROYW1lKCk7XG4gICAgY29uc3QgbG9jYXRpb24gPSBzaGlwTG9jYXRpb24ob3JpZW50YXRpb24sIHN0YXJ0aW5nUG9zaXRpb24sIFNoaXApO1xuICAgIGZvciAobGV0IGogPSAwOyBqIDwgbG9jYXRpb24ubGVuZ3RoOyBqKyspIHtcbiAgICAgIGdhbWVib2FyZC5ib2FyZC5zcGxpY2UobG9jYXRpb25bal0sIDEsIHtcbiAgICAgICAgaGFzU2hpcDogdHJ1ZSxcbiAgICAgICAgaXNIaXQ6IGZhbHNlLFxuICAgICAgICBzaGlwOiBTaGlwLFxuICAgICAgfSk7XG4gICAgfVxuICAgIGdhbWVib2FyZC5sb2NhdGlvbnMucHVzaCh7IHNoaXBOYW1lLCBsb2NhdGlvbiB9KTtcbiAgICByZXR1cm4gbG9jYXRpb247XG4gIH07XG5cbiAgY29uc3QgY2hlY2tGb3JWYWxpZFBsYWNlbWVudCA9IChsb2NhdGlvbkFycmF5KSA9PiB7XG4gICAgY29uc3QgY29sbGlzaW9ucyA9IFs5LCAxOSwgMjksIDM5LCA0OSwgNTksIDY5LCA3OSwgODldO1xuICAgIGlmIChsb2NhdGlvbkFycmF5LnNvbWUoKGxvYykgPT4gIWdhbWVib2FyZC5ib2FyZFtsb2NdKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gZWxzZSBpZiAobG9jYXRpb25BcnJheS5zb21lKChsb2MpID0+IGdhbWVib2FyZC5ib2FyZFtsb2NdLmhhc1NoaXApKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIGNvbGxpc2lvbnMuc29tZSgobnVtKSA9PiB7XG4gICAgICAgIHJldHVybiBbbnVtLCBudW0gKyAxXS5ldmVyeSgoY29tYmluYXRpb24pID0+XG4gICAgICAgICAgbG9jYXRpb25BcnJheS5pbmNsdWRlcyhjb21iaW5hdGlvbilcbiAgICAgICAgKTtcbiAgICAgIH0pXG4gICAgKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCByYW5kb21TaGlwUGxhY2VtZW50ID0gKHNoaXApID0+IHtcbiAgICBsZXQgYWxsUG9zc2libGVMb2NhdGlvbnMgPSBbXTtcblxuICAgIC8vIHJldHVybnMgYSByYW5kb20gb3JpZW50YXRpb25cblxuICAgIGNvbnN0IHJhbmRvbU9yaWVudGF0aW9uID0gKCkgPT5cbiAgICAgIFtcImhvcml6XCIsIFwidmVydFwiXVtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKV07XG5cbiAgICAvLyBmaW5kcyBhbGwgcG9zc2libGUgbG9jYXRpb25zIGEgc2hpcCBjYW4gYmUgcGxhY2VkIGF0XG5cbiAgICBjb25zdCBmaW5kQWxsUG9zc2libGVMb2NhdGlvbnMgPSAob3JpZW50YXRpb24pID0+IHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTAwIC0gc2hpcC5nZXRMZW5ndGgoKTsgaSsrKSB7XG4gICAgICAgIGxldCBsb2NhdGlvbkFycmF5ID0gW107XG5cbiAgICAgICAgaWYgKG9yaWVudGF0aW9uID09PSBcImhvcml6XCIpXG4gICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGlwLmdldExlbmd0aCgpOyBqKyspIHtcbiAgICAgICAgICAgIGxvY2F0aW9uQXJyYXkucHVzaChpICsgaik7XG4gICAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGlwLmdldExlbmd0aCgpOyBqKyspIHtcbiAgICAgICAgICAgIGxvY2F0aW9uQXJyYXkucHVzaChpICsgaiAqIDEwKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgLy8gY2hlY2tzIHdoZXRoZXIgdGhlIGNyZWF0ZWQgbG9jYXRpb24gaXMgdmFsaWQgb3Igbm90XG5cbiAgICAgICAgaWYgKGNoZWNrRm9yVmFsaWRQbGFjZW1lbnQobG9jYXRpb25BcnJheSkpXG4gICAgICAgICAgYWxsUG9zc2libGVMb2NhdGlvbnMucHVzaChsb2NhdGlvbkFycmF5KTtcbiAgICAgIH1cblxuICAgICAgLy8gcmV0dXJucyBvbmUgcmFuZG9tIHNoaXAgbG9jYXRpb24gb3V0IG9mIG1hbnlcblxuICAgICAgcmV0dXJuIGFsbFBvc3NpYmxlTG9jYXRpb25zW1xuICAgICAgICBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBhbGxQb3NzaWJsZUxvY2F0aW9ucy5sZW5ndGgpXG4gICAgICBdO1xuICAgIH07XG5cbiAgICBsZXQgbG9jYXRpb24gPSBmaW5kQWxsUG9zc2libGVMb2NhdGlvbnMocmFuZG9tT3JpZW50YXRpb24oKSk7XG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCBsb2NhdGlvbi5sZW5ndGg7IGorKykge1xuICAgICAgZ2FtZWJvYXJkLmJvYXJkLnNwbGljZShsb2NhdGlvbltqXSwgMSwge1xuICAgICAgICBoYXNTaGlwOiB0cnVlLFxuICAgICAgICBpc0hpdDogZmFsc2UsXG4gICAgICAgIHNoaXA6IHNoaXAsXG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgcmVjZWl2ZUF0dGFjayA9IChjb29yZGluYXRlKSA9PiB7XG4gICAgaWYgKGdhbWVib2FyZC5ib2FyZFtjb29yZGluYXRlXS5oYXNTaGlwID09IGZhbHNlKVxuICAgICAgZ2FtZWJvYXJkLmJvYXJkLnNwbGljZShjb29yZGluYXRlLCAxLCB7XG4gICAgICAgIGhhc1NoaXA6IGZhbHNlLFxuICAgICAgICBpc0hpdDogdHJ1ZSxcbiAgICAgICAgbWlzc2VkU2hvdDogdHJ1ZSxcbiAgICAgIH0pO1xuICAgIGVsc2Uge1xuICAgICAgZ2FtZWJvYXJkLmJvYXJkW2Nvb3JkaW5hdGVdLmlzSGl0ID0gdHJ1ZTtcbiAgICAgIGdhbWVib2FyZC5ib2FyZFtjb29yZGluYXRlXS5zaGlwLmhpdCgpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBjaGVja1NoaXBTdGF0ZSA9ICgpID0+IHtcbiAgICByZXR1cm4gZ2FtZWJvYXJkLmJvYXJkXG4gICAgICAuZmlsdGVyKChlbCkgPT4gZWwuaGFzU2hpcClcbiAgICAgIC5tYXAoKGVsKSA9PiBlbC5zaGlwKVxuICAgICAgLmV2ZXJ5KChlbCkgPT4gZWwuaXNTdW5rKCkpO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgZ2V0Qm9hcmQsXG4gICAgZ2V0RmxlZXQsXG4gICAgZ2V0U2hpcExvY2F0aW9ucyxcbiAgICBzaGlwUGxhY2VtZW50LFxuICAgIHJlY2VpdmVBdHRhY2ssXG4gICAgY2hlY2tTaGlwU3RhdGUsXG4gICAgY2hlY2tGb3JWYWxpZFBsYWNlbWVudCxcbiAgICByYW5kb21TaGlwUGxhY2VtZW50LFxuICB9O1xufVxuXG5leHBvcnQgeyBnYW1lQm9hcmQgfTtcbiIsImltcG9ydCB7IGJvYXJkIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvYm9hcmRcIjtcbmltcG9ydCB7IGdhbWUgfSBmcm9tIFwiLi9nYW1lXCI7XG5cbmZ1bmN0aW9uIGRpc3BsYXlDb250cm9sbGVyKCkge1xuICBjb25zdCBuYW1lU2NyZWVuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItbmFtZVwiKTtcbiAgY29uc3QgbmFtZUlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNuYW1lXCIpO1xuICBjb25zdCBwbGF5ZXJOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItYm9hcmQgPiBzcGFuXCIpO1xuICBjb25zdCBwbGF5QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItbmFtZSA+IGJ1dHRvblwiKTtcbiAgY29uc3QgYm9hcmRDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmJvYXJkLWNvbnRhaW5lclwiKTtcbiAgY29uc3QgcGxheWVyQm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci1ib2FyZCA+IC5ib2FyZFwiKTtcbiAgY29uc3QgcGxheWVyQm9hcmRDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci1ib2FyZCBcIik7XG4gIGNvbnN0IGNwdUJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jcHUtYm9hcmQgPiAuYm9hcmRcIik7XG4gIGNvbnN0IGNwdUJvYXJkQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jcHUtYm9hcmQgXCIpO1xuICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNvbnRhaW5lclwiKTtcbiAgbGV0IEdhbWUgPSBnYW1lKG5hbWVJbnB1dC52YWx1ZSk7XG4gIGxldCBheGlzID0gXCJob3Jpem9udGFsXCI7XG4gIGxldCBzaGlwVG9QbGFjZSA9IEdhbWUuZ2V0U2hpcFRvUGxhY2UoKTtcblxuICBjb25zdCByZW5kZXJQbGF5ZXJCb2FyZCA9ICgpID0+IHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDsgaSsrKSB7XG4gICAgICBjb25zdCBjZWxsID0gYm9hcmQoaSk7XG4gICAgICBwbGF5ZXJCb2FyZC5hcHBlbmRDaGlsZChjZWxsKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgcmVuZGVyQ3B1Qm9hcmQgPSAoKSA9PiB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDA7IGkrKykge1xuICAgICAgY29uc3QgY2VsbCA9IGJvYXJkKGkpO1xuICAgICAgY3B1Qm9hcmQuYXBwZW5kQ2hpbGQoY2VsbCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGdlbmVyYXRlQmxvY2sgPSAoY29vcmRpbmF0ZSkgPT4ge1xuICAgIGNvbnN0IGxvY2F0aW9uID0gW107XG4gICAgaWYgKGF4aXMgPT09IFwiaG9yaXpvbnRhbFwiKVxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwVG9QbGFjZS5nZXRMZW5ndGgoKTsgaSsrKSB7XG4gICAgICAgIGxvY2F0aW9uLnB1c2goY29vcmRpbmF0ZSArIGkpO1xuICAgICAgfVxuICAgIGVsc2VcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbG9jYXRpb24ucHVzaChjb29yZGluYXRlICsgaSAqIDEwKTtcbiAgICAgIH1cbiAgICByZXR1cm4gbG9jYXRpb247XG4gIH07XG5cbiAgY29uc3QgcGxhY2VQbGF5ZXJTaGlwcyA9IChlKSA9PiB7XG4gICAgaWYgKEdhbWUuY2hlY2tJZkFsbFNoaXBzQXJlUGxhY2VkKCkpIHJldHVybjtcbiAgICBjb25zdCBjZWxsID0gZS50YXJnZXQ7XG4gICAgaWYgKGNlbGwuY2xhc3NMaXN0LmNvbnRhaW5zKFwiZW1wdHlcIikgJiYgY2VsbC5jbGFzc0xpc3QuY29udGFpbnMoXCJjZWxsXCIpKSB7XG4gICAgICBjb25zdCBzdGFydGluZ1BvcyA9IGNlbGwuZ2V0QXR0cmlidXRlKFwiaWRcIik7XG4gICAgICBpZiAoIUdhbWUuaXNWYWxpZFBsYWNlbWVudChHYW1lLnBsYWNlUGxheWVyU2hpcHMoc3RhcnRpbmdQb3MsIGF4aXMpKSlcbiAgICAgICAgcmV0dXJuO1xuICAgICAgR2FtZS5wbGFjZVBsYXllclNoaXBzKHN0YXJ0aW5nUG9zLCBheGlzKTtcbiAgICAgIHJlbmRlclNoaXBzKCk7XG4gICAgICBzaGlwVG9QbGFjZSA9IEdhbWUuZ2V0U2hpcFRvUGxhY2U7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHJlbmRlclNoaXBzID0gKCkgPT4ge1xuICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gR2FtZS5nZXRQbGF5ZXJTaGlwTG9jYXRpb25zKCk7XG4gICAgY29vcmRpbmF0ZXMuZm9yRWFjaCgoY29vcmRpbmF0ZSkgPT4ge1xuICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5jZWxsLmVtcHR5IyR7Y29vcmRpbmF0ZX1gKTtcbiAgICAgIGNlbGwuY2xhc3NMaXN0LnJlbW92ZShcImVtcHR5XCIpO1xuICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKFwiaGl0XCIpO1xuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IGJpbmRFdmVudHMgPSAoKSA9PiB7XG4gICAgcGxheUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgaWYgKG5hbWVJbnB1dC52YWx1ZSA9PSBcIlwiKSByZXR1cm47XG4gICAgICBwbGF5ZXJCb2FyZENvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZVwiKTtcbiAgICAgIHBsYXllck5hbWUudGV4dENvbnRlbnQgPSBuYW1lSW5wdXQudmFsdWU7XG4gICAgICByZW5kZXJQbGF5ZXJCb2FyZCgpO1xuICAgICAgbmFtZVNjcmVlbi5yZW1vdmUoKTtcbiAgICAgIGNvbnN0IHBsYWNlU2hpcHNUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHBsYWNlU2hpcHNUZXh0LmNsYXNzTGlzdC5hZGQoXCJwbGFjZS1zaGlwcy10ZXh0XCIpO1xuICAgICAgcGxhY2VTaGlwc1RleHQudGV4dENvbnRlbnQgPSBcIlBsYWNlIHlvdXIgc2hpcHNcIjtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChwbGFjZVNoaXBzVGV4dCk7XG4gICAgfSk7XG5cbiAgICBwbGF5ZXJCb2FyZC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsIChlKSA9PiB7XG4gICAgICBjb25zdCBjZWxsID0gZS50YXJnZXQ7XG4gICAgICBjb25zdCBzdGFydGluZ1BvcyA9IGNlbGwuZ2V0QXR0cmlidXRlKFwiY29vcmRpbmF0ZVwiKTtcbiAgICAgIGNvbnN0IGJsb2NrID0gZ2VuZXJhdGVCbG9jayhzdGFydGluZ1Bvcyk7XG4gICAgICBjb25zb2xlLmxvZyhibG9jayk7XG4gICAgICBibG9jay5mb3JFYWNoKChzcXVhcmUpID0+IHtcbiAgICAgICAgY29uc3QgY2VsbCA9IHBsYXllckJvYXJkLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgYC5lbXB0eS5jZWxsW2Nvb3JkaW5hdGU9XCIke3NxdWFyZX1cIl1gXG4gICAgICAgICk7XG4gICAgICAgIGlmIChjZWxsKSBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwieWVsbG93XCI7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcbiAgcmV0dXJuIHsgYmluZEV2ZW50cyB9O1xufVxuXG5leHBvcnQgeyBkaXNwbGF5Q29udHJvbGxlciB9O1xuIiwiaW1wb3J0IHsgZ2FtZUJvYXJkIH0gZnJvbSBcIi4uL0ZhY3RvcnlGdW5jdGlvbnMvR2FtZWJvYXJkXCI7XG5pbXBvcnQgeyBwbGF5ZXIgfSBmcm9tIFwiLi4vRmFjdG9yeUZ1bmN0aW9ucy9QbGF5ZXJcIjtcbmltcG9ydCB7IGNvbXB1dGVyUGxheWVyIH0gZnJvbSBcIi4uL0ZhY3RvcnlGdW5jdGlvbnMvQ29tcHV0ZXJQbGF5ZXJcIjtcblxuZnVuY3Rpb24gZ2FtZShuYW1lKSB7XG4gIGxldCBodW1hblBsYXllciA9IHBsYXllcihuYW1lLCB0cnVlKTtcbiAgbGV0IGNwdVBsYXllciA9IGNvbXB1dGVyUGxheWVyKGZhbHNlKTtcbiAgbGV0IGh1bWFuQm9hcmQgPSBnYW1lQm9hcmQoKTtcbiAgbGV0IGNwdUJvYXJkID0gZ2FtZUJvYXJkKCk7XG4gIGxldCBzaGlwVG9QbGFjZSA9IDA7XG5cbiAgY29uc3QgZ2V0UGxheWVyRmxlZXQgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGh1bWFuQm9hcmQuZ2V0RmxlZXQoKTtcbiAgfTtcblxuICBjb25zdCBnZXRQbGF5ZXJTaGlwTG9jYXRpb25zID0gKCkgPT4ge1xuICAgIHJldHVybiBodW1hbkJvYXJkLmdldFNoaXBMb2NhdGlvbnMoKTtcbiAgfTtcblxuICBjb25zdCBnZXRDUFVGbGVldCA9ICgpID0+IHtcbiAgICByZXR1cm4gY3B1Qm9hcmQuZ2V0RmxlZXQoKTtcbiAgfTtcblxuICBjb25zdCBnZXRTaGlwVG9QbGFjZSA9ICgpID0+IHtcbiAgICBjb25zdCBmbGVldCA9IGdldFBsYXllckZsZWV0KCk7XG4gICAgY29uc3Qgc2hpcCA9IGZsZWV0W3NoaXBUb1BsYWNlXTtcbiAgICByZXR1cm4gc2hpcDtcbiAgfTtcblxuICBjb25zdCBwbGFjZUNQVVNoaXBzID0gKCkgPT4ge1xuICAgIGNvbnN0IGNwdUZsZWV0ID0gZ2V0Q1BVRmxlZXQoKTtcbiAgICBmb3IgKGxldCBzaGlwID0gMDsgc2hpcCA8IGNwdUZsZWV0Lmxlbmd0aDsgc2hpcCsrKVxuICAgICAgY3B1Qm9hcmQucmFuZG9tU2hpcFBsYWNlbWVudChjcHVGbGVldFtzaGlwXSk7XG4gIH07XG5cbiAgY29uc3QgcGxhY2VQbGF5ZXJTaGlwcyA9IChsb2NhdGlvbiwgYXhpcykgPT4ge1xuICAgIGNvbnN0IHBsYXllckZsZWV0ID0gZ2V0UGxheWVyRmxlZXQoKTtcbiAgICBzaGlwVG9QbGFjZSArPSAxO1xuICAgIHJldHVybiBodW1hbkJvYXJkLnNoaXBQbGFjZW1lbnQoYXhpcywgbG9jYXRpb24sIHBsYXllckZsZWV0W3NoaXBUb1BsYWNlXSk7XG4gIH07XG5cbiAgY29uc3QgY2hlY2tJZkFsbFNoaXBzQXJlUGxhY2VkID0gKCkgPT4ge1xuICAgIHJldHVybiBnZXRQbGF5ZXJGbGVldCgpLmxlbmd0aCA9PT0gc2hpcFRvUGxhY2U7XG4gIH07XG5cbiAgY29uc3QgcGxheWVyQXR0YWNrID0gKGNvb3JkaW5hdGUpID0+IHtcbiAgICBpZiAocGxheWVyUm9sZSgpKSB7XG4gICAgICBodW1hblBsYXllci5hdHRhY2tFbmVteShjcHVCb2FyZCwgY29vcmRpbmF0ZSk7XG4gICAgICBzd2l0Y2hQbGF5ZXJzUm9sZXMoKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgY3B1QXR0YWNrID0gKCkgPT4ge1xuICAgIGlmIChjcHVSb2xlKCkpIHtcbiAgICAgIGNwdVBsYXllci5hdHRhY2tFbmVteShodW1hbkJvYXJkKTtcbiAgICAgIHN3aXRjaFBsYXllcnNSb2xlcygpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBwbGF5ZXJXb24gPSAoKSA9PiB7XG4gICAgcmV0dXJuIGNwdUJvYXJkLmNoZWNrU2hpcFN0YXRlKCk7XG4gIH07XG5cbiAgY29uc3QgY3B1V29uID0gKCkgPT4ge1xuICAgIHJldHVybiBodW1hbkJvYXJkLmNoZWNrU2hpcFN0YXRlKCk7XG4gIH07XG5cbiAgY29uc3QgcGxheWVyUm9sZSA9ICgpID0+IHtcbiAgICByZXR1cm4gaHVtYW5QbGF5ZXIud2hvSXNQbGF5aW5nKCk7XG4gIH07XG5cbiAgY29uc3QgY3B1Um9sZSA9ICgpID0+IHtcbiAgICByZXR1cm4gY3B1UGxheWVyLndob0lzUGxheWluZygpO1xuICB9O1xuXG4gIGNvbnN0IHN3aXRjaFBsYXllcnNSb2xlcyA9ICgpID0+IHtcbiAgICBpZiAocGxheWVyUm9sZSgpKSB7XG4gICAgICBodW1hblBsYXllci5zd2l0Y2hSb2xlcygpO1xuICAgICAgY3B1UGxheWVyLnN3aXRjaFJvbGVzKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGh1bWFuUGxheWVyLnN3aXRjaFJvbGVzKCk7XG4gICAgICBjcHVQbGF5ZXIuc3dpdGNoUm9sZXMoKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgaXNWYWxpZFBsYWNlbWVudCA9IChsb2NhdGlvbikgPT4ge1xuICAgIGh1bWFuQm9hcmQuY2hlY2tGb3JWYWxpZFBsYWNlbWVudChsb2NhdGlvbik7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBnZXRQbGF5ZXJGbGVldCxcbiAgICBnZXRQbGF5ZXJTaGlwTG9jYXRpb25zLFxuICAgIGdldENQVUZsZWV0LFxuICAgIHBsYWNlQ1BVU2hpcHMsXG4gICAgZ2V0U2hpcFRvUGxhY2UsXG4gICAgcGxhY2VQbGF5ZXJTaGlwcyxcbiAgICBjaGVja0lmQWxsU2hpcHNBcmVQbGFjZWQsXG4gICAgcGxheWVyQXR0YWNrLFxuICAgIGNwdUF0dGFjayxcbiAgICBwbGF5ZXJXb24sXG4gICAgY3B1V29uLFxuICAgIHBsYXllclJvbGUsXG4gICAgY3B1Um9sZSxcbiAgICBzd2l0Y2hQbGF5ZXJzUm9sZXMsXG4gICAgaXNWYWxpZFBsYWNlbWVudCxcbiAgfTtcbn1cblxuZXhwb3J0IHsgZ2FtZSB9O1xuIiwiaW1wb3J0IHsgZ2FtZUJvYXJkIH0gZnJvbSBcIi4vR2FtZWJvYXJkXCI7XG5mdW5jdGlvbiBwbGF5ZXIobmFtZSwgcGxheWluZykge1xuICBjb25zdCBwbGF5ZXJJbmZvID0ge1xuICAgIG5hbWUsXG4gICAgYm9hcmQ6IGdhbWVCb2FyZCgpLFxuICAgIHBsYXlpbmcsXG4gIH07XG5cbiAgY29uc3Qgd2hvSXNQbGF5aW5nID0gKCkgPT4ge1xuICAgIHJldHVybiBwbGF5ZXJJbmZvLnBsYXlpbmc7XG4gIH07XG5cbiAgY29uc3Qgc3dpdGNoUm9sZXMgPSAoKSA9PiB7XG4gICAgcmV0dXJuIChwbGF5ZXJJbmZvLnBsYXlpbmcgPSAhcGxheWVySW5mby5wbGF5aW5nKTtcbiAgfTtcblxuICBjb25zdCBnZXROYW1lID0gKCkgPT4ge1xuICAgIHJldHVybiBwbGF5ZXJJbmZvLm5hbWU7XG4gIH07XG5cbiAgY29uc3Qgc2V0TmFtZSA9ICh2YWx1ZSkgPT4ge1xuICAgIHJldHVybiAocGxheWVySW5mby5uYW1lID0gdmFsdWUpO1xuICB9O1xuXG4gIGNvbnN0IGF0dGFja0VuZW15ID0gKGVuZW15Qm9hcmQsIHNob3QpID0+IHtcbiAgICBlbmVteUJvYXJkLnJlY2VpdmVBdHRhY2soc2hvdCk7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBnZXROYW1lLFxuICAgIHNldE5hbWUsXG4gICAgYXR0YWNrRW5lbXksXG4gICAgd2hvSXNQbGF5aW5nLFxuICAgIHN3aXRjaFJvbGVzLFxuICB9O1xufVxuXG5leHBvcnQgeyBwbGF5ZXIgfTtcbiIsImltcG9ydCB7IGdhbWVCb2FyZCB9IGZyb20gXCIuL0dhbWVib2FyZFwiO1xuZnVuY3Rpb24gY29tcHV0ZXJQbGF5ZXIocGxheWluZykge1xuICBjb25zdCBwbGF5ZXJJbmZvID0ge1xuICAgIG5hbWU6IFwiY29tcHV0ZXJcIixcbiAgICBib2FyZDogZ2FtZUJvYXJkKCksXG4gICAgcGxheWluZyxcbiAgICBzaG90c0ZpcmVkOiBbXSxcbiAgfTtcblxuICBjb25zdCB3aG9Jc1BsYXlpbmcgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHBsYXllckluZm8ucGxheWluZztcbiAgfTtcblxuICBjb25zdCBzd2l0Y2hSb2xlcyA9ICgpID0+IHtcbiAgICByZXR1cm4gKHBsYXllckluZm8ucGxheWluZyA9ICFwbGF5ZXJJbmZvLnBsYXlpbmcpO1xuICB9O1xuXG4gIGNvbnN0IGdldE5hbWUgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHBsYXllckluZm8ubmFtZTtcbiAgfTtcblxuICBjb25zdCByYW5kb21JbmRleCA9ICgpID0+IHtcbiAgICBsZXQgaW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDApO1xuICAgIGlmIChjaGVja1JhbmRvbUluZGV4KGluZGV4LCBwbGF5ZXJJbmZvLnNob3RzRmlyZWQpKVxuICAgICAgcGxheWVySW5mby5zaG90c0ZpcmVkLnB1c2goaW5kZXgpO1xuICAgIGlmICghY2hlY2tSYW5kb21JbmRleChpbmRleCwgcGxheWVySW5mby5zaG90c0ZpcmVkKSkgcmV0dXJuIHJhbmRvbUluZGV4KCk7XG4gICAgcmV0dXJuIGluZGV4O1xuICB9O1xuXG4gIGNvbnN0IGNoZWNrUmFuZG9tSW5kZXggPSAodmFsdWUsIGFycmF5KSA9PiB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKHZhbHVlID09IGFycmF5W2ldKSByZXR1cm4gZmFsc2U7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgYXR0YWNrRW5lbXkgPSAoZW5lbXlCb2FyZCkgPT4ge1xuICAgIGVuZW15Qm9hcmQucmVjZWl2ZUF0dGFjayhyYW5kb21JbmRleCgpKTtcbiAgfTtcblxuICByZXR1cm4geyBnZXROYW1lLCBhdHRhY2tFbmVteSwgd2hvSXNQbGF5aW5nLCBzd2l0Y2hSb2xlcyB9O1xufVxuZXhwb3J0IHsgY29tcHV0ZXJQbGF5ZXIgfTtcbiIsImltcG9ydCB7IGRpc3BsYXlDb250cm9sbGVyIH0gZnJvbSBcIi4vTW9kdWxlcy9kaXNwbGF5Q29udHJvbGxlclwiO1xuZGlzcGxheUNvbnRyb2xsZXIoKS5iaW5kRXZlbnRzKCk7XG4iXSwibmFtZXMiOlsiYm9hcmQiLCJpZCIsImNlbGwiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJzZXRBdHRyaWJ1dGUiLCJzaGlwcyIsIm5hbWUiLCJsZW5ndGgiLCJzaGlwIiwiaGl0cyIsInN1bmtlbiIsImlzU3VuayIsImdldExlbmd0aCIsImdldE5hbWUiLCJnZXRIaXRzIiwic2hpcFN0YXRlIiwiaGl0IiwicHVzaCIsImdhbWVCb2FyZCIsImdhbWVib2FyZCIsIkFycmF5IiwiZmlsbCIsImhhc1NoaXAiLCJpc0hpdCIsImZsZWV0IiwibG9jYXRpb25zIiwiY2hlY2tGb3JWYWxpZFBsYWNlbWVudCIsImxvY2F0aW9uQXJyYXkiLCJzb21lIiwibG9jIiwibnVtIiwiZXZlcnkiLCJjb21iaW5hdGlvbiIsImluY2x1ZGVzIiwiZ2V0Qm9hcmQiLCJnZXRGbGVldCIsImdldFNoaXBMb2NhdGlvbnMiLCJtYXAiLCJsb2NhdGlvbiIsImZsYXQiLCJzaGlwUGxhY2VtZW50Iiwib3JpZW50YXRpb24iLCJzdGFydGluZ1Bvc2l0aW9uIiwiU2hpcCIsInNoaXBOYW1lIiwiaSIsInNoaXBMb2NhdGlvbiIsImoiLCJzcGxpY2UiLCJyZWNlaXZlQXR0YWNrIiwiY29vcmRpbmF0ZSIsIm1pc3NlZFNob3QiLCJjaGVja1NoaXBTdGF0ZSIsImZpbHRlciIsImVsIiwicmFuZG9tU2hpcFBsYWNlbWVudCIsImFsbFBvc3NpYmxlTG9jYXRpb25zIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiZmluZEFsbFBvc3NpYmxlTG9jYXRpb25zIiwibmFtZVNjcmVlbiIsInF1ZXJ5U2VsZWN0b3IiLCJuYW1lSW5wdXQiLCJwbGF5ZXJOYW1lIiwicGxheUJ1dHRvbiIsInBsYXllckJvYXJkIiwicGxheWVyQm9hcmRDb250YWluZXIiLCJjb250YWluZXIiLCJHYW1lIiwiaHVtYW5QbGF5ZXIiLCJwbGF5aW5nIiwicGxheWVySW5mbyIsInNldE5hbWUiLCJ2YWx1ZSIsImF0dGFja0VuZW15IiwiZW5lbXlCb2FyZCIsInNob3QiLCJ3aG9Jc1BsYXlpbmciLCJzd2l0Y2hSb2xlcyIsInBsYXllciIsImNwdVBsYXllciIsInNob3RzRmlyZWQiLCJyYW5kb21JbmRleCIsImluZGV4IiwiY2hlY2tSYW5kb21JbmRleCIsImFycmF5IiwiY29tcHV0ZXJQbGF5ZXIiLCJodW1hbkJvYXJkIiwiY3B1Qm9hcmQiLCJzaGlwVG9QbGFjZSIsImdldFBsYXllckZsZWV0IiwiZ2V0Q1BVRmxlZXQiLCJwbGF5ZXJSb2xlIiwiY3B1Um9sZSIsInN3aXRjaFBsYXllcnNSb2xlcyIsImdldFBsYXllclNoaXBMb2NhdGlvbnMiLCJwbGFjZUNQVVNoaXBzIiwiY3B1RmxlZXQiLCJnZXRTaGlwVG9QbGFjZSIsInBsYWNlUGxheWVyU2hpcHMiLCJheGlzIiwicGxheWVyRmxlZXQiLCJjaGVja0lmQWxsU2hpcHNBcmVQbGFjZWQiLCJwbGF5ZXJBdHRhY2siLCJjcHVBdHRhY2siLCJwbGF5ZXJXb24iLCJjcHVXb24iLCJpc1ZhbGlkUGxhY2VtZW50IiwiZ2FtZSIsImJpbmRFdmVudHMiLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlIiwidGV4dENvbnRlbnQiLCJhcHBlbmRDaGlsZCIsInJlbmRlclBsYXllckJvYXJkIiwicGxhY2VTaGlwc1RleHQiLCJlIiwiYmxvY2siLCJnZW5lcmF0ZUJsb2NrIiwidGFyZ2V0IiwiZ2V0QXR0cmlidXRlIiwiY29uc29sZSIsImxvZyIsImZvckVhY2giLCJzcXVhcmUiLCJzdHlsZSIsImJhY2tncm91bmRDb2xvciIsImRpc3BsYXlDb250cm9sbGVyIl0sInNvdXJjZVJvb3QiOiIifQ==