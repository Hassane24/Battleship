(()=>{"use strict";function e(e){const t=document.createElement("div");return t.classList.add("empty"),t.classList.add("cell"),t.setAttribute("coordinate",`${e}`),t}function t(e,t){const s={name:e,length:t,hits:[]};return{getLength:()=>s.length,getName:()=>s.name,getHits:()=>s.hits,hit:()=>{s.hits.push("hit")},isSunk:()=>s.hits.length===s.length}}function s(){const e={board:Array(100).fill({hasShip:!1,isHit:!1}),fleet:[t("carrier",5),t("battleship",4),t("cruiser",3),t("submarine",3),t("destroyer",2)],locations:[]},s=t=>!t.some((t=>!e.board[t]))&&!t.some((t=>e.board[t].hasShip))&&![9,19,29,39,49,59,69,79,89].some((e=>[e,e+1].every((e=>t.includes(e)))));return{getBoard:()=>e.board,getFleet:()=>e.fleet,getShipLocations:()=>e.locations.flat(),shipPlacement:(t,s,r)=>{const o=((e,t,s)=>{const r=[];for(let o=0;o<s.getLength();o++)"horizontal"===e?r.push(t+o):r.push(t+10*o);return r})(t,s,r);for(let t=0;t<o.length;t++)e.board.splice(o[t],1,{hasShip:!0,isHit:!1,ship:r});return e.locations.push(o),o},receiveAttack:t=>{0==e.board[t].hasShip?e.board.splice(t,1,{hasShip:!1,isHit:!0,missedShot:!0}):(e.board[t].isHit=!0,e.board[t].ship.hit())},checkShipState:()=>e.board.filter((e=>e.hasShip)).map((e=>e.ship)).every((e=>e.isSunk())),checkForValidPlacement:s,randomShipPlacement:t=>{let r=[],o=(e=>{for(let o=0;o<100-t.getLength();o++){let a=[];if("horiz"===e)for(let e=0;e<t.getLength();e++)a.push(o+e);else for(let e=0;e<t.getLength();e++)a.push(o+10*e);s(a)&&r.push(a)}return r[Math.floor(Math.random()*r.length)]})(["horiz","vert"][Math.floor(2*Math.random())]);for(let s=0;s<o.length;s++)e.board.splice(o[s],1,{hasShip:!0,isHit:!1,ship:t});e.locations.push(o)},getHits:()=>{const t=e.board,s=[];for(let e=0;e<t.length;e++)t[e].hasShip&&t[e].isHit&&s.push(e);return s},getMisses:()=>{const t=e.board,s=[];for(let e=0;e<t.length;e++)t[e].missedShot&&s.push(e);return s}}}function r(e){let t=function(e,t){const r={name:e,board:s(),playing:!0};return{getName:()=>r.name,setName:e=>r.name=e,attackEnemy:(e,t)=>{e.receiveAttack(t)},whoIsPlaying:()=>r.playing,switchRoles:()=>r.playing=!r.playing}}(e),r=function(e){const t={name:"computer",board:s(),playing:e,shotsFired:[]},r=(e,t)=>e.some((e=>e.toString()===t.toString())),o=()=>Math.floor(100*Math.random());return{getName:()=>t.name,attackEnemy:e=>{e.receiveAttack((e=>{let t;t=o();const s=[...e.getMisses(),...e.getHits()];for(;r(s,t);)t=o();return t})(e))},whoIsPlaying:()=>t.playing,switchRoles:()=>t.playing=!t.playing}}(!1),o=s(),a=s(),c=0;const i=()=>o.getFleet(),l=()=>a.getFleet(),n=()=>t.whoIsPlaying(),h=()=>r.whoIsPlaying(),d=()=>{n(),t.switchRoles(),r.switchRoles()};return{getPlayerFleet:i,getPlayerName:()=>t.getName(),getPlayerShipLocations:()=>o.getShipLocations(),getCPUFleet:l,placeCPUShips:()=>{const e=l();for(let t=0;t<e.length;t++)a.randomShipPlacement(e[t])},getShipToPlace:()=>i()[c],placePlayerShips:(e,t)=>{const s=i();o.shipPlacement(t,e,s[c]),c+=1},checkIfAllShipsArePlaced:()=>i().length===c,playerAttack:e=>{n()&&(t.attackEnemy(a,e),d())},cpuAttack:()=>{h()&&(r.attackEnemy(o),d())},playerWon:()=>a.checkShipState(),cpuWon:()=>o.checkShipState(),playerRole:n,cpuRole:h,switchPlayersRoles:d,isValidPlacement:e=>o.checkForValidPlacement(e),getPlayerMisses:()=>a.getMisses(),getCpuMisses:()=>o.getMisses(),getPlayerHits:()=>a.getHits(),getCpuHits:()=>o.getHits()}}(function(){const t=document.querySelector(".player-name"),s=document.querySelector("#name"),o=document.querySelector(".player-board > span"),a=document.querySelector(".player-name > button"),c=(document.querySelector(".board-container"),document.querySelector(".player-board > .board")),i=document.querySelector(".player-board "),l=document.querySelector(".cpu-board > .board"),n=document.querySelector(".cpu-board "),h=document.querySelector(".container"),d=document.querySelector(".axis"),u=document.querySelector(".start");let p=r(s.value),m="horizontal",g=p.getShipToPlace();const y=e=>{const t=[];if("horizontal"===m)for(let s=0;s<g.getLength();s++)t.push(e+s);else for(let s=0;s<g.getLength();s++)t.push(e+10*s);return t},S=()=>m="horizontal"===m?"vert":"horizontal",f=()=>{document.querySelector(".place-ships-text").remove(),(()=>{for(let t=0;t<100;t++){const s=e(t);l.appendChild(s)}})(),n.classList.remove("hide"),d.classList.add("hide"),u.classList.add("hide"),l.querySelectorAll(".empty.cell").forEach((e=>e.classList.add("shoot"))),p.placeCPUShips(),c.querySelectorAll(".hover").forEach((e=>e.classList.remove("hover")))};return{bindEvents:()=>{a.addEventListener("click",(()=>{if(""==s.value)return;i.classList.remove("hide"),o.textContent=s.value,(()=>{for(let t=0;t<100;t++){const s=e(t);c.appendChild(s)}})(),t.remove();const r=document.createElement("div");r.classList.add("place-ships-text"),r.textContent="Place your ships",h.appendChild(r)})),c.addEventListener("mouseout",(e=>{if(p.checkIfAllShipsArePlaced())return;const t=e.target,s=Number(t.getAttribute("coordinate"));y(s).forEach((e=>{const t=c.querySelector(`.empty.cell[coordinate="${e}"]`);t&&t.classList.remove("hover")}))})),c.addEventListener("mouseover",(e=>{if(p.checkIfAllShipsArePlaced())return;const t=e.target;if(t.classList.contains("cell","empty")){const e=Number(t.getAttribute("coordinate")),r=y(e);if(s=r,[9,19,29,39,49,59,69,79,89,99].some((e=>[e,e+1].every((e=>s.includes(e))))))return;r.forEach((e=>{const t=c.querySelector(`.empty.cell[coordinate="${e}"]`);t&&t.classList.add("hover")}))}var s})),c.addEventListener("click",(e=>{if(p.checkIfAllShipsArePlaced())return;const t=e.target;if(t.classList.contains("cell","empty")){const e=Number(t.getAttribute("coordinate")),s=y(e);if(!p.isValidPlacement(s))return;p.placePlayerShips(e,m),p.getPlayerShipLocations().forEach((e=>{document.querySelector(`.cell.empty[coordinate="${e}"]`).classList.add("placed")})),g=p.getShipToPlace(),p.checkIfAllShipsArePlaced()&&u.classList.remove("hide")}})),d.addEventListener("click",S),u.addEventListener("click",f),l.addEventListener("click",(e=>{const t=Number(e.target.getAttribute("coordinate"));if(p.cpuWon())return h.textContent="Computer Won";if(p.playerWon())return h.textContent="You won";if(console.log(e.target.classList),e.target.classList.contains("empty")&&!e.target.classList.contains("miss")&&!e.target.classList.contains("hit")){if(p.playerRole()){p.playerAttack(t);const e=p.getPlayerHits(),s=p.getPlayerMisses();e.forEach((e=>{l.querySelector(`.cell.empty[coordinate="${e}"]`).classList.add("hit")})),s.forEach((e=>{l.querySelector(`.cell.empty[coordinate="${e}"]`).classList.add("miss")}))}if(p.cpuRole()){p.cpuAttack();const e=p.getCpuHits(),t=p.getCpuMisses();e.forEach((e=>{const t=c.querySelector(`.cell.empty[coordinate="${e}"]`);t.classList.remove("placed"),t.classList.add("hit")})),t.forEach((e=>{c.querySelector(`.cell.empty[coordinate="${e}"]`).classList.add("miss")}))}}}))}}})().bindEvents()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q3ZCLDJCQUEyQi9GLE9BRXJCWCxVQUFVQyxJQUFJLFVBRXhCNkksRUFBYWxCLFNBQVNtQixJQUNKL0QsRUFBUzBCLGNBQ3ZCLDJCQUEyQnFDLE9BRXJCL0ksVUFBVUMsSUFBSSxXQUkxQixHQUFJbUgsRUFBSy9CLFVBQVcsQ0FDbEIrQixFQUFLbkIsWUFDTCxNQUFNK0MsRUFBVTVCLEVBQUtaLGFBQ2Z5QyxFQUFZN0IsRUFBS2QsZUFDdkIwQyxFQUFRcEIsU0FBU2pILElBQ2YsTUFBTXVJLEVBQVVwQyxFQUFZSixjQUMxQiwyQkFBMkIvRixPQUU3QnVJLEVBQVFsSixVQUFVd0gsT0FBTyxVQUN6QjBCLEVBQVFsSixVQUFVQyxJQUFJLFVBRXhCZ0osRUFBVXJCLFNBQVNtQixJQUNEakMsRUFBWUosY0FDMUIsMkJBQTJCcUMsT0FFckIvSSxVQUFVQyxJQUFJLG1CQ2xNbENrSixHQUFvQnRCLGMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2NvbXBvbmVudHMvYm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9GYWN0b3J5RnVuY3Rpb25zL1NoaXBzLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvRmFjdG9yeUZ1bmN0aW9ucy9HYW1lYm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9Nb2R1bGVzL2dhbWUuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9GYWN0b3J5RnVuY3Rpb25zL1BsYXllci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL0ZhY3RvcnlGdW5jdGlvbnMvQ29tcHV0ZXJQbGF5ZXIuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9Nb2R1bGVzL2Rpc3BsYXlDb250cm9sbGVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gYm9hcmQoaWQpIHtcbiAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gIGNlbGwuY2xhc3NMaXN0LmFkZChcImVtcHR5XCIpO1xuICBjZWxsLmNsYXNzTGlzdC5hZGQoXCJjZWxsXCIpO1xuICBjZWxsLnNldEF0dHJpYnV0ZShcImNvb3JkaW5hdGVcIiwgYCR7aWR9YCk7XG4gIHJldHVybiBjZWxsO1xufVxuZXhwb3J0IHsgYm9hcmQgfTtcbiIsImZ1bmN0aW9uIHNoaXBzKG5hbWUsIGxlbmd0aCkge1xuICBjb25zdCBzaGlwID0ge1xuICAgIG5hbWUsXG4gICAgbGVuZ3RoLFxuICAgIGhpdHM6IFtdLFxuICB9O1xuXG4gIGNvbnN0IGdldE5hbWUgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHNoaXAubmFtZTtcbiAgfTtcbiAgY29uc3QgZ2V0TGVuZ3RoID0gKCkgPT4ge1xuICAgIHJldHVybiBzaGlwLmxlbmd0aDtcbiAgfTtcbiAgY29uc3QgZ2V0SGl0cyA9ICgpID0+IHtcbiAgICByZXR1cm4gc2hpcC5oaXRzO1xuICB9O1xuXG4gIGNvbnN0IGhpdCA9ICgpID0+IHtcbiAgICBzaGlwLmhpdHMucHVzaChcImhpdFwiKTtcbiAgfTtcblxuICBjb25zdCBpc1N1bmsgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHNoaXAuaGl0cy5sZW5ndGggPT09IHNoaXAubGVuZ3RoO1xuICB9O1xuXG4gIHJldHVybiB7IGdldExlbmd0aCwgZ2V0TmFtZSwgZ2V0SGl0cywgaGl0LCBpc1N1bmsgfTtcbn1cblxuZXhwb3J0IHsgc2hpcHMgfTtcbiIsImltcG9ydCB7IHNoaXBzIH0gZnJvbSBcIi4vU2hpcHNcIjtcbmZ1bmN0aW9uIGdhbWVCb2FyZCgpIHtcbiAgY29uc3QgZ2FtZWJvYXJkID0ge1xuICAgIGJvYXJkOiBBcnJheSgxMDApLmZpbGwoeyBoYXNTaGlwOiBmYWxzZSwgaXNIaXQ6IGZhbHNlIH0pLFxuICAgIGZsZWV0OiBbXG4gICAgICBzaGlwcyhcImNhcnJpZXJcIiwgNSksXG4gICAgICBzaGlwcyhcImJhdHRsZXNoaXBcIiwgNCksXG4gICAgICBzaGlwcyhcImNydWlzZXJcIiwgMyksXG4gICAgICBzaGlwcyhcInN1Ym1hcmluZVwiLCAzKSxcbiAgICAgIHNoaXBzKFwiZGVzdHJveWVyXCIsIDIpLFxuICAgIF0sXG4gICAgbG9jYXRpb25zOiBbXSxcbiAgfTtcblxuICBjb25zdCBnZXRCb2FyZCA9ICgpID0+IHtcbiAgICByZXR1cm4gZ2FtZWJvYXJkLmJvYXJkO1xuICB9O1xuXG4gIGNvbnN0IGdldFNoaXBMb2NhdGlvbnMgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGdhbWVib2FyZC5sb2NhdGlvbnMuZmxhdCgpO1xuICB9O1xuXG4gIGNvbnN0IGdldEZsZWV0ID0gKCkgPT4ge1xuICAgIHJldHVybiBnYW1lYm9hcmQuZmxlZXQ7XG4gIH07XG5cbiAgY29uc3Qgc2hpcExvY2F0aW9uID0gKG9yaWVudGF0aW9uLCBzdGFydGluZ1Bvc2l0aW9uLCBzaGlwKSA9PiB7XG4gICAgLy8gcmV0dXJucyBhbiBhcnJheSBvZiBudW1iZXJzIHRoYXQgcmVwcmVzZW50IGluZGV4ZXMgb24gdGhlIGJvYXJkXG4gICAgY29uc3QgbG9jYXRpb24gPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXAuZ2V0TGVuZ3RoKCk7IGkrKykge1xuICAgICAgb3JpZW50YXRpb24gPT09IFwiaG9yaXpvbnRhbFwiXG4gICAgICAgID8gbG9jYXRpb24ucHVzaChzdGFydGluZ1Bvc2l0aW9uICsgaSlcbiAgICAgICAgOiBsb2NhdGlvbi5wdXNoKHN0YXJ0aW5nUG9zaXRpb24gKyBpICogMTApO1xuICAgIH1cbiAgICByZXR1cm4gbG9jYXRpb247XG4gIH07XG5cbiAgY29uc3Qgc2hpcFBsYWNlbWVudCA9IChvcmllbnRhdGlvbiwgc3RhcnRpbmdQb3NpdGlvbiwgU2hpcCkgPT4ge1xuICAgIGNvbnN0IGxvY2F0aW9uID0gc2hpcExvY2F0aW9uKG9yaWVudGF0aW9uLCBzdGFydGluZ1Bvc2l0aW9uLCBTaGlwKTtcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IGxvY2F0aW9uLmxlbmd0aDsgaisrKSB7XG4gICAgICBnYW1lYm9hcmQuYm9hcmQuc3BsaWNlKGxvY2F0aW9uW2pdLCAxLCB7XG4gICAgICAgIGhhc1NoaXA6IHRydWUsXG4gICAgICAgIGlzSGl0OiBmYWxzZSxcbiAgICAgICAgc2hpcDogU2hpcCxcbiAgICAgIH0pO1xuICAgIH1cbiAgICBnYW1lYm9hcmQubG9jYXRpb25zLnB1c2gobG9jYXRpb24pO1xuICAgIHJldHVybiBsb2NhdGlvbjtcbiAgfTtcblxuICBjb25zdCBjaGVja0ZvclZhbGlkUGxhY2VtZW50ID0gKGxvY2F0aW9uQXJyYXkpID0+IHtcbiAgICBjb25zdCBjb2xsaXNpb25zID0gWzksIDE5LCAyOSwgMzksIDQ5LCA1OSwgNjksIDc5LCA4OV07XG4gICAgaWYgKGxvY2F0aW9uQXJyYXkuc29tZSgobG9jKSA9PiAhZ2FtZWJvYXJkLmJvYXJkW2xvY10pKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBlbHNlIGlmIChsb2NhdGlvbkFycmF5LnNvbWUoKGxvYykgPT4gZ2FtZWJvYXJkLmJvYXJkW2xvY10uaGFzU2hpcCkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgY29sbGlzaW9ucy5zb21lKChudW0pID0+IHtcbiAgICAgICAgcmV0dXJuIFtudW0sIG51bSArIDFdLmV2ZXJ5KChjb21iaW5hdGlvbikgPT5cbiAgICAgICAgICBsb2NhdGlvbkFycmF5LmluY2x1ZGVzKGNvbWJpbmF0aW9uKVxuICAgICAgICApO1xuICAgICAgfSlcbiAgICApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHJhbmRvbVNoaXBQbGFjZW1lbnQgPSAoc2hpcCkgPT4ge1xuICAgIGxldCBhbGxQb3NzaWJsZUxvY2F0aW9ucyA9IFtdO1xuXG4gICAgLy8gcmV0dXJucyBhIHJhbmRvbSBvcmllbnRhdGlvblxuXG4gICAgY29uc3QgcmFuZG9tT3JpZW50YXRpb24gPSAoKSA9PlxuICAgICAgW1wiaG9yaXpcIiwgXCJ2ZXJ0XCJdW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpXTtcblxuICAgIC8vIGZpbmRzIGFsbCBwb3NzaWJsZSBsb2NhdGlvbnMgYSBzaGlwIGNhbiBiZSBwbGFjZWQgYXRcblxuICAgIGNvbnN0IGZpbmRBbGxQb3NzaWJsZUxvY2F0aW9ucyA9IChvcmllbnRhdGlvbikgPT4ge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDAgLSBzaGlwLmdldExlbmd0aCgpOyBpKyspIHtcbiAgICAgICAgbGV0IGxvY2F0aW9uQXJyYXkgPSBbXTtcblxuICAgICAgICBpZiAob3JpZW50YXRpb24gPT09IFwiaG9yaXpcIilcbiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHNoaXAuZ2V0TGVuZ3RoKCk7IGorKykge1xuICAgICAgICAgICAgbG9jYXRpb25BcnJheS5wdXNoKGkgKyBqKTtcbiAgICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHNoaXAuZ2V0TGVuZ3RoKCk7IGorKykge1xuICAgICAgICAgICAgbG9jYXRpb25BcnJheS5wdXNoKGkgKyBqICogMTApO1xuICAgICAgICAgIH1cblxuICAgICAgICAvLyBjaGVja3Mgd2hldGhlciB0aGUgY3JlYXRlZCBsb2NhdGlvbiBpcyB2YWxpZCBvciBub3RcblxuICAgICAgICBpZiAoY2hlY2tGb3JWYWxpZFBsYWNlbWVudChsb2NhdGlvbkFycmF5KSlcbiAgICAgICAgICBhbGxQb3NzaWJsZUxvY2F0aW9ucy5wdXNoKGxvY2F0aW9uQXJyYXkpO1xuICAgICAgfVxuXG4gICAgICAvLyByZXR1cm5zIG9uZSByYW5kb20gc2hpcCBsb2NhdGlvbiBvdXQgb2YgbWFueVxuXG4gICAgICByZXR1cm4gYWxsUG9zc2libGVMb2NhdGlvbnNbXG4gICAgICAgIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGFsbFBvc3NpYmxlTG9jYXRpb25zLmxlbmd0aClcbiAgICAgIF07XG4gICAgfTtcblxuICAgIGxldCBsb2NhdGlvbiA9IGZpbmRBbGxQb3NzaWJsZUxvY2F0aW9ucyhyYW5kb21PcmllbnRhdGlvbigpKTtcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IGxvY2F0aW9uLmxlbmd0aDsgaisrKSB7XG4gICAgICBnYW1lYm9hcmQuYm9hcmQuc3BsaWNlKGxvY2F0aW9uW2pdLCAxLCB7XG4gICAgICAgIGhhc1NoaXA6IHRydWUsXG4gICAgICAgIGlzSGl0OiBmYWxzZSxcbiAgICAgICAgc2hpcDogc2hpcCxcbiAgICAgIH0pO1xuICAgIH1cbiAgICBnYW1lYm9hcmQubG9jYXRpb25zLnB1c2gobG9jYXRpb24pO1xuICB9O1xuXG4gIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSAoY29vcmRpbmF0ZSkgPT4ge1xuICAgIGlmIChnYW1lYm9hcmQuYm9hcmRbY29vcmRpbmF0ZV0uaGFzU2hpcCA9PSBmYWxzZSlcbiAgICAgIGdhbWVib2FyZC5ib2FyZC5zcGxpY2UoY29vcmRpbmF0ZSwgMSwge1xuICAgICAgICBoYXNTaGlwOiBmYWxzZSxcbiAgICAgICAgaXNIaXQ6IHRydWUsXG4gICAgICAgIG1pc3NlZFNob3Q6IHRydWUsXG4gICAgICB9KTtcbiAgICBlbHNlIHtcbiAgICAgIGdhbWVib2FyZC5ib2FyZFtjb29yZGluYXRlXS5pc0hpdCA9IHRydWU7XG4gICAgICBnYW1lYm9hcmQuYm9hcmRbY29vcmRpbmF0ZV0uc2hpcC5oaXQoKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgY2hlY2tTaGlwU3RhdGUgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGdhbWVib2FyZC5ib2FyZFxuICAgICAgLmZpbHRlcigoZWwpID0+IGVsLmhhc1NoaXApXG4gICAgICAubWFwKChlbCkgPT4gZWwuc2hpcClcbiAgICAgIC5ldmVyeSgoZWwpID0+IGVsLmlzU3VuaygpKTtcbiAgfTtcblxuICBjb25zdCBnZXRNaXNzZXMgPSAoKSA9PiB7XG4gICAgY29uc3QgYm9hcmQgPSBnYW1lYm9hcmQuYm9hcmQ7XG4gICAgY29uc3QgbWlzc2VzID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBib2FyZC5sZW5ndGg7IGkrKylcbiAgICAgIGlmIChib2FyZFtpXS5taXNzZWRTaG90KSBtaXNzZXMucHVzaChpKTtcbiAgICByZXR1cm4gbWlzc2VzO1xuICB9O1xuXG4gIGNvbnN0IGdldEhpdHMgPSAoKSA9PiB7XG4gICAgY29uc3QgYm9hcmQgPSBnYW1lYm9hcmQuYm9hcmQ7XG4gICAgY29uc3QgaGl0cyA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9hcmQubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChib2FyZFtpXS5oYXNTaGlwICYmIGJvYXJkW2ldLmlzSGl0KSBoaXRzLnB1c2goaSk7XG4gICAgfVxuICAgIHJldHVybiBoaXRzO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgZ2V0Qm9hcmQsXG4gICAgZ2V0RmxlZXQsXG4gICAgZ2V0U2hpcExvY2F0aW9ucyxcbiAgICBzaGlwUGxhY2VtZW50LFxuICAgIHJlY2VpdmVBdHRhY2ssXG4gICAgY2hlY2tTaGlwU3RhdGUsXG4gICAgY2hlY2tGb3JWYWxpZFBsYWNlbWVudCxcbiAgICByYW5kb21TaGlwUGxhY2VtZW50LFxuICAgIGdldEhpdHMsXG4gICAgZ2V0TWlzc2VzLFxuICB9O1xufVxuXG5leHBvcnQgeyBnYW1lQm9hcmQgfTtcbiIsImltcG9ydCB7IGdhbWVCb2FyZCB9IGZyb20gXCIuLi9GYWN0b3J5RnVuY3Rpb25zL0dhbWVib2FyZFwiO1xuaW1wb3J0IHsgcGxheWVyIH0gZnJvbSBcIi4uL0ZhY3RvcnlGdW5jdGlvbnMvUGxheWVyXCI7XG5pbXBvcnQgeyBjb21wdXRlclBsYXllciB9IGZyb20gXCIuLi9GYWN0b3J5RnVuY3Rpb25zL0NvbXB1dGVyUGxheWVyXCI7XG5cbmZ1bmN0aW9uIGdhbWUobmFtZSkge1xuICBsZXQgaHVtYW5QbGF5ZXIgPSBwbGF5ZXIobmFtZSwgdHJ1ZSk7XG4gIGxldCBjcHVQbGF5ZXIgPSBjb21wdXRlclBsYXllcihmYWxzZSk7XG4gIGxldCBodW1hbkJvYXJkID0gZ2FtZUJvYXJkKCk7XG4gIGxldCBjcHVCb2FyZCA9IGdhbWVCb2FyZCgpO1xuICBsZXQgc2hpcFRvUGxhY2UgPSAwO1xuXG4gIGNvbnN0IGdldFBsYXllckZsZWV0ID0gKCkgPT4ge1xuICAgIHJldHVybiBodW1hbkJvYXJkLmdldEZsZWV0KCk7XG4gIH07XG5cbiAgY29uc3QgZ2V0UGxheWVyTmFtZSA9ICgpID0+IHtcbiAgICByZXR1cm4gaHVtYW5QbGF5ZXIuZ2V0TmFtZSgpO1xuICB9O1xuXG4gIGNvbnN0IGdldFBsYXllclNoaXBMb2NhdGlvbnMgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGh1bWFuQm9hcmQuZ2V0U2hpcExvY2F0aW9ucygpO1xuICB9O1xuXG4gIGNvbnN0IGdldENQVUZsZWV0ID0gKCkgPT4ge1xuICAgIHJldHVybiBjcHVCb2FyZC5nZXRGbGVldCgpO1xuICB9O1xuXG4gIGNvbnN0IGdldFNoaXBUb1BsYWNlID0gKCkgPT4ge1xuICAgIGNvbnN0IGZsZWV0ID0gZ2V0UGxheWVyRmxlZXQoKTtcbiAgICBjb25zdCBzaGlwID0gZmxlZXRbc2hpcFRvUGxhY2VdO1xuICAgIHJldHVybiBzaGlwO1xuICB9O1xuXG4gIGNvbnN0IHBsYWNlQ1BVU2hpcHMgPSAoKSA9PiB7XG4gICAgY29uc3QgY3B1RmxlZXQgPSBnZXRDUFVGbGVldCgpO1xuICAgIGZvciAobGV0IHNoaXAgPSAwOyBzaGlwIDwgY3B1RmxlZXQubGVuZ3RoOyBzaGlwKyspXG4gICAgICBjcHVCb2FyZC5yYW5kb21TaGlwUGxhY2VtZW50KGNwdUZsZWV0W3NoaXBdKTtcbiAgfTtcblxuICBjb25zdCBwbGFjZVBsYXllclNoaXBzID0gKGxvY2F0aW9uLCBheGlzKSA9PiB7XG4gICAgY29uc3QgcGxheWVyRmxlZXQgPSBnZXRQbGF5ZXJGbGVldCgpO1xuICAgIGh1bWFuQm9hcmQuc2hpcFBsYWNlbWVudChheGlzLCBsb2NhdGlvbiwgcGxheWVyRmxlZXRbc2hpcFRvUGxhY2VdKTtcbiAgICBzaGlwVG9QbGFjZSArPSAxO1xuICB9O1xuXG4gIGNvbnN0IGNoZWNrSWZBbGxTaGlwc0FyZVBsYWNlZCA9ICgpID0+IHtcbiAgICByZXR1cm4gZ2V0UGxheWVyRmxlZXQoKS5sZW5ndGggPT09IHNoaXBUb1BsYWNlO1xuICB9O1xuXG4gIGNvbnN0IHBsYXllckF0dGFjayA9IChjb29yZGluYXRlKSA9PiB7XG4gICAgaWYgKHBsYXllclJvbGUoKSkge1xuICAgICAgaHVtYW5QbGF5ZXIuYXR0YWNrRW5lbXkoY3B1Qm9hcmQsIGNvb3JkaW5hdGUpO1xuICAgICAgc3dpdGNoUGxheWVyc1JvbGVzKCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGNwdUF0dGFjayA9ICgpID0+IHtcbiAgICBpZiAoY3B1Um9sZSgpKSB7XG4gICAgICBjcHVQbGF5ZXIuYXR0YWNrRW5lbXkoaHVtYW5Cb2FyZCk7XG4gICAgICBzd2l0Y2hQbGF5ZXJzUm9sZXMoKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgcGxheWVyV29uID0gKCkgPT4ge1xuICAgIHJldHVybiBjcHVCb2FyZC5jaGVja1NoaXBTdGF0ZSgpO1xuICB9O1xuXG4gIGNvbnN0IGNwdVdvbiA9ICgpID0+IHtcbiAgICByZXR1cm4gaHVtYW5Cb2FyZC5jaGVja1NoaXBTdGF0ZSgpO1xuICB9O1xuXG4gIGNvbnN0IHBsYXllclJvbGUgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGh1bWFuUGxheWVyLndob0lzUGxheWluZygpO1xuICB9O1xuXG4gIGNvbnN0IGNwdVJvbGUgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGNwdVBsYXllci53aG9Jc1BsYXlpbmcoKTtcbiAgfTtcblxuICBjb25zdCBzd2l0Y2hQbGF5ZXJzUm9sZXMgPSAoKSA9PiB7XG4gICAgaWYgKHBsYXllclJvbGUoKSkge1xuICAgICAgaHVtYW5QbGF5ZXIuc3dpdGNoUm9sZXMoKTtcbiAgICAgIGNwdVBsYXllci5zd2l0Y2hSb2xlcygpO1xuICAgIH0gZWxzZSB7XG4gICAgICBodW1hblBsYXllci5zd2l0Y2hSb2xlcygpO1xuICAgICAgY3B1UGxheWVyLnN3aXRjaFJvbGVzKCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGlzVmFsaWRQbGFjZW1lbnQgPSAobG9jYXRpb24pID0+IHtcbiAgICByZXR1cm4gaHVtYW5Cb2FyZC5jaGVja0ZvclZhbGlkUGxhY2VtZW50KGxvY2F0aW9uKTtcbiAgfTtcblxuICBjb25zdCBnZXRQbGF5ZXJNaXNzZXMgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGNwdUJvYXJkLmdldE1pc3NlcygpO1xuICB9O1xuXG4gIGNvbnN0IGdldENwdU1pc3NlcyA9ICgpID0+IHtcbiAgICByZXR1cm4gaHVtYW5Cb2FyZC5nZXRNaXNzZXMoKTtcbiAgfTtcblxuICBjb25zdCBnZXRQbGF5ZXJIaXRzID0gKCkgPT4ge1xuICAgIHJldHVybiBjcHVCb2FyZC5nZXRIaXRzKCk7XG4gIH07XG5cbiAgY29uc3QgZ2V0Q3B1SGl0cyA9ICgpID0+IHtcbiAgICByZXR1cm4gaHVtYW5Cb2FyZC5nZXRIaXRzKCk7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBnZXRQbGF5ZXJGbGVldCxcbiAgICBnZXRQbGF5ZXJOYW1lLFxuICAgIGdldFBsYXllclNoaXBMb2NhdGlvbnMsXG4gICAgZ2V0Q1BVRmxlZXQsXG4gICAgcGxhY2VDUFVTaGlwcyxcbiAgICBnZXRTaGlwVG9QbGFjZSxcbiAgICBwbGFjZVBsYXllclNoaXBzLFxuICAgIGNoZWNrSWZBbGxTaGlwc0FyZVBsYWNlZCxcbiAgICBwbGF5ZXJBdHRhY2ssXG4gICAgY3B1QXR0YWNrLFxuICAgIHBsYXllcldvbixcbiAgICBjcHVXb24sXG4gICAgcGxheWVyUm9sZSxcbiAgICBjcHVSb2xlLFxuICAgIHN3aXRjaFBsYXllcnNSb2xlcyxcbiAgICBpc1ZhbGlkUGxhY2VtZW50LFxuICAgIGdldFBsYXllck1pc3NlcyxcbiAgICBnZXRDcHVNaXNzZXMsXG4gICAgZ2V0UGxheWVySGl0cyxcbiAgICBnZXRDcHVIaXRzLFxuICB9O1xufVxuXG5leHBvcnQgeyBnYW1lIH07XG4iLCJpbXBvcnQgeyBnYW1lQm9hcmQgfSBmcm9tIFwiLi9HYW1lYm9hcmRcIjtcbmZ1bmN0aW9uIHBsYXllcihuYW1lLCBwbGF5aW5nKSB7XG4gIGNvbnN0IHBsYXllckluZm8gPSB7XG4gICAgbmFtZSxcbiAgICBib2FyZDogZ2FtZUJvYXJkKCksXG4gICAgcGxheWluZyxcbiAgfTtcblxuICBjb25zdCB3aG9Jc1BsYXlpbmcgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHBsYXllckluZm8ucGxheWluZztcbiAgfTtcblxuICBjb25zdCBzd2l0Y2hSb2xlcyA9ICgpID0+IHtcbiAgICByZXR1cm4gKHBsYXllckluZm8ucGxheWluZyA9ICFwbGF5ZXJJbmZvLnBsYXlpbmcpO1xuICB9O1xuXG4gIGNvbnN0IGdldE5hbWUgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHBsYXllckluZm8ubmFtZTtcbiAgfTtcblxuICBjb25zdCBzZXROYW1lID0gKHZhbHVlKSA9PiB7XG4gICAgcmV0dXJuIChwbGF5ZXJJbmZvLm5hbWUgPSB2YWx1ZSk7XG4gIH07XG5cbiAgY29uc3QgYXR0YWNrRW5lbXkgPSAoZW5lbXlCb2FyZCwgc2hvdCkgPT4ge1xuICAgIGVuZW15Qm9hcmQucmVjZWl2ZUF0dGFjayhzaG90KTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGdldE5hbWUsXG4gICAgc2V0TmFtZSxcbiAgICBhdHRhY2tFbmVteSxcbiAgICB3aG9Jc1BsYXlpbmcsXG4gICAgc3dpdGNoUm9sZXMsXG4gIH07XG59XG5cbmV4cG9ydCB7IHBsYXllciB9O1xuIiwiaW1wb3J0IHsgZ2FtZUJvYXJkIH0gZnJvbSBcIi4vR2FtZWJvYXJkXCI7XG5mdW5jdGlvbiBjb21wdXRlclBsYXllcihwbGF5aW5nKSB7XG4gIGNvbnN0IHBsYXllckluZm8gPSB7XG4gICAgbmFtZTogXCJjb21wdXRlclwiLFxuICAgIGJvYXJkOiBnYW1lQm9hcmQoKSxcbiAgICBwbGF5aW5nLFxuICAgIHNob3RzRmlyZWQ6IFtdLFxuICB9O1xuXG4gIGNvbnN0IHdob0lzUGxheWluZyA9ICgpID0+IHtcbiAgICByZXR1cm4gcGxheWVySW5mby5wbGF5aW5nO1xuICB9O1xuXG4gIGNvbnN0IHN3aXRjaFJvbGVzID0gKCkgPT4ge1xuICAgIHJldHVybiAocGxheWVySW5mby5wbGF5aW5nID0gIXBsYXllckluZm8ucGxheWluZyk7XG4gIH07XG5cbiAgY29uc3QgZ2V0TmFtZSA9ICgpID0+IHtcbiAgICByZXR1cm4gcGxheWVySW5mby5uYW1lO1xuICB9O1xuXG4gIGNvbnN0IGluY2x1ZGVzID0gKGNvb3JkaW5hdGVzLCBjb29yZGluYXRlKSA9PlxuICAgIGNvb3JkaW5hdGVzLnNvbWUoKGNlbGwpID0+IGNlbGwudG9TdHJpbmcoKSA9PT0gY29vcmRpbmF0ZS50b1N0cmluZygpKTtcblxuICBjb25zdCByYW5kb21JbmRleCA9ICgpID0+IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMCk7XG5cbiAgY29uc3QgY2hlY2tSYW5kb21JbmRleCA9IChib2FyZCkgPT4ge1xuICAgIGxldCBjb29yZGlhdGU7XG4gICAgY29vcmRpYXRlID0gcmFuZG9tSW5kZXgoKTtcbiAgICBjb25zdCBkYW1hZ2VkQ2VsbHMgPSBbLi4uYm9hcmQuZ2V0TWlzc2VzKCksIC4uLmJvYXJkLmdldEhpdHMoKV07XG4gICAgd2hpbGUgKGluY2x1ZGVzKGRhbWFnZWRDZWxscywgY29vcmRpYXRlKSkgY29vcmRpYXRlID0gcmFuZG9tSW5kZXgoKTtcbiAgICByZXR1cm4gY29vcmRpYXRlO1xuICB9O1xuICBjb25zdCBhdHRhY2tFbmVteSA9IChlbmVteUJvYXJkKSA9PiB7XG4gICAgZW5lbXlCb2FyZC5yZWNlaXZlQXR0YWNrKGNoZWNrUmFuZG9tSW5kZXgoZW5lbXlCb2FyZCkpO1xuICB9O1xuXG4gIHJldHVybiB7IGdldE5hbWUsIGF0dGFja0VuZW15LCB3aG9Jc1BsYXlpbmcsIHN3aXRjaFJvbGVzIH07XG59XG5leHBvcnQgeyBjb21wdXRlclBsYXllciB9O1xuIiwiaW1wb3J0IHsgYm9hcmQgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9ib2FyZFwiO1xuaW1wb3J0IHsgZ2FtZSB9IGZyb20gXCIuL2dhbWVcIjtcblxuZnVuY3Rpb24gZGlzcGxheUNvbnRyb2xsZXIoKSB7XG4gIGNvbnN0IG5hbWVTY3JlZW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci1uYW1lXCIpO1xuICBjb25zdCBuYW1lSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25hbWVcIik7XG4gIGNvbnN0IHBsYXllck5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci1ib2FyZCA+IHNwYW5cIik7XG4gIGNvbnN0IHBsYXlCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci1uYW1lID4gYnV0dG9uXCIpO1xuICBjb25zdCBib2FyZENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYm9hcmQtY29udGFpbmVyXCIpO1xuICBjb25zdCBwbGF5ZXJCb2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyLWJvYXJkID4gLmJvYXJkXCIpO1xuICBjb25zdCBwbGF5ZXJCb2FyZENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyLWJvYXJkIFwiKTtcbiAgY29uc3QgY3B1Qm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNwdS1ib2FyZCA+IC5ib2FyZFwiKTtcbiAgY29uc3QgY3B1Qm9hcmRDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNwdS1ib2FyZCBcIik7XG4gIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY29udGFpbmVyXCIpO1xuICBjb25zdCBjaGFuZ2VBeGlzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5heGlzXCIpO1xuICBjb25zdCBzdGFydEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc3RhcnRcIik7XG4gIGxldCBHYW1lID0gZ2FtZShuYW1lSW5wdXQudmFsdWUpO1xuICBsZXQgYXhpcyA9IFwiaG9yaXpvbnRhbFwiO1xuICBsZXQgc2hpcFRvUGxhY2UgPSBHYW1lLmdldFNoaXBUb1BsYWNlKCk7XG5cbiAgY29uc3QgcmVuZGVyUGxheWVyQm9hcmQgPSAoKSA9PiB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDA7IGkrKykge1xuICAgICAgY29uc3QgY2VsbCA9IGJvYXJkKGkpO1xuICAgICAgcGxheWVyQm9hcmQuYXBwZW5kQ2hpbGQoY2VsbCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHJlbmRlckNwdUJvYXJkID0gKCkgPT4ge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTAwOyBpKyspIHtcbiAgICAgIGNvbnN0IGNlbGwgPSBib2FyZChpKTtcbiAgICAgIGNwdUJvYXJkLmFwcGVuZENoaWxkKGNlbGwpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBnZW5lcmF0ZUJsb2NrID0gKGNvb3JkaW5hdGUpID0+IHtcbiAgICBjb25zdCBsb2NhdGlvbiA9IFtdO1xuICAgIGlmIChheGlzID09PSBcImhvcml6b250YWxcIilcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcFRvUGxhY2UuZ2V0TGVuZ3RoKCk7IGkrKykge1xuICAgICAgICBsb2NhdGlvbi5wdXNoKGNvb3JkaW5hdGUgKyBpKTtcbiAgICAgIH1cbiAgICBlbHNlXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBUb1BsYWNlLmdldExlbmd0aCgpOyBpKyspIHtcbiAgICAgICAgbG9jYXRpb24ucHVzaChjb29yZGluYXRlICsgaSAqIDEwKTtcbiAgICAgIH1cbiAgICByZXR1cm4gbG9jYXRpb247XG4gIH07XG5cbiAgY29uc3QgY2hlY2tGb3JWYWxpZFBsYWNlbWVudCA9IChsb2NhdGlvbkFycmF5KSA9PiB7XG4gICAgY29uc3QgY29sbGlzaW9ucyA9IFs5LCAxOSwgMjksIDM5LCA0OSwgNTksIDY5LCA3OSwgODksIDk5XTtcbiAgICBpZiAoXG4gICAgICBjb2xsaXNpb25zLnNvbWUoKG51bSkgPT4ge1xuICAgICAgICByZXR1cm4gW251bSwgbnVtICsgMV0uZXZlcnkoKGNvbWJpbmF0aW9uKSA9PlxuICAgICAgICAgIGxvY2F0aW9uQXJyYXkuaW5jbHVkZXMoY29tYmluYXRpb24pXG4gICAgICAgICk7XG4gICAgICB9KVxuICAgICkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgcmVuZGVyU2hpcHMgPSAoKSA9PiB7XG4gICAgY29uc3QgY29vcmRpbmF0ZXMgPSBHYW1lLmdldFBsYXllclNoaXBMb2NhdGlvbnMoKTtcbiAgICBjb29yZGluYXRlcy5mb3JFYWNoKChjb29yZGluYXRlKSA9PiB7XG4gICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgYC5jZWxsLmVtcHR5W2Nvb3JkaW5hdGU9XCIke2Nvb3JkaW5hdGV9XCJdYFxuICAgICAgKTtcbiAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZChcInBsYWNlZFwiKTtcbiAgICB9KTtcbiAgfTtcblxuICBjb25zdCBjaGFuZ2VPcmllbnRhdGlvbiA9ICgpID0+IHtcbiAgICBpZiAoYXhpcyA9PT0gXCJob3Jpem9udGFsXCIpIHJldHVybiAoYXhpcyA9IFwidmVydFwiKTtcbiAgICBlbHNlIHJldHVybiAoYXhpcyA9IFwiaG9yaXpvbnRhbFwiKTtcbiAgfTtcblxuICBjb25zdCBzdGFydEJhdHRsZSA9ICgpID0+IHtcbiAgICBjb25zdCBwbGFjZVNoaXBzVGV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxhY2Utc2hpcHMtdGV4dFwiKTtcbiAgICBwbGFjZVNoaXBzVGV4dC5yZW1vdmUoKTtcbiAgICByZW5kZXJDcHVCb2FyZCgpO1xuICAgIGNwdUJvYXJkQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRlXCIpO1xuICAgIGNoYW5nZUF4aXMuY2xhc3NMaXN0LmFkZChcImhpZGVcIik7XG4gICAgc3RhcnRCdXR0b24uY2xhc3NMaXN0LmFkZChcImhpZGVcIik7XG4gICAgY29uc3QgY3B1Q2VsbHMgPSBjcHVCb2FyZC5xdWVyeVNlbGVjdG9yQWxsKFwiLmVtcHR5LmNlbGxcIik7XG4gICAgY3B1Q2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4gY2VsbC5jbGFzc0xpc3QuYWRkKFwic2hvb3RcIikpO1xuICAgIEdhbWUucGxhY2VDUFVTaGlwcygpO1xuICAgIGNvbnN0IHBsYXllckNlbGxzID0gcGxheWVyQm9hcmQucXVlcnlTZWxlY3RvckFsbChcIi5ob3ZlclwiKTtcbiAgICBwbGF5ZXJDZWxscy5mb3JFYWNoKChjZWxsKSA9PiBjZWxsLmNsYXNzTGlzdC5yZW1vdmUoXCJob3ZlclwiKSk7XG4gIH07XG5cbiAgY29uc3QgYmluZEV2ZW50cyA9ICgpID0+IHtcbiAgICBwbGF5QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBpZiAobmFtZUlucHV0LnZhbHVlID09IFwiXCIpIHJldHVybjtcbiAgICAgIHBsYXllckJvYXJkQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRlXCIpO1xuICAgICAgcGxheWVyTmFtZS50ZXh0Q29udGVudCA9IG5hbWVJbnB1dC52YWx1ZTtcbiAgICAgIHJlbmRlclBsYXllckJvYXJkKCk7XG4gICAgICBuYW1lU2NyZWVuLnJlbW92ZSgpO1xuICAgICAgY29uc3QgcGxhY2VTaGlwc1RleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgcGxhY2VTaGlwc1RleHQuY2xhc3NMaXN0LmFkZChcInBsYWNlLXNoaXBzLXRleHRcIik7XG4gICAgICBwbGFjZVNoaXBzVGV4dC50ZXh0Q29udGVudCA9IFwiUGxhY2UgeW91ciBzaGlwc1wiO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHBsYWNlU2hpcHNUZXh0KTtcbiAgICB9KTtcblxuICAgIHBsYXllckJvYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW91dFwiLCAoZSkgPT4ge1xuICAgICAgaWYgKEdhbWUuY2hlY2tJZkFsbFNoaXBzQXJlUGxhY2VkKCkpIHJldHVybjtcbiAgICAgIGNvbnN0IGNlbGwgPSBlLnRhcmdldDtcbiAgICAgIGNvbnN0IHN0YXJ0aW5nUG9pbnQgPSBOdW1iZXIoY2VsbC5nZXRBdHRyaWJ1dGUoXCJjb29yZGluYXRlXCIpKTtcbiAgICAgIGNvbnN0IGJsb2NrID0gZ2VuZXJhdGVCbG9jayhzdGFydGluZ1BvaW50KTtcbiAgICAgIGJsb2NrLmZvckVhY2goKHNxdWFyZSkgPT4ge1xuICAgICAgICBjb25zdCBjZWxsID0gcGxheWVyQm9hcmQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICBgLmVtcHR5LmNlbGxbY29vcmRpbmF0ZT1cIiR7c3F1YXJlfVwiXWBcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGNlbGwpIGNlbGwuY2xhc3NMaXN0LnJlbW92ZShcImhvdmVyXCIpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBwbGF5ZXJCb2FyZC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsIChlKSA9PiB7XG4gICAgICBpZiAoR2FtZS5jaGVja0lmQWxsU2hpcHNBcmVQbGFjZWQoKSkgcmV0dXJuO1xuICAgICAgY29uc3QgY2VsbCA9IGUudGFyZ2V0O1xuICAgICAgaWYgKGNlbGwuY2xhc3NMaXN0LmNvbnRhaW5zKFwiY2VsbFwiLCBcImVtcHR5XCIpKSB7XG4gICAgICAgIGNvbnN0IHN0YXJ0aW5nUG9pbnQgPSBOdW1iZXIoY2VsbC5nZXRBdHRyaWJ1dGUoXCJjb29yZGluYXRlXCIpKTtcbiAgICAgICAgY29uc3QgYmxvY2sgPSBnZW5lcmF0ZUJsb2NrKHN0YXJ0aW5nUG9pbnQpO1xuICAgICAgICBpZiAoIWNoZWNrRm9yVmFsaWRQbGFjZW1lbnQoYmxvY2spKSByZXR1cm47XG4gICAgICAgIGJsb2NrLmZvckVhY2goKHNxdWFyZSkgPT4ge1xuICAgICAgICAgIGNvbnN0IGNlbGwgPSBwbGF5ZXJCb2FyZC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgICAgYC5lbXB0eS5jZWxsW2Nvb3JkaW5hdGU9XCIke3NxdWFyZX1cIl1gXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoY2VsbCkgY2VsbC5jbGFzc0xpc3QuYWRkKFwiaG92ZXJcIik7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcGxheWVyQm9hcmQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgICBpZiAoR2FtZS5jaGVja0lmQWxsU2hpcHNBcmVQbGFjZWQoKSkgcmV0dXJuO1xuICAgICAgY29uc3QgY2VsbCA9IGUudGFyZ2V0O1xuICAgICAgaWYgKGNlbGwuY2xhc3NMaXN0LmNvbnRhaW5zKFwiY2VsbFwiLCBcImVtcHR5XCIpKSB7XG4gICAgICAgIGNvbnN0IHN0YXJ0aW5nUG9pbnQgPSBOdW1iZXIoY2VsbC5nZXRBdHRyaWJ1dGUoXCJjb29yZGluYXRlXCIpKTtcbiAgICAgICAgY29uc3QgYmxvY2sgPSBnZW5lcmF0ZUJsb2NrKHN0YXJ0aW5nUG9pbnQpO1xuICAgICAgICBpZiAoIUdhbWUuaXNWYWxpZFBsYWNlbWVudChibG9jaykpIHJldHVybjtcbiAgICAgICAgR2FtZS5wbGFjZVBsYXllclNoaXBzKHN0YXJ0aW5nUG9pbnQsIGF4aXMpO1xuICAgICAgICByZW5kZXJTaGlwcygpO1xuICAgICAgICBzaGlwVG9QbGFjZSA9IEdhbWUuZ2V0U2hpcFRvUGxhY2UoKTtcbiAgICAgICAgaWYgKEdhbWUuY2hlY2tJZkFsbFNoaXBzQXJlUGxhY2VkKCkpXG4gICAgICAgICAgc3RhcnRCdXR0b24uY2xhc3NMaXN0LnJlbW92ZShcImhpZGVcIik7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjaGFuZ2VBeGlzLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjaGFuZ2VPcmllbnRhdGlvbik7XG5cbiAgICBzdGFydEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgc3RhcnRCYXR0bGUpO1xuXG4gICAgY3B1Qm9hcmQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgICBjb25zdCBjZWxsVG9BdHRhY2sgPSBOdW1iZXIoZS50YXJnZXQuZ2V0QXR0cmlidXRlKFwiY29vcmRpbmF0ZVwiKSk7XG4gICAgICBpZiAoR2FtZS5jcHVXb24oKSkgcmV0dXJuIChjb250YWluZXIudGV4dENvbnRlbnQgPSBcIkNvbXB1dGVyIFdvblwiKTtcbiAgICAgIGlmIChHYW1lLnBsYXllcldvbigpKSByZXR1cm4gKGNvbnRhaW5lci50ZXh0Q29udGVudCA9IFwiWW91IHdvblwiKTtcbiAgICAgIGNvbnNvbGUubG9nKGUudGFyZ2V0LmNsYXNzTGlzdCk7XG4gICAgICBpZiAoXG4gICAgICAgIGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImVtcHR5XCIpICYmXG4gICAgICAgICFlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtaXNzXCIpICYmXG4gICAgICAgICFlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJoaXRcIilcbiAgICAgICkge1xuICAgICAgICBpZiAoR2FtZS5wbGF5ZXJSb2xlKCkpIHtcbiAgICAgICAgICBHYW1lLnBsYXllckF0dGFjayhjZWxsVG9BdHRhY2spO1xuICAgICAgICAgIGNvbnN0IHBsYXllckhpdHMgPSBHYW1lLmdldFBsYXllckhpdHMoKTtcbiAgICAgICAgICBjb25zdCBwbGF5ZXJNaXNzZXMgPSBHYW1lLmdldFBsYXllck1pc3NlcygpO1xuICAgICAgICAgIHBsYXllckhpdHMuZm9yRWFjaCgoaGl0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBoaXRDZWxsID0gY3B1Qm9hcmQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgICAgYC5jZWxsLmVtcHR5W2Nvb3JkaW5hdGU9XCIke2hpdH1cIl1gXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaGl0Q2VsbC5jbGFzc0xpc3QuYWRkKFwiaGl0XCIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHBsYXllck1pc3Nlcy5mb3JFYWNoKChtaXNzKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBoaXRDZWxsID0gY3B1Qm9hcmQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgICAgYC5jZWxsLmVtcHR5W2Nvb3JkaW5hdGU9XCIke21pc3N9XCJdYFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGhpdENlbGwuY2xhc3NMaXN0LmFkZChcIm1pc3NcIik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoR2FtZS5jcHVSb2xlKCkpIHtcbiAgICAgICAgICBHYW1lLmNwdUF0dGFjaygpO1xuICAgICAgICAgIGNvbnN0IGNwdUhpdHMgPSBHYW1lLmdldENwdUhpdHMoKTtcbiAgICAgICAgICBjb25zdCBjcHVNaXNzZXMgPSBHYW1lLmdldENwdU1pc3NlcygpO1xuICAgICAgICAgIGNwdUhpdHMuZm9yRWFjaCgoaGl0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBoaXRDZWxsID0gcGxheWVyQm9hcmQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgICAgYC5jZWxsLmVtcHR5W2Nvb3JkaW5hdGU9XCIke2hpdH1cIl1gXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaGl0Q2VsbC5jbGFzc0xpc3QucmVtb3ZlKFwicGxhY2VkXCIpO1xuICAgICAgICAgICAgaGl0Q2VsbC5jbGFzc0xpc3QuYWRkKFwiaGl0XCIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNwdU1pc3Nlcy5mb3JFYWNoKChtaXNzKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBoaXRDZWxsID0gcGxheWVyQm9hcmQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgICAgYC5jZWxsLmVtcHR5W2Nvb3JkaW5hdGU9XCIke21pc3N9XCJdYFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGhpdENlbGwuY2xhc3NMaXN0LmFkZChcIm1pc3NcIik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcbiAgcmV0dXJuIHsgYmluZEV2ZW50cyB9O1xufVxuXG5leHBvcnQgeyBkaXNwbGF5Q29udHJvbGxlciB9O1xuIiwiaW1wb3J0IHsgZGlzcGxheUNvbnRyb2xsZXIgfSBmcm9tIFwiLi9Nb2R1bGVzL2Rpc3BsYXlDb250cm9sbGVyXCI7XG5kaXNwbGF5Q29udHJvbGxlcigpLmJpbmRFdmVudHMoKTtcbiJdLCJuYW1lcyI6WyJib2FyZCIsImlkIiwiY2VsbCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsInNldEF0dHJpYnV0ZSIsInNoaXBzIiwibmFtZSIsImxlbmd0aCIsInNoaXAiLCJoaXRzIiwiZ2V0TGVuZ3RoIiwiZ2V0TmFtZSIsImdldEhpdHMiLCJoaXQiLCJwdXNoIiwiaXNTdW5rIiwiZ2FtZUJvYXJkIiwiZ2FtZWJvYXJkIiwiQXJyYXkiLCJmaWxsIiwiaGFzU2hpcCIsImlzSGl0IiwiZmxlZXQiLCJsb2NhdGlvbnMiLCJjaGVja0ZvclZhbGlkUGxhY2VtZW50IiwibG9jYXRpb25BcnJheSIsInNvbWUiLCJsb2MiLCJudW0iLCJldmVyeSIsImNvbWJpbmF0aW9uIiwiaW5jbHVkZXMiLCJnZXRCb2FyZCIsImdldEZsZWV0IiwiZ2V0U2hpcExvY2F0aW9ucyIsImZsYXQiLCJzaGlwUGxhY2VtZW50Iiwib3JpZW50YXRpb24iLCJzdGFydGluZ1Bvc2l0aW9uIiwiU2hpcCIsImxvY2F0aW9uIiwiaSIsInNoaXBMb2NhdGlvbiIsImoiLCJzcGxpY2UiLCJyZWNlaXZlQXR0YWNrIiwiY29vcmRpbmF0ZSIsIm1pc3NlZFNob3QiLCJjaGVja1NoaXBTdGF0ZSIsImZpbHRlciIsImVsIiwibWFwIiwicmFuZG9tU2hpcFBsYWNlbWVudCIsImFsbFBvc3NpYmxlTG9jYXRpb25zIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiZmluZEFsbFBvc3NpYmxlTG9jYXRpb25zIiwiZ2V0TWlzc2VzIiwibWlzc2VzIiwiZ2FtZSIsImh1bWFuUGxheWVyIiwicGxheWluZyIsInBsYXllckluZm8iLCJzZXROYW1lIiwidmFsdWUiLCJhdHRhY2tFbmVteSIsImVuZW15Qm9hcmQiLCJzaG90Iiwid2hvSXNQbGF5aW5nIiwic3dpdGNoUm9sZXMiLCJwbGF5ZXIiLCJjcHVQbGF5ZXIiLCJzaG90c0ZpcmVkIiwiY29vcmRpbmF0ZXMiLCJ0b1N0cmluZyIsInJhbmRvbUluZGV4IiwiY29vcmRpYXRlIiwiZGFtYWdlZENlbGxzIiwiY2hlY2tSYW5kb21JbmRleCIsImNvbXB1dGVyUGxheWVyIiwiaHVtYW5Cb2FyZCIsImNwdUJvYXJkIiwic2hpcFRvUGxhY2UiLCJnZXRQbGF5ZXJGbGVldCIsImdldENQVUZsZWV0IiwicGxheWVyUm9sZSIsImNwdVJvbGUiLCJzd2l0Y2hQbGF5ZXJzUm9sZXMiLCJnZXRQbGF5ZXJOYW1lIiwiZ2V0UGxheWVyU2hpcExvY2F0aW9ucyIsInBsYWNlQ1BVU2hpcHMiLCJjcHVGbGVldCIsImdldFNoaXBUb1BsYWNlIiwicGxhY2VQbGF5ZXJTaGlwcyIsImF4aXMiLCJwbGF5ZXJGbGVldCIsImNoZWNrSWZBbGxTaGlwc0FyZVBsYWNlZCIsInBsYXllckF0dGFjayIsImNwdUF0dGFjayIsInBsYXllcldvbiIsImNwdVdvbiIsImlzVmFsaWRQbGFjZW1lbnQiLCJnZXRQbGF5ZXJNaXNzZXMiLCJnZXRDcHVNaXNzZXMiLCJnZXRQbGF5ZXJIaXRzIiwiZ2V0Q3B1SGl0cyIsIm5hbWVTY3JlZW4iLCJxdWVyeVNlbGVjdG9yIiwibmFtZUlucHV0IiwicGxheWVyTmFtZSIsInBsYXlCdXR0b24iLCJwbGF5ZXJCb2FyZCIsInBsYXllckJvYXJkQ29udGFpbmVyIiwiY3B1Qm9hcmRDb250YWluZXIiLCJjb250YWluZXIiLCJjaGFuZ2VBeGlzIiwic3RhcnRCdXR0b24iLCJHYW1lIiwiZ2VuZXJhdGVCbG9jayIsImNoYW5nZU9yaWVudGF0aW9uIiwic3RhcnRCYXR0bGUiLCJyZW1vdmUiLCJhcHBlbmRDaGlsZCIsInJlbmRlckNwdUJvYXJkIiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJiaW5kRXZlbnRzIiwiYWRkRXZlbnRMaXN0ZW5lciIsInRleHRDb250ZW50IiwicmVuZGVyUGxheWVyQm9hcmQiLCJwbGFjZVNoaXBzVGV4dCIsImUiLCJ0YXJnZXQiLCJzdGFydGluZ1BvaW50IiwiTnVtYmVyIiwiZ2V0QXR0cmlidXRlIiwic3F1YXJlIiwiY29udGFpbnMiLCJibG9jayIsImNlbGxUb0F0dGFjayIsImNvbnNvbGUiLCJsb2ciLCJwbGF5ZXJIaXRzIiwicGxheWVyTWlzc2VzIiwibWlzcyIsImNwdUhpdHMiLCJjcHVNaXNzZXMiLCJoaXRDZWxsIiwiZGlzcGxheUNvbnRyb2xsZXIiXSwic291cmNlUm9vdCI6IiJ9